/*! For license information please see main.bundle.js.LICENSE.txt */
(()=>{"use strict";var t,e={7279:(t,e,i)=>{i.r(e)},9215:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AStar=void 0;class i{static diagonalSuccessors({$N:t,$S:e,$E:i,$W:r,N:s,S:o,E:n,W:a,grid:h,result:d,i:l}){return t&&(i&&0===h[s][n]&&(d[l++]={x:n,y:s}),r&&0===h[s][a]&&(d[l++]={x:a,y:s})),e&&(i&&0===h[o][n]&&(d[l++]={x:n,y:o}),r&&0===h[o][a]&&(d[l++]={x:a,y:o})),d}static diagonalSuccessorsFree({$N:t,$S:e,$E:i,$W:r,N:s,S:o,E:n,W:a,grid:h,rows:d,cols:l,result:c,i:p}){return t=s>-1,e=o<d,r=a>-1,n<l&&(t&&0===h[s][n]&&(c[p++]={x:n,y:s}),e&&0===h[o][n]&&(c[p++]={x:n,y:o})),r&&(t&&0===h[s][a]&&(c[p++]={x:a,y:s}),e&&0===h[o][a]&&(c[p++]={x:a,y:o})),c}static nothingToDo({result:t}){return t}static successors({find:t,x:e,y:i,grid:r,rows:s,cols:o}){const n=i-1,a=i+1,h=e+1,d=e-1,l=n>-1&&0===r[n][e],c=a<s&&0===r[a][e],p=h<o&&0===r[i][h],u=d>-1&&0===r[i][d],m=[];let g=0;return l&&(m[g++]={x:e,y:n}),p&&(m[g++]={x:h,y:i}),c&&(m[g++]={x:e,y:a}),u&&(m[g++]={x:d,y:i}),t({$N:l,$S:c,$E:p,$W:u,N:n,S:a,E:h,W:d,grid:r,rows:s,cols:o,result:m,i:g})}static diagonal({start:t,end:e,f1:i,f2:r}){return r(i(t.x-e.x),i(t.y-e.y))}static euclidean({start:t,end:e,f2:i}){const r=t.x-e.x,s=t.y-e.y;return i(r*r+s*s)}static manhattan({start:t,end:e,f1:i}){return i(t.x-e.x)+i(t.y-e.y)}static calc({grid:t,start:e,end:r,f:s}){const o=t[0].length,n=t.length,a=o*n,h=Math.abs;let d=Math.max;const l={},c=[],p=[{x:e.gridX,y:e.gridY,f:0,g:0,v:e.gridX+e.gridY*o}];let u,m,g,w,f,x,b,y,T,v=1;const C={x:r.gridX,y:r.gridY,v:r.gridX+r.gridY*o};switch(s){case"Diagonal":case"DiagonalFree":g=i.diagonalSuccessors,m=i.diagonal;break;case"Euclidean":case"EuclideanFree":d=Math.sqrt,g=i.diagonalSuccessors,m=i.euclidean;break;default:d=Math.sqrt,m=i.manhattan,g=i.nothingToDo}null!=g||(g=i.diagonalSuccessorsFree);do{for(x=a,b=0,w=0;w<v;++w){const t=p[w].f;t<x&&(x=t,b=w)}if(y=p.splice(b,1)[0],y.v!==C.v)for(--v,T=i.successors({find:g,x:y.x,y:y.y,grid:t,rows:n,cols:o}),w=0,f=T.length;w<f;++w)u={x:T[w].x,y:T[w].y,f:0,g:0,v:T[w].x+T[w].y*o,p:y},u.v in l||(u.f=(u.g=y.g+m({start:u,end:y,f1:h,f2:d}))+m({start:u,end:C,f1:h,f2:d}),p[v++]=u,l[u.v]=1);else{w=v=0;do{c[w++]={x:y.x,y:y.y}}while(null!=(y=y.p));c.reverse()}}while(v>0);return c}}e.AStar=i},9483:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Button=void 0;const r=i(8687);class s extends r.Container{constructor(t){var e,i,r,s,o,n,a,h,d,l,c,p,u,m,g,w,f,x,b,y,T,v,C,S,A,M,k,Y,E,I,X,B,P,G,L,D,R,O,H,N,W,F,z,_,V;super(),this.selected=!1,this.disabled=!1,this.eventMode="static",this.cursor="pointer",this.onClick=t.onClick,this.iconPaddingTop=null!==(e=t.iconPaddingTop)&&void 0!==e?e:20,this.iconPaddingLeft=null!==(i=t.iconPaddingLeft)&&void 0!==i?i:20,this.iconIdleAlpha=null!==(r=t.iconIdleAlpha)&&void 0!==r?r:1,this.iconHoverAlpha=null!==(s=t.iconHoverAlpha)&&void 0!==s?s:1,this.iconSelectedAlpha=null!==(o=t.iconSelectedAlpha)&&void 0!==o?o:1,this.iconDisabledAlpha=null!==(n=t.iconDisabledAlpha)&&void 0!==n?n:1,this.textPaddingTop=null!==(a=t.textPaddingTop)&&void 0!==a?a:20,this.textPaddingLeft=null!==(h=t.textPaddingLeft)&&void 0!==h?h:20,this.fontSize=null!==(d=t.fontSize)&&void 0!==d?d:16,this.textColor=null!==(l=t.textColor)&&void 0!==l?l:0,this.textColorHover=null!==(c=t.textColorHover)&&void 0!==c?c:0,this.shadowTextColor=null!==(p=t.shadowTextColor)&&void 0!==p?p:0,this.shadowThickness=null!==(u=t.shadowThickness)&&void 0!==u?u:0,this.iconColor=null!==(m=t.iconColor)&&void 0!==m?m:0,this.iconColorSelected=null!==(w=null!==(g=t.iconColorSelected)&&void 0!==g?g:this.iconColor)&&void 0!==w?w:0,this.iconColorDisabled=null!==(f=t.iconColorDisabled)&&void 0!==f?f:0,this.iconColorHover=null!==(x=t.iconColorHover)&&void 0!==x?x:0,this.buttonIdleColor=null!==(b=t.buttonIdleColor)&&void 0!==b?b:0,this.buttonIdleAlpha=null!==(y=t.buttonIdleAlpha)&&void 0!==y?y:1,this.buttonHoverColor=null!==(v=null!==(T=t.buttonHoverColor)&&void 0!==T?T:t.buttonIdleColor)&&void 0!==v?v:0,this.buttonHoverAlpha=null!==(C=t.buttonHoverAlpha)&&void 0!==C?C:1,this.buttonBorderWidth=null!==(S=t.buttonBorderWidth)&&void 0!==S?S:0,this.buttonBorderColor=null!==(M=null!==(A=t.buttonBorderColor)&&void 0!==A?A:this.buttonIdleColor)&&void 0!==M?M:0,this.buttonBorderHoverColor=null!==(Y=null!==(k=t.buttonBorderHoverColor)&&void 0!==k?k:t.buttonIdleColor)&&void 0!==Y?Y:0,this.buttonBorderAlpha=null!==(E=t.buttonBorderAlpha)&&void 0!==E?E:1,this.buttonBorderHoverAlpha=null!==(I=t.buttonBorderHoverAlpha)&&void 0!==I?I:1,this.buttonSelectedColor=null!==(B=null!==(X=t.buttonSelectedColor)&&void 0!==X?X:this.buttonIdleColor)&&void 0!==B?B:0,this.buttonDisabledColor=null!==(P=t.buttonDisabledColor)&&void 0!==P?P:0,this.buttonSelectedAlpha=null!==(G=t.buttonSelectedAlpha)&&void 0!==G?G:1,this.buttonDisabledAlpha=null!==(L=t.buttonDisabledAlpha)&&void 0!==L?L:1,this.buttonBorderSelectedColor=null!==(R=null!==(D=t.buttonBorderSelectedColor)&&void 0!==D?D:this.buttonBorderColor)&&void 0!==R?R:0,this.buttonBorderDisabledColor=null!==(O=t.buttonBorderDisabledColor)&&void 0!==O?O:0,this.buttonBorderSelectedAlpha=null!==(H=t.buttonBorderSelectedAlpha)&&void 0!==H?H:1,this.buttonBorderDisabledAlpha=null!==(N=t.buttonBorderDisabledAlpha)&&void 0!==N?N:1,this.textColorSelected=null!==(F=null!==(W=t.textColorSelected)&&void 0!==W?W:this.textColor)&&void 0!==F?F:0,this.textColorDisabled=null!==(_=null!==(z=t.textColorDisabled)&&void 0!==z?z:this.textColor)&&void 0!==_?_:0,this.flexDirection=null!==(V=t.flexDirection)&&void 0!==V?V:"row",this.setup(t),this.draw(t),this.updateState(),"number"==typeof t.initX&&(this.position.x=t.initX),"number"==typeof t.initY&&(this.position.y=t.initY)}setup({text:t,buttonWidth:e,buttonHeight:i,iconTexture:s,iconScale:o=1,iconWidth:n,iconHeight:a,buttonBorderWidth:h=0}){const d=new r.Graphics;this.addChild(d),this.border=d;const l=new r.Graphics;this.addChild(l),this.background=l,this.background.position.set(h,h);const{iconPaddingTop:c,iconPaddingLeft:p,textPaddingTop:u,textPaddingLeft:m,flexDirection:g}=this,w=new r.Sprite(s);w.scale.set(o),"number"==typeof n&&(w.width=n),"number"==typeof a&&(w.height=a),w.position.set(p+h,c+h),this.addChild(w),this.icon=w;const f=new r.Text(t,{fontFamily:"'Courier New', Courier, monospace",fontSize:this.fontSize,fill:16777215,align:"center",stroke:this.shadowTextColor,strokeThickness:this.shadowThickness});null!=s?"row"===g?f.position.set(w.x+w.width+m,u):"col-center"===g?(f.anchor.set(.5,0),f.position.set(null!=e?e/2:h+p+w.width/2,w.y+w.height+u)):f.position.set(h+m,w.y+w.height+u):null==e&&null==i||(null!=e&&null!=i?(f.anchor.set(.5,.5),f.position.set(e/2,i/2)):null==e&&null!=i?(f.anchor.set(0,.5),f.position.set(0,i/2)):null!=e&&null==i&&(f.anchor.set(.5,0),f.position.set(e/2,0))),this.addChild(f),this.text=f,this.initEventLesteners()}initEventLesteners(){this.on("pointertap",(t=>{this.selected=!this.selected,this.updateState(),"function"==typeof this.onClick&&this.onClick(t)})),this.on("pointerdown",(t=>{"touch"===t.pointerType&&this.updateState(!0)})),this.on("pointerenter",(t=>{"mouse"===t.pointerType&&this.updateState(!0)})),this.on("pointerleave",(t=>{"mouse"===t.pointerType&&this.updateState()})),this.on("pointerup",(t=>{"touch"===t.pointerType&&this.updateState()}))}draw({iconPaddingTop:t=0,buttonWidth:e,buttonHeight:i,buttonRadius:r=0,buttonBorderWidth:s=0,textPaddingTop:o=0}){"number"!=typeof e&&(e=this.width+2*s),"number"!=typeof i&&(i=t+this.icon.height+o+this.text.height+2*s),this.border.beginFill(16777215),this.border.drawRoundedRect(0,0,e,i,r),this.border.endFill(),this.border.beginHole(),this.border.drawRoundedRect(s,s,e-2*s,i-2*s,r),this.border.endHole(),this.background.beginFill(16777215),this.background.drawRoundedRect(0,0,e-2*s,i-2*s,r),this.background.endFill()}color({bgAlpha:t,brdColor:e,brdAlpha:i,bgColor:r,txtColor:s,iconColor:o,iconAlpha:n}){this.border.tint=e,this.border.alpha=i,this.background.tint=r,this.background.alpha=t,this.text.tint=s,this.icon.tint=o,this.icon.alpha=n}idleColor({bgAlpha:t=this.buttonIdleAlpha,brdColor:e=this.buttonBorderColor,brdAlpha:i=this.buttonBorderAlpha,bgColor:r=this.buttonIdleColor,txtColor:s=this.textColor,iconColor:o=this.iconColor,iconAlpha:n=this.iconIdleAlpha}={}){this.color({bgAlpha:t,brdAlpha:i,brdColor:e,bgColor:r,txtColor:s,iconColor:o,iconAlpha:n})}hoverColor({bgAlpha:t=this.buttonHoverAlpha,brdColor:e=this.buttonBorderHoverColor,brdAlpha:i=this.buttonBorderHoverAlpha,bgColor:r=this.buttonHoverColor,txtColor:s=this.textColorHover,iconColor:o=this.iconColorHover,iconAlpha:n=this.iconHoverAlpha}={}){this.color({bgAlpha:t,brdAlpha:i,brdColor:e,bgColor:r,txtColor:s,iconColor:o,iconAlpha:n})}selectedColor({bgAlpha:t=this.buttonSelectedAlpha,brdColor:e=this.buttonBorderSelectedColor,brdAlpha:i=this.buttonBorderSelectedAlpha,bgColor:r=this.buttonSelectedColor,txtColor:s=this.textColorSelected,iconColor:o=this.iconColorSelected,iconAlpha:n=this.iconSelectedAlpha}={}){this.color({bgAlpha:t,brdAlpha:i,brdColor:e,bgColor:r,txtColor:s,iconColor:o,iconAlpha:n})}disabledColor({bgAlpha:t=this.buttonDisabledAlpha,brdColor:e=this.buttonBorderDisabledColor,brdAlpha:i=this.buttonBorderDisabledAlpha,bgColor:r=this.buttonDisabledColor,txtColor:s=this.textColorDisabled,iconColor:o=this.iconColorDisabled,iconAlpha:n=this.iconDisabledAlpha}={}){this.color({bgAlpha:t,brdAlpha:i,brdColor:e,bgColor:r,txtColor:s,iconColor:o,iconAlpha:n})}setSelected(t){this.selected=t,this.selected?this.selectedColor():this.idleColor()}setDisabled(t){this.disabled=t,this.disabled?this.selectedColor():this.idleColor()}updateState(t=!1){this.disabled?this.disabledColor():t?this.hoverColor():this.selected?this.selectedColor():this.idleColor()}}e.Button=s},225:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Camera=void 0;const r=i(8687);class s extends r.Graphics{constructor(t){super(),this.draw(t),"number"==typeof t.initY&&(this.position.y=t.initY)}draw({viewWidth:t,viewHeight:e}){this.clear(),this.beginFill(16777215),this.drawRect(0,0,t,e),this.endFill()}handleUpdate(t){}handleResize({viewWidth:t,viewHeight:e}){this.draw({viewWidth:t,viewHeight:e})}}s.options={scrollEdge:100},e.Camera=s},2550:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CampaignScene=void 0;const r=i(8687),s=i(3110),o=i(9221),n=i(6865),a=i(3200),h=i(2273),d=i(3244),l=i(8554),c=i(5317),p=i(7697),u=i(332),m=i(9078),g=i(4631),w=i(231);class f extends r.Container{constructor(t){super(),this.missionStarted=!1,this.missions=[],this.currentMissionIdx=f.options.startMission,this.triggers=[],"number"==typeof t.missionIdx&&(this.currentMissionIdx=t.missionIdx),this.setup(t)}setup({viewWidth:t,viewHeight:e}){const i=new o.Game({viewWidth:t,viewHeight:e,team:a.Team.blue,type:"campaign"});this.addChild(i),this.game=i}handleResize(t){this.game.handleResize(t)}handleUpdate(t){if(this.game.handleUpdate(t),!this.game.gameEnded)for(let e=0;e<this.triggers.length;e++){const i=this.triggers[e];switch(i.type){case c.ETriggerType.timed:this.game.time>=i.time&&(i.action(),this.triggers.splice(e,1),e--);break;case c.ETriggerType.conditional:i.condition()&&(i.action(),this.triggers.splice(e,1),e--);break;case c.ETriggerType.interval:i.isElapsed(t)&&i.action()}}}startCurrentLevel(){this.missionStarted=!0;const t=this.missions[this.currentMissionIdx];this.triggers=t.triggers.map((t=>(0,c.createTrigger)(t))),this.game.startGame(t),t.items.forEach((t=>{const e=this.game.createItem(t);null!=e&&this.game.tileMap.addItem(e)})),this.game.tileMap.rebuildBuildableGrid(),this.game.cash[a.Team.blue]=t.cash.blue,this.game.cash[a.Team.green]=t.cash.green,this.game.showMessage({character:l.EMessageCharacter.system,message:`Mission: ${t.name}\n${t.briefing}`,playSound:!1})}mountedHandler(){this.prepareMissions(),this.startCurrentLevel()}prepareMissions(){this.missions=[{name:"Rescue",briefing:"In the months since the great war, mankind has fallen into chaos. Billions are dead with cities in ruins.\nSmall groups of survivors band together to try and survive as best as they can.\nWe are trying to reach out to all the survivors in this sector before we join back with the main colony.",mapImageSrc:"level1Background",mapSettingsSrc:"level1Settings",startGridX:36,startGridY:0,cash:{blue:0,green:0},items:[{name:"base",initGridX:55,initGridY:6,team:a.Team.blue,commands:[],life:100},{name:"heavy-tank",initGridX:57,initGridY:12,direction:n.EVectorDirection.downRight,team:a.Team.blue,uid:-1},{name:"transport",initGridX:-3,initGridY:2,direction:n.EVectorDirection.right,team:a.Team.blue,uid:-3,commands:[]},{name:"transport",initGridX:-3,initGridY:4,direction:n.EVectorDirection.left,team:a.Team.blue,uid:-4,commands:[]},{name:"scout-tank",initGridX:40,initGridY:20,direction:n.EVectorDirection.up,team:a.Team.green,uid:-2,life:21,order:{type:"patrol",fromPoint:{gridX:34,gridY:20},toPoint:{gridX:42,gridY:26}}},{name:"scout-tank",initGridX:14,initGridY:0,direction:n.EVectorDirection.down,team:a.Team.green,uid:-5,life:21,order:{type:"patrol",fromPoint:{gridX:14,gridY:0},toPoint:{gridX:14,gridY:14}}}],triggers:[{type:c.ETriggerType.timed,time:3e3,action:()=>{this.game.showMessage({character:l.EMessageCharacter.op,message:"Commander!! We haven't heard from the last convoy in over two hours. They should have arrived by now."})}},{type:c.ETriggerType.timed,time:1e4,action:()=>{this.game.showMessage({character:l.EMessageCharacter.op,message:"They were last seen in the North West Sector. Could you investigate?"})}},{type:c.ETriggerType.conditional,condition:()=>this.game.tileMap.isItemsDead([-1,-3,-4]),action:()=>{this.endMission({success:!1})}},{type:c.ETriggerType.conditional,condition:()=>this.game.tileMap.isItemsDead(-2),action:()=>{this.game.showMessage({character:l.EMessageCharacter.op,message:"The rebels have been getting very aggressive lately. I hope the convoy is safe. Find them and escort them back to the base."})}},{type:c.ETriggerType.conditional,condition:()=>{const t=this.game.tileMap.getItemByUid(-1);if(null!=t){const e=t.getGridXY({center:!0});return e.gridX<30&&e.gridY<30}return!1},action:()=>{this.game.showMessage({character:l.EMessageCharacter.driver,message:"Can anyone hear us? Our convoy has been pinned down by rebel tanks. We need help."})}},{type:c.ETriggerType.conditional,condition:()=>{const t=this.game.tileMap.getItemByUid(-1);if(null!=t){const e=t.getGridXY({center:!0});return e.gridX<10&&e.gridY<10}return!1},action:()=>{const t=this.game.tileMap.getItemByUid(-1);null!=t&&(this.game.showMessage({character:l.EMessageCharacter.driver,message:"Thank you. We thought we would never get out of here alive."}),this.game.processCommand({uids:[-3,-4],order:{type:"follow",to:t}}))}},{type:c.ETriggerType.conditional,condition:()=>{const t=this.game.tileMap.getItemByUid(-3),e=this.game.tileMap.getItemByUid(-4);if(null!=t&&null!=e){const i=t.getGridXY({center:!0}),r=e.getGridXY({center:!0});return i.gridX>52&&i.gridY<18&&r.gridX>52&&r.gridY<18}return!1},action:()=>{this.endMission({success:!0})}}]},{name:"Assault",briefing:"Thanks to the supplies from the convoy, we now have the base up and running.\nThe rebels nearby are proving to be a problem. We need to take them out. \nFirst set up the base defences. Then find and destroy all rebels in the area.\nThe colony will be sending us reinforcements to help us out.",mapImageSrc:"level1Background",mapSettingsSrc:"level1Settings",startGridX:36,startGridY:0,cash:{blue:0,green:0},items:[{name:"base",initGridX:55,initGridY:6,team:a.Team.blue,commands:[m.ECommandName.constructSCV],uid:-1},{name:"ground-turret",initGridX:53,initGridY:17,direction:n.EVectorDirection.up,team:a.Team.blue},{name:"heavy-tank",initGridX:55,initGridY:16,direction:n.EVectorDirection.upLeft,team:a.Team.blue,uid:-2,order:{type:"sentry"}},{name:"scout-tank",initGridX:55,initGridY:36,direction:n.EVectorDirection.down,team:a.Team.green,order:{type:"hunt"}},{name:"scout-tank",initGridX:53,initGridY:36,direction:n.EVectorDirection.down,team:a.Team.green,order:{type:"hunt"}},{name:"scout-tank",initGridX:5,initGridY:5,direction:n.EVectorDirection.down,team:a.Team.green,order:{type:"patrol",fromPoint:{gridX:5,gridY:5},toPoint:{gridX:20,gridY:20}}},{name:"scout-tank",initGridX:5,initGridY:15,direction:n.EVectorDirection.down,team:a.Team.green,order:{type:"patrol",fromPoint:{gridX:5,gridY:15},toPoint:{gridX:20,gridY:30}}},{name:"scout-tank",initGridX:25,initGridY:5,direction:n.EVectorDirection.down,team:a.Team.green,order:{type:"patrol",fromPoint:{gridX:25,gridY:5},toPoint:{gridX:25,gridY:20}}},{name:"scout-tank",initGridX:35,initGridY:5,direction:n.EVectorDirection.down,team:a.Team.green,order:{type:"patrol",fromPoint:{gridX:35,gridY:5},toPoint:{gridX:35,gridY:30}}},{name:"base",initGridX:5,initGridY:36,team:a.Team.green,uid:-11},{name:"starport",initGridX:1,initGridY:30,team:a.Team.green,uid:-12},{name:"starport",initGridX:4,initGridY:32,team:a.Team.green,uid:-13},{name:"harvester",initGridX:1,initGridY:38,team:a.Team.green,order:{type:"deploy",toPoint:{gridX:1,gridY:38}}},{name:"harvester",initGridX:10,initGridY:38,team:a.Team.green,order:{type:"deploy",toPoint:{gridX:10,gridY:38}}},{name:"ground-turret",initGridX:5,initGridY:28,direction:n.EVectorDirection.up,team:a.Team.green},{name:"ground-turret",initGridX:7,initGridY:33,direction:n.EVectorDirection.upLeft,team:a.Team.green},{name:"ground-turret",initGridX:8,initGridY:37,direction:n.EVectorDirection.upRight,team:a.Team.green}],triggers:[{type:c.ETriggerType.timed,time:8e3,action:()=>{const{tileMap:t}=this.game,e=t.getItemByUid(-2);null!=e&&(this.game.showMessage({character:l.EMessageCharacter.op,message:"Commander!! Reinforcements have arrived from the colony."}),t.addItem(new d.ScoutTank({game:this.game,initX:58*t.gridSize,initY:22*t.gridSize,team:a.Team.blue,order:{type:"guard",to:e}})),t.addItem(new d.ScoutTank({game:this.game,initX:60*t.gridSize,initY:21*t.gridSize,team:a.Team.blue,order:{type:"guard",to:e}})))}},{type:c.ETriggerType.timed,time:25e3,action:()=>{this.game.showMessage({character:l.EMessageCharacter.op,message:"Commander!! We have enough resources for another ground turret.\nSet up the turret to keep the base safe from any more attacks."}),this.game.cash[a.Team.blue]+=1900}},{type:c.ETriggerType.interval,interval:1e3,action:()=>{this.game.cash[a.Team.green]>1e3&&this.game.tileMap.getTeamMoveableItems(a.Team.green).length<10&&(this.game.processCommand({uids:[-12],order:{type:"construct-unit",name:p.EItemName.ScoutTank,unitOrder:{type:"hunt"}}}),this.game.processCommand({uids:[-13],order:{type:"construct-unit",name:p.EItemName.ScoutTank,unitOrder:{type:"hunt"}}}))}},{type:c.ETriggerType.interval,interval:18e4,action:()=>{if(this.game.tileMap.getTeamMoveableItems(a.Team.blue).length<15){this.game.showMessage({character:l.EMessageCharacter.op,message:"Commander!! More Reinforcments have arrived."});const{tileMap:t}=this.game;t.addItem(new d.ScoutTank({game:this.game,initX:62*t.gridSize,initY:22*t.gridSize,team:a.Team.blue,order:{type:"move-and-attack",toPoint:{gridX:55,gridY:21}}})),t.addItem(new h.HeavyTank({game:this.game,initX:61*t.gridSize,initY:23*t.gridSize,team:a.Team.blue,order:{type:"move-and-attack",toPoint:{gridX:56,gridY:23}}}))}}},{type:c.ETriggerType.timed,time:3e5,action:()=>{this.game.showMessage({character:l.EMessageCharacter.pilot,message:"Close Air Support en route. Will try to do what I can."});const{tileMap:t}=this.game;t.addItem(new u.Chopper({game:this.game,initX:61*t.gridSize,initY:22*t.gridSize,commands:[],team:a.Team.blue,order:{type:"hunt"}})),t.addItem(new u.Chopper({game:this.game,initX:61*t.gridSize,initY:20*t.gridSize,team:a.Team.blue,order:{type:"hunt"}}))}},{type:c.ETriggerType.conditional,condition:()=>this.game.tileMap.isItemsDead(-1),action:()=>{this.endMission({success:!1})}},{type:c.ETriggerType.conditional,condition:()=>this.game.tileMap.isItemsDead(-11),action:()=>{this.endMission({success:!0})}}]},{name:"Under Siege",briefing:"Thanks to the attack led by you, we now have control of the rebel base. We can expect the rebels to try to retaliate.\n The colony is sending in aircraft to help us evacuate back to the main camp. All we need to do is hang tight until the choppers get here. \n Luckily, we have some supplies and ammunition to defend ourselves with until they get here. \nProtect the transports at all costs.",mapImageSrc:"level1Background",mapSettingsSrc:"level1Settings",startGridX:0,startGridY:20,cash:{blue:0,green:0},items:[{name:"base",initGridX:5,initGridY:36,team:a.Team.blue,uid:-11},{name:"starport",initGridX:1,initGridY:28,team:a.Team.blue,uid:-12},{name:"starport",initGridX:4,initGridY:32,team:a.Team.blue,uid:-13},{name:"harvester",initGridX:1.5,initGridY:38.5,initCenter:!0,team:a.Team.blue,order:{type:"deploy",toPoint:{gridX:1.5,gridY:38.5}}},{name:"ground-turret",initGridX:7,initGridY:28,team:a.Team.blue},{name:"ground-turret",initGridX:8,initGridY:32,team:a.Team.blue},{name:"ground-turret",initGridX:11,initGridY:37,team:a.Team.blue},{name:"transport",initGridX:2,initGridY:33,team:a.Team.blue,commands:[],uid:-1},{name:"transport",initGridX:1,initGridY:34,team:a.Team.blue,commands:[],uid:-2},{name:"transport",initGridX:2,initGridY:35,team:a.Team.blue,commands:[],uid:-3},{name:"transport",initGridX:1,initGridY:36,team:a.Team.blue,commands:[],uid:-4},{name:"chopper",initGridX:15,initGridY:40,team:a.Team.blue,commands:[],uid:-5,order:{type:"patrol",fromPoint:{gridX:15,gridY:40},toPoint:{gridX:0,gridY:25}}},{name:"scout-tank",initGridX:15,initGridY:16,team:a.Team.green,order:{type:"hunt"}},{name:"scout-tank",initGridX:17,initGridY:16,team:a.Team.green,order:{type:"hunt"}},{name:"starport",initGridX:35,initGridY:37,team:a.Team.green,uid:-23},{name:"starport",initGridX:33,initGridY:37,team:a.Team.green,uid:-24},{name:"harvester",initGridX:28.5,initGridY:39.5,initCenter:!0,team:a.Team.green,order:{type:"deploy",toPoint:{gridX:28,gridY:39}}},{name:"harvester",initGridX:30.5,initGridY:39.5,initCenter:!0,team:a.Team.green,order:{type:"deploy",toPoint:{gridX:30,gridY:39}}},{name:"starport",initGridX:3,initGridY:0,team:a.Team.green,uid:-21},{name:"starport",initGridX:6,initGridY:0,team:a.Team.green,uid:-22},{name:"harvester",initGridX:0,initGridY:2,team:a.Team.green,order:{type:"deploy",toPoint:{gridX:0,gridY:2}}},{name:"harvester",initGridX:0,initGridY:4,team:a.Team.green,order:{type:"deploy",toPoint:{gridX:0,gridY:4}}}],triggers:[{type:c.ETriggerType.conditional,condition:()=>this.game.tileMap.isItemsDead([-1,-2,-3,-4]),action:()=>{this.endMission({success:!1})}},{type:c.ETriggerType.timed,time:5e3,action:()=>{this.game.showMessage({character:l.EMessageCharacter.driver,message:"Commander!! The rebels have started attacking. We need to protect the base at any cost."})}},{type:c.ETriggerType.timed,time:2e4,action:()=>{const{tileMap:t}=this.game;t.addItem(new g.Transport({game:this.game,initX:57*t.gridSize,initY:3*t.gridSize,commands:[],team:a.Team.blue,uid:-6})),this.game.processCommand({uids:[-5],orderType:"guard",toUid:-6}),this.game.showMessage({character:l.EMessageCharacter.driver,message:"Commander!! The colony has sent some extra supplies. We are coming in from the North East sector through rebel territory. We could use a little protection."})}},{type:c.ETriggerType.timed,time:28e3,action:()=>{const{tileMap:t}=this.game;t.addItem(new d.ScoutTank({game:this.game,initX:57*t.gridSize,initY:28*t.gridSize,team:a.Team.green,order:{type:"hunt"}})),t.addItem(new w.Wraith({game:this.game,initX:55*t.gridSize,initY:33*t.gridSize,team:a.Team.green,order:{type:"sentry"}})),t.addItem(new w.Wraith({game:this.game,initX:53*t.gridSize,initY:33*t.gridSize,team:a.Team.green,order:{type:"sentry"}})),t.addItem(new d.ScoutTank({game:this.game,initX:35*t.gridSize,initY:25*t.gridSize,team:a.Team.green,order:{type:"patrol",fromPoint:{gridX:35,gridY:25},toPoint:{gridX:35,gridY:30}}})),this.game.showMessage({character:l.EMessageCharacter.pilot,message:"I'm on my way."})}},{type:c.ETriggerType.timed,time:48e3,action:()=>{this.game.processCommand({uids:[-6],order:{type:"move",toPoint:{gridX:1.5,gridY:38.5}}}),this.game.showMessage({character:l.EMessageCharacter.driver,message:"Thanks! Appreciate the backup. All right. Off we go."})}},{type:c.ETriggerType.conditional,condition:()=>{const t=this.game.tileMap.getItemByUid(-5);return null!=t&&t.life<.8*t.hitPoints},action:()=>{this.game.showMessage({character:l.EMessageCharacter.pilot,message:"We are under attack! Need assistance. This doesn't look good."})}},{type:c.ETriggerType.conditional,condition:()=>{const t=this.game.tileMap.getItemByUid(-6);if(null!=t){const e=t.getGridXY({center:!0});return e.gridX<5&&e.gridY>37}return!1},action:()=>{this.game.cash[a.Team.blue]+=2e3,this.game.showMessage({character:l.EMessageCharacter.driver,message:"The rebels came out of nowhere. There was nothing we could do. She saved our lives. Hope these supplies were worth it."})}},{type:c.ETriggerType.interval,interval:15e4,action:()=>{let t=0,e=0;const{moveableItems:i}=this.game.tileMap;for(let r=0;r<i.length;r++){const s=i[r];if(s.team===a.Team.green)switch(s.itemName){case"wraith":t++;break;case"heavy-tank":e++}}0===t?this.game.processCommand({uids:[-23,-24],order:{type:"construct-unit",name:p.EItemName.Chopper,unitOrder:{type:"hunt"}}}):1===t?(this.game.processCommand({uids:[-23],order:{type:"construct-unit",name:p.EItemName.Wraith,unitOrder:{type:"hunt"}}}),this.game.processCommand({uids:[-24],order:{type:"construct-unit",name:p.EItemName.Chopper,unitOrder:{type:"hunt"}}})):this.game.processCommand({uids:[-23,-24],order:{type:"construct-unit",name:p.EItemName.Chopper,unitOrder:{type:"hunt"}}}),0===e?this.game.processCommand({uids:[-21,-22],order:{type:"construct-unit",name:p.EItemName.HeavyTank,unitOrder:{type:"hunt"}}}):1===e?(this.game.processCommand({uids:[-21],order:{type:"construct-unit",name:p.EItemName.HeavyTank,unitOrder:{type:"hunt"}}}),this.game.processCommand({uids:[-22],order:{type:"construct-unit",name:p.EItemName.ScoutTank,unitOrder:{type:"hunt"}}})):this.game.processCommand({uids:[-21,-22],order:{type:"construct-unit",name:p.EItemName.ScoutTank,unitOrder:{type:"hunt"}}});const r=[];for(let t=0;t<i.length;t++){const e=i[t];e.team===a.Team.green&&r.push(e.uid)}this.game.processCommand({uids:r,order:{type:"hunt"}})}},{type:c.ETriggerType.timed,time:48e4,action:()=>{this.game.showMessage({character:l.EMessageCharacter.op,message:"Commander! The colony air fleet is just a few minutes away."})}},{type:c.ETriggerType.timed,time:6e5,action:()=>{this.game.showMessage({character:l.EMessageCharacter.op,message:"Commander! The colony air fleet is approaching"});const{tileMap:t}=this.game;t.addItem(new w.Wraith({game:this.game,initX:-1*t.gridSize,initY:20*t.gridSize,team:a.Team.blue,order:{type:"hunt"}})),t.addItem(new u.Chopper({game:this.game,initX:-1*t.gridSize,initY:22*t.gridSize,team:a.Team.blue,order:{type:"hunt"}})),t.addItem(new w.Wraith({game:this.game,initX:-1*t.gridSize,initY:24*t.gridSize,team:a.Team.blue,order:{type:"hunt"}})),t.addItem(new u.Chopper({game:this.game,initX:-1*t.gridSize,initY:26*t.gridSize,team:a.Team.blue,order:{type:"hunt"}})),t.addItem(new w.Wraith({game:this.game,initX:-1*t.gridSize,initY:28*t.gridSize,team:a.Team.blue,order:{type:"hunt"}})),t.addItem(new u.Chopper({game:this.game,initX:-1*t.gridSize,initY:30*t.gridSize,team:a.Team.blue,order:{type:"hunt"}})),t.addItem(new w.Wraith({game:this.game,initX:-1*t.gridSize,initY:32*t.gridSize,team:a.Team.blue,order:{type:"hunt"}})),t.addItem(new u.Chopper({game:this.game,initX:-1*t.gridSize,initY:34*t.gridSize,team:a.Team.blue,order:{type:"hunt"}})),t.addItem(new w.Wraith({game:this.game,initX:-1*t.gridSize,initY:36*t.gridSize,team:a.Team.blue,order:{type:"hunt"}})),t.addItem(new u.Chopper({game:this.game,initX:-1*t.gridSize,initY:38*t.gridSize,team:a.Team.blue,order:{type:"hunt"}}))}},{type:c.ETriggerType.conditional,condition:()=>this.game.tileMap.getTeamStaticItems(a.Team.green).length<=0,action:()=>{this.endMission({success:!0})}}]}]}endMission({success:t}){const e=this.currentMissionIdx===this.missions.length-1;this.game.endGame({success:t,message:t?e?"Mission Accomplished!\nThis was the last mission in the campaign.\nThank You for playing.":"Mission Accomplished!\nReady for new mission?":"Mission Failed.\nTry again?",view:t?e?"home":"home-next":"home-repeat",onLeftClick:()=>{s.SceneManager.changeScene({name:"menu"}).catch(console.error)},onRightClick:()=>{t&&!e&&this.currentMissionIdx++,this.startCurrentLevel()}})}}f.options={startMission:0},e.CampaignScene=f},9078:(t,e)=>{var i;Object.defineProperty(e,"__esModule",{value:!0}),e.ECommandName=void 0,(i=e.ECommandName||(e.ECommandName={})).deselect="deselect",i.moveFollow="moveFollow",i.attack="attack",i.attackGuard="attackGuard",i.patrol="patrol",i.buildTurret="buildTurret",i.buildStarport="buildStarport",i.constructSCV="constructSCV",i.constructHarvester="constructHarvester",i.constructScoutTank="constructScoutTank",i.constructHeavyTank="constructHeavyTank",i.constructChopper="constructChopper",i.constructWraith="constructWraith"},7128:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CommandsBar=void 0;const r=i(8687),s=i(3200),o=i(7697),n=i(9078),a=i(9483),h=i(2591),d=i(9498),l=i(4536),c=i(1097),p=i(3244),u=i(2273),m=i(332),g=i(231);class w extends r.Container{static prepareTextures({textures:t}){w.textures=t,w.commandsDic={[n.ECommandName.deselect]:{iconTexture:t.iconDeselectTexture,text:"deselect",iconWidth:40,iconHeight:40,iconPaddingTop:8,iconPaddingLeft:8},[n.ECommandName.moveFollow]:{iconTexture:t.iconMoveFollowTexture,text:"move\nfollow",iconWidth:40,iconHeight:40,iconPaddingTop:8,iconPaddingLeft:8},[n.ECommandName.attack]:{iconTexture:t.iconAttackTexture,text:"attack",iconWidth:40,iconHeight:40,iconPaddingTop:8,iconPaddingLeft:8},[n.ECommandName.attackGuard]:{iconTexture:t.iconAttackGuardTexture,text:"attack\nguard",iconWidth:40,iconHeight:40,iconPaddingTop:8,iconPaddingLeft:8},[n.ECommandName.patrol]:{iconTexture:t.iconPatrolTexture,text:"patrol",iconWidth:40,iconHeight:40,iconPaddingTop:8,iconPaddingLeft:8},[n.ECommandName.buildTurret]:{iconTexture:t.iconBuildTurretTexture,text:`Turret\n${l.GroundTurret.cost}`,iconWidth:40,iconHeight:40,iconPaddingTop:8,iconPaddingLeft:8},[n.ECommandName.buildStarport]:{iconTexture:t.iconBuildStarportTexture,text:`Starport\n${c.Starport.cost}`,iconWidth:36,iconHeight:40,iconPaddingTop:8,iconPaddingLeft:10},[n.ECommandName.constructSCV]:{iconTexture:t.iconConstructSCVTexture,text:`SCV\n${h.SCV.cost}`,iconWidth:40,iconHeight:40,iconPaddingTop:8,iconPaddingLeft:8},[n.ECommandName.constructHarvester]:{iconTexture:t.iconConstructHarvesterTexture,text:`Harvester\n${d.Harvester.cost}`,iconWidth:30,iconHeight:30,iconPaddingTop:12,iconPaddingLeft:12},[n.ECommandName.constructScoutTank]:{iconTexture:t.iconConstructScoutTankTexture,text:`Scout Tank\n${p.ScoutTank.cost}`,iconWidth:40,iconHeight:40,iconPaddingTop:8,iconPaddingLeft:8},[n.ECommandName.constructHeavyTank]:{iconTexture:t.iconConstructHeavyTankTexture,text:`Heavy Tank\n${u.HeavyTank.cost}`,iconWidth:40,iconHeight:40,iconPaddingTop:8,iconPaddingLeft:8},[n.ECommandName.constructChopper]:{iconTexture:t.iconConstructChopperTexture,text:`Chopper\n${m.Chopper.cost}`,iconWidth:40,iconHeight:40,iconPaddingTop:8,iconPaddingLeft:8},[n.ECommandName.constructWraith]:{iconTexture:t.iconConstructWraithTexture,text:`Wraith\n${g.Wraith.cost}`,iconWidth:40,iconHeight:40,iconPaddingTop:8,iconPaddingLeft:8}}}constructor(t){super(),this.commandTiles=new r.Container,this.commandNames=[],this.calcClickHandler=t=>{switch(t){case n.ECommandName.moveFollow:return()=>{this.deselectTiles(n.ECommandName.moveFollow)};case n.ECommandName.attack:return()=>{this.deselectTiles(n.ECommandName.attack)};case n.ECommandName.attackGuard:return()=>{this.deselectTiles(n.ECommandName.attackGuard)};case n.ECommandName.patrol:return()=>{this.deselectTiles(n.ECommandName.patrol)};case n.ECommandName.deselect:return()=>{this.deselectTiles(),this.game.clearSelection(!0)};case n.ECommandName.buildTurret:return t=>{this.deselectTiles(n.ECommandName.buildTurret)};case n.ECommandName.buildStarport:return t=>{this.deselectTiles(n.ECommandName.buildStarport)};case n.ECommandName.constructSCV:return()=>{this.deselectTiles(n.ECommandName.constructSCV),this.game.selectedItems.forEach((t=>{t.commands.includes(n.ECommandName.constructSCV)&&(t.order={type:"construct-unit",name:o.EItemName.SCV})}))};case n.ECommandName.constructHarvester:return()=>{this.deselectTiles(n.ECommandName.constructHarvester),this.game.selectedItems.forEach((t=>{t.commands.includes(n.ECommandName.constructHarvester)&&(t.order={type:"construct-unit",name:o.EItemName.Harvester})}))};case n.ECommandName.constructScoutTank:return()=>{this.deselectTiles(n.ECommandName.constructScoutTank),this.game.selectedItems.forEach((t=>{t.commands.includes(n.ECommandName.constructScoutTank)&&(t.order={type:"construct-unit",name:o.EItemName.ScoutTank})}))};case n.ECommandName.constructHeavyTank:return()=>{this.deselectTiles(n.ECommandName.constructHeavyTank),this.game.selectedItems.forEach((t=>{t.commands.includes(n.ECommandName.constructHeavyTank)&&(t.order={type:"construct-unit",name:o.EItemName.HeavyTank})}))};case n.ECommandName.constructChopper:return()=>{this.deselectTiles(n.ECommandName.constructChopper),this.game.selectedItems.forEach((t=>{t.commands.includes(n.ECommandName.constructChopper)&&(t.order={type:"construct-unit",name:o.EItemName.Chopper})}))};case n.ECommandName.constructWraith:return()=>{this.deselectTiles(n.ECommandName.constructWraith),this.game.selectedItems.forEach((t=>{t.commands.includes(n.ECommandName.constructWraith)&&(t.order={type:"construct-unit",name:o.EItemName.Wraith})}))}}},this.game=t.game,this.setup()}setup(){this.addChild(this.commandTiles)}prepareCommands(t){const e=new Set([n.ECommandName.deselect]);if(1===t.length){const i=t[0];return i.team===this.game.team&&i.commands.forEach((t=>e.add(t))),this.drawCommands([...e.values()])}const i=t.some((t=>t.type===o.EItemType.vehicles||t.type===o.EItemType.airVehicles));return t.forEach((t=>{t.team===this.game.team&&(!i||t.type!==o.EItemType.vehicles&&t.type!==o.EItemType.airVehicles?t.type===o.EItemType.buildings&&t.commands.forEach((t=>e.add(t))):t.commands.forEach((t=>e.add(t))))})),this.drawCommands([...e.values()])}clearCommandTiles(){for(;this.commandTiles.children.length>0;)this.commandTiles.children[0].removeFromParent()}deselectTiles(t){this.commandTiles.children.forEach((e=>{e.commandName===t?e.setSelected(!0):e.setSelected(!1)}))}getSelectedCommandName(){const t=this.commandTiles.children.find((t=>t.selected));return null!=t?t.commandName:void 0}drawCommands(t){return!(0,s.compareArrays)(this.commandNames,t)&&(this.clearCommandTiles(),this.commandNames=t,this.commandNames.forEach((t=>{const e=w.commandsDic[t],i=new f({commandName:t,buttonRadius:3,iconIdleAlpha:.3,iconHoverAlpha:.4,textPaddingLeft:0,textPaddingTop:8,buttonWidth:60,fontSize:10,textColor:16777215,textColorHover:16776960,iconColor:16777215,iconColorHover:16776960,shadowTextColor:8388736,shadowThickness:1,buttonHoverColor:4539717,buttonIdleColor:4539717,flexDirection:"col-center",buttonBorderWidth:2,buttonBorderColor:1578774,buttonBorderHoverColor:16776960,...e,onClick:this.calcClickHandler(t)});i.position.set(0,this.commandTiles.height),this.commandTiles.addChild(i)})),!0)}}w.commandsDic={},e.CommandsBar=w;class f extends a.Button{constructor(t){super(t),this.commandName=t.commandName}}},9221:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Game=void 0;const r=i(8687),s=i(8554),o=i(665),n=i(225),a=i(5473),h=i(3200),d=i(4539),l=i(9498),c=i(2273),p=i(3244),u=i(4631),m=i(7697),g=i(7049),w=i(9420),f=i(3452),x=i(5191),b=i(5978),y=i(8350),T=i(6879),v=i(9060),C=i(3110),S=i(6103),A=i(4536),M=i(6667),k=i(1097),Y=i(332),E=i(231),I=i(2053),X=i(7128),B=i(9078),P=i(2591);class G extends r.Container{constructor(t){super(),this.gameEnded=!1,this.time=0,this.cash={[h.Team.blue]:0,[h.Team.green]:0},this.speedAdjustmentFactor=1/512,this.turnSpeedAdjustmentFactor=1/64,this.speedAdjustmentWhileTurningFactor=.4,this.reloadAdjustmentFactor=1/8,this.deployBuilding=!1,this.canDeployBuilding=!1,this.selectedItems=[],this.dragSelectThreshold=5,this.dragSelect=new r.Graphics,this.pointerMainDownId=-1,this.pointerMainDownX=-1,this.pointerMainDownY=-1,this.pointerSecondDownId=-1,this.pointerSecondDownX=-1,this.pointerSecondDownY=-1,this.pointerZoomed=!1,this.handlePointerTap=t=>{if((0,a.logPointerEvent)("Game pointertap"),this.gameEnded)return;const e=this.tileMap.toLocal(t),i=this.tileMap.itemUnderPointer(e),{previousPointerTapEvent:r}=this;if((0,a.logDoubleTapEvent)(`ppte ${null==r?void 0:r.pointerId}<>${t.pointerId} ${null==r?void 0:r.pointerType}<>${t.pointerType}`),null!=r&&null!=i){const e="mouse"===r.pointerType&&"mouse"===t.pointerType&&r.pointerId===t.pointerId,s="touch"===r.pointerType&&"touch"===t.pointerType&&(r.pointerId===t.pointerId||r.pointerId+1===t.pointerId),o=t.timeStamp-r.timeStamp,{doubleTapMaxTime:n,doubleTapThreasholdX:h,doubleTapThreasholdY:d}=G.options;if((0,a.logDoubleTapEvent)(`isPreviousMouse=${e} isPreviousTouch=${s} timeDiff=${o} doubleTapMaxTime=${n}`),(e||s)&&o<n){const e=Math.abs(t.globalX-r.globalX),s=Math.abs(t.globalY-r.globalY),o=e<h&&s<d;if((0,a.logDoubleTapEvent)(`absDiffX=${e} absDiffY=${s} isInThreshold=${o}`),o){this.clearSelection();const{activeItems:t}=this.tileMap;for(let e=0;e<t.children.length;e++){const r=t.children[e];i.itemName===r.itemName&&r.team===i.team&&this.selectItem(r)}return void this.sideBar.handleSelectedItems(this.selectedItems)}}}let s,o=this.sideBar.commandsBar.getSelectedCommandName();const n=[];if(null!=i){switch(o){case B.ECommandName.moveFollow:s={type:"follow",to:i};break;case B.ECommandName.attack:s={type:"attack",to:i};break;case B.ECommandName.attackGuard:s=i.team===this.team?{type:"guard",to:i}:{type:"attack",to:i}}const t=this.selectedItems.filter((t=>t.team===this.team&&t!==i)).length;if(i.team===this.team)if(null!=o&&t>0&&null!=s){for(let t=this.selectedItems.length-1;t>=0;t--){const e=this.selectedItems[t];e.team===this.team&&i!==e&&e.commands.includes(o)&&n.push(e.uid)}n.length>0&&this.processCommand({uids:n,order:s})}else this.clearSelection(),this.selectItem(i);else if(t>0){null==o&&(o=B.ECommandName.attackGuard,s={type:"attack",to:i});for(let t=this.selectedItems.length-1;t>=0;t--){const e=this.selectedItems[t];e.team===this.team&&i!==e&&e.commands.includes(o)&&n.push(e.uid)}n.length>0&&this.processCommand({uids:n,order:s})}else this.clearSelection(),this.selectItem(i)}else{null==o&&(o=B.ECommandName.moveFollow);const{gridSize:t}=this.tileMap,i=e.x/t,r=e.y/t;switch(o){case B.ECommandName.moveFollow:s={type:"move",toPoint:{gridX:i,gridY:r}};break;case B.ECommandName.attackGuard:s={type:"move-and-attack",toPoint:{gridX:i,gridY:r}};break;case B.ECommandName.buildTurret:s={type:"build",name:m.EItemName.GroundTurret,toPoint:{gridX:i,gridY:r}};break;case B.ECommandName.buildStarport:s={type:"build",name:m.EItemName.Starport,toPoint:{gridX:i,gridY:r}}}for(let t=this.selectedItems.length-1;t>=0;t--){const e=this.selectedItems[t];if(e.team===this.team&&(e.type===m.EItemType.vehicles||e.type===m.EItemType.airVehicles)&&e.commands.includes(o))if(o===B.ECommandName.patrol){const t=e.getGridXY({center:!0});this.processCommand({uids:[e.uid],order:{type:"patrol",fromPoint:t,toPoint:{gridX:i,gridY:r}}})}else n.push(e.uid)}n.length>0&&this.processCommand({uids:n,order:s})}this.sideBar.handleSelectedItems(this.selectedItems),this.previousPointerTapEvent={type:t.type,pointerId:t.pointerId,pointerType:t.pointerType,timeStamp:t.timeStamp,globalX:t.globalX,globalY:t.globalY}},this.handlePointerDown=t=>{if(this.gameEnded)return;this.pointerZoomed=!1;const e=this.toLocal(t);this.pointerMainDownId>-1?(this.pointerSecondDownId=t.pointerId,this.pointerSecondDownX=e.x,this.pointerSecondDownY=e.y):(this.pointerMainDownId=t.pointerId,this.pointerMainDownX=e.x,this.pointerMainDownY=e.y),(0,a.logPointerEvent)(`Game pdX=${e.x} pdX=${e.y} down`)},this.handlePointerUp=t=>{if(!this.gameEnded){if(this.pointerSecondDownId=this.pointerSecondDownX=this.pointerSecondDownY=-1,this.pointerMainDownId=this.pointerMainDownX=this.pointerSecondDownY=-1,(0,a.logPointerEvent)("Game pointer up"),this.dragSelect.width>0){this.clearSelection();const t=this.dragSelect.getBounds(),e=this.tileMap.toLocal({x:t.left,y:t.top}),i=this.tileMap.toLocal({x:t.right,y:t.bottom}),r=e.x,s=i.x,o=e.y,n=i.y,{moveableItems:a}=this.tileMap;a.forEach((t=>{if(!t.selectable||t.isDead())return;const e=t.getCollisionPosition({center:!0});e.x>=r&&e.x<=s&&e.y>=o&&e.y<=n&&this.selectItem(t)})),this.sideBar.handleSelectedItems(this.selectedItems)}else this.pointerZoomed||this.handlePointerTap(t);this.dragSelect.clear()}},this.handlePointerLeave=t=>{this.gameEnded||(t.pointerId===this.pointerSecondDownId?(this.pointerSecondDownId=this.pointerSecondDownX=this.pointerSecondDownY=-1,(0,a.logPointerEvent)("Game pointer second leave")):(this.pointerMainDownId=this.pointerMainDownX=this.pointerSecondDownY=-1,(0,a.logPointerEvent)("Game pointer main leave")),this.dragSelect.clear())},this.handlePointerMove=t=>{if(this.gameEnded)return;const e=this.toLocal(t);if((0,a.logPointerEvent)("Game pointer move"),-1!==this.pointerMainDownId&&-1===this.pointerSecondDownId)this.pointerMainDownX>-1&&this.pointerMainDownY>-1&&Math.abs(e.x-this.pointerMainDownX)>this.dragSelectThreshold&&Math.abs(e.y-this.pointerMainDownY)>this.dragSelectThreshold&&this.drawDragSelect(e);else if(-1!==this.pointerMainDownId&&-1!==this.pointerSecondDownId){this.dragSelect.width>0&&this.dragSelect.clear();const i=t.pointerId===this.pointerMainDownId,r=i?this.pointerSecondDownX:this.pointerMainDownX,s=i?this.pointerSecondDownY:this.pointerMainDownY,o=i?this.pointerMainDownX:this.pointerSecondDownX,n=i?this.pointerMainDownY:this.pointerSecondDownY,a=e.x,h=e.y,d=Math.hypot(s-n,r-o),l=Math.hypot(s-h,r-a)/d*G.options.pinchScaleFactor,c=Math.min(r,a)+.5*(r-a),p=Math.min(s,h)+.5*(s-h),u=this.toGlobal({x:c,y:p}),m=this.tileMap.toLocal(u);this.tileMap.zoom({scaleFactor:l<1?1/l*-1:l,sX:m.x,sY:m.y}),this.handleResize({viewWidth:C.SceneManager.width,viewHeight:C.SceneManager.height}),i?(this.pointerMainDownX=e.x,this.pointerMainDownY=e.y):(this.pointerSecondDownX=e.x,this.pointerSecondDownY=e.y),this.pointerZoomed=!0}},this.handleWheel=t=>{if(this.gameEnded)return;const e=this.tileMap.toLocal(t),i=-1*Math.sign(t.deltaY)*G.options.wheelScaleFactor;this.tileMap.zoom({scaleFactor:i,sX:e.x,sY:e.y}),this.handleResize({viewWidth:C.SceneManager.width,viewHeight:C.SceneManager.height})},this.startGame=({mapImageSrc:t,mapSettingsSrc:e,startGridX:i=0,startGridY:r=0})=>{this.gameEnded=!1,this.time=0,this.clearSelection(),this.dragSelect.clear(),this.runLevel({mapImageSrc:t,mapSettingsSrc:e});const{gridSize:s}=this.tileMap;this.topBar.miniMap.assignBackgroundTexture({texture:this.tileMap.background.texture}),this.tileMap.goTo({x:i*s,y:r*s}),this.handleResize({viewWidth:C.SceneManager.width,viewHeight:C.SceneManager.height})},this.viewWidth=t.viewWidth,this.viewHeight=t.viewHeight,this.type=t.type,this.team=t.team,this.setup(t),this.prepareTextures(),this.addEventLesteners()}setup({viewWidth:t,viewHeight:e}){const i=e-S.TopBar.options.initHeight;this.camera=new n.Camera({viewWidth:t,viewHeight:i,initY:S.TopBar.options.initHeight}),this.addChild(this.camera),this.tileMap=new o.TileMap({game:this,initY:S.TopBar.options.initHeight}),this.addChild(this.tileMap),this.tileMap.mask=this.camera,this.addChild(this.dragSelect),this.topBar=new S.TopBar({game:this}),this.addChild(this.topBar),this.sideBar=new I.SideBar({game:this,viewWidth:t,initY:S.TopBar.options.initHeight}),this.addChild(this.sideBar),this.startModal=new T.StartModal({viewWidth:t,viewHeight:e}),this.startModal.hideModal(),this.addChild(this.startModal)}addEventLesteners(){this.tileMap.eventMode="static",this.tileMap.on("pointerdown",this.handlePointerDown),this.tileMap.on("pointerup",this.handlePointerUp),this.tileMap.on("pointermove",this.handlePointerMove),this.tileMap.on("pointerleave",this.handlePointerLeave),this.tileMap.on("wheel",this.handleWheel)}drawDragSelect(t){this.dragSelect.clear();const e=Math.abs(t.x-this.pointerMainDownX),i=Math.abs(t.y-this.pointerMainDownY);if(e>0&&i>0){this.dragSelect.lineStyle({width:1,color:16776960});const r=Math.min(t.x,this.pointerMainDownX),s=Math.min(t.y,this.pointerMainDownY);this.dragSelect.position.set(r,s),this.dragSelect.drawRect(0,0,e,i),this.dragSelect.endFill()}}isItemSelected(t){return this.selectedItems.includes(t)}selectItem(t){t.selected||t.selectable&&!t.selected&&(t.setSelected(!0),this.selectedItems.push(t))}deselectItem(t){const e=this.selectedItems.indexOf(t);if(e>-1){const t=this.selectedItems.splice(e,1)[0],i=this.tileMap.orders.children.find((e=>e.item===t));null!=i&&i.removeFromParent()}t.setSelected(!1)}endGame(t){this.gameEnded=!0,this.startModal.showModal(t)}handleResize({viewWidth:t,viewHeight:e}){const{width:i,height:r}=this.tileMap.background,s=t>i?i:t,o=e-this.topBar.height;this.camera.handleResize({viewWidth:s,viewHeight:o>r?r:o});const{x:n,y:h}=this.tileMap.pivot;this.tileMap.handleResize({viewWidth:s,viewHeight:o}),this.topBar.handleResize({viewWidth:s,viewHeight:o,camX:n,camY:h}),this.sideBar.handleResize({viewWidth:s,initY:this.topBar.height});const d=t,l=e,c=i,p=this.topBar.height+r,u=d>c?(d-c)/2:0,m=l>p?(l-p)/2:0;(0,a.logLayout)(`aw=${d} (ow=${c}) x=${u} ah=${l} (oh=${p}) y=${m}`),this.x=u,this.y=m,(0,a.logLayout)(`x=${u} y=${m}`);const g=d>c?c:d,w=l>p?p:l;this.startModal.position.set(g/2-this.startModal.width/2,w/2-this.startModal.height/2)}handleUpdate(t){if(this.gameEnded)return void(this.startModal.visible&&this.startModal.handleUpdate(t));this.time+=t;const{x:e,y:i}=this.tileMap.pivot;this.topBar.handleUpdate({deltaMS:t,camX:e,camY:i}),this.sideBar.handleUpdate(t),this.tileMap.handleUpdate(t),this.camera.handleUpdate(t),this.drawOrders()}drawOrders(){this.selectedItems.forEach((t=>{let e=this.tileMap.orders.children.find((e=>e.item===t));null==e&&(e=new y.Order({item:t}),this.tileMap.orders.addChild(e)),e.drawOrder({selectedItem:t,tileMap:this.tileMap})}))}runLevel({mapImageSrc:t,mapSettingsSrc:e}){this.tileMap.cleanFromAll(),this.topBar.statusBar.cleanFromAll(),this.startModal.cleanFromAll(),this.tileMap.initLevel({mapImageSrc:t,mapSettingsSrc:e,viewWidth:this.camera.width,viewHeight:this.camera.height})}clearSelection(t=!1){t&&this.sideBar.handleSelectedItems([]);for(let t=0;t<this.selectedItems.length;t++){const e=this.selectedItems[t];this.deselectItem(e),t--}}prepareTextures(){const t=r.Assets.get("spritesheet"),{animations:e,textures:i}=t;d.Base.prepareTextures({blueTextures:{healthyTextures:e["base-blue-healthy"],damagedTextures:[i["base-blue-damaged.png"]],constructingTextures:e["base-blue-contructing"]},greenTextures:{healthyTextures:e["base-green-healthy"],damagedTextures:[i["base-green-damaged.png"]],constructingTextures:e["base-green-contructing"]}}),A.GroundTurret.prepareTextures({blueTextures:{healthyTextures:[i["ground-turret-blue-healthy-up.png"]],upTextures:[i["ground-turret-blue-healthy-up.png"]],upRightTextures:[i["ground-turret-blue-healthy-up-right.png"]],rightTextures:[i["ground-turret-blue-healthy-right.png"]],downRightTextures:[i["ground-turret-blue-healthy-down-right.png"]],downTextures:[i["ground-turret-blue-healthy-down.png"]],downLeftTextures:[i["ground-turret-blue-healthy-down-left.png"]],leftTextures:[i["ground-turret-blue-healthy-left.png"]],upLeftTextures:[i["ground-turret-blue-healthy-up-left.png"]],damagedTextures:[i["ground-turret-blue-damaged.png"]],teleportTextures:e["ground-turret-blue-teleport"]},greenTextures:{healthyTextures:[i["ground-turret-green-healthy-up.png"]],upTextures:[i["ground-turret-green-healthy-up.png"]],upRightTextures:[i["ground-turret-green-healthy-up-right.png"]],rightTextures:[i["ground-turret-green-healthy-right.png"]],downRightTextures:[i["ground-turret-green-healthy-down-right.png"]],downTextures:[i["ground-turret-green-healthy-down.png"]],downLeftTextures:[i["ground-turret-green-healthy-down-left.png"]],leftTextures:[i["ground-turret-green-healthy-left.png"]],upLeftTextures:[i["ground-turret-green-healthy-up-left.png"]],damagedTextures:[i["ground-turret-green-damaged.png"]],teleportTextures:e["ground-turret-green-teleport"]}}),M.OilDerrick.prepareTextures({blueTextures:{healthyTextures:e["oil-derrick-blue-healthy"],damagedTextures:[i["oil-derrick-blue-damaged.png"]],deployTextures:e["oil-derrick-blue-deploy"]},greenTextures:{healthyTextures:e["oil-derrick-green-healthy"],damagedTextures:[i["oil-derrick-green-damaged.png"]],deployTextures:e["oil-derrick-green-deploy"]}}),k.Starport.prepareTextures({blueTextures:{healthyTextures:e["starport-blue-healthy"],damagedTextures:[i["starport-blue-damaged.png"]],teleportTextures:e["starport-blue-teleport"],closingTextures:e["starport-blue-closing"],openingTextures:e["starport-blue-opening"]},greenTextures:{healthyTextures:e["starport-green-healthy"],damagedTextures:[i["starport-green-damaged.png"]],teleportTextures:e["starport-green-teleport"],closingTextures:e["starport-green-closing"],openingTextures:e["starport-green-opening"]}}),l.Harvester.prepareTextures({blueTextures:{upTextures:[i["harvester-blue-up.png"]],upRightTextures:[i["harvester-blue-up-right.png"]],rightTextures:[i["harvester-blue-right.png"]],downRightTextures:[i["harvester-blue-down-right.png"]],downTextures:[i["harvester-blue-down.png"]],downLeftTextures:[i["harvester-blue-down-left.png"]],leftTextures:[i["harvester-blue-left.png"]],upLeftTextures:[i["harvester-blue-up-left.png"]]},greenTextures:{upTextures:[i["harvester-green-up.png"]],upRightTextures:[i["harvester-green-up-right.png"]],rightTextures:[i["harvester-green-right.png"]],downRightTextures:[i["harvester-green-down-right.png"]],downTextures:[i["harvester-green-down.png"]],downLeftTextures:[i["harvester-green-down-left.png"]],leftTextures:[i["harvester-green-left.png"]],upLeftTextures:[i["harvester-green-up-left.png"]]}}),c.HeavyTank.prepareTextures({blueTextures:{upTextures:[i["heavy-tank-blue-up.png"]],upRightTextures:[i["heavy-tank-blue-up-right.png"]],rightTextures:[i["heavy-tank-blue-right.png"]],downRightTextures:[i["heavy-tank-blue-down-right.png"]],downTextures:[i["heavy-tank-blue-down.png"]],downLeftTextures:[i["heavy-tank-blue-down-left.png"]],leftTextures:[i["heavy-tank-blue-left.png"]],upLeftTextures:[i["heavy-tank-blue-up-left.png"]]},greenTextures:{upTextures:[i["heavy-tank-green-up.png"]],upRightTextures:[i["heavy-tank-green-up-right.png"]],rightTextures:[i["heavy-tank-green-right.png"]],downRightTextures:[i["heavy-tank-green-down-right.png"]],downTextures:[i["heavy-tank-green-down.png"]],downLeftTextures:[i["heavy-tank-green-down-left.png"]],leftTextures:[i["heavy-tank-green-left.png"]],upLeftTextures:[i["heavy-tank-green-up-left.png"]]}}),p.ScoutTank.prepareTextures({blueTextures:{upTextures:[i["scout-tank-blue-up.png"]],upRightTextures:[i["scout-tank-blue-up-right.png"]],rightTextures:[i["scout-tank-blue-right.png"]],downRightTextures:[i["scout-tank-blue-down-right.png"]],downTextures:[i["scout-tank-blue-down.png"]],downLeftTextures:[i["scout-tank-blue-down-left.png"]],leftTextures:[i["scout-tank-blue-left.png"]],upLeftTextures:[i["scout-tank-blue-up-left.png"]]},greenTextures:{upTextures:[i["scout-tank-green-up.png"]],upRightTextures:[i["scout-tank-green-up-right.png"]],rightTextures:[i["scout-tank-green-right.png"]],downRightTextures:[i["scout-tank-green-down-right.png"]],downTextures:[i["scout-tank-green-down.png"]],downLeftTextures:[i["scout-tank-green-down-left.png"]],leftTextures:[i["scout-tank-green-left.png"]],upLeftTextures:[i["scout-tank-green-up-left.png"]]}}),u.Transport.prepareTextures({blueTextures:{upTextures:[i["transport-blue-up.png"]],upRightTextures:[i["transport-blue-up-right.png"]],rightTextures:[i["transport-blue-right.png"]],downRightTextures:[i["transport-blue-down-right.png"]],downTextures:[i["transport-blue-down.png"]],downLeftTextures:[i["transport-blue-down-left.png"]],leftTextures:[i["transport-blue-left.png"]],upLeftTextures:[i["transport-blue-up-left.png"]]},greenTextures:{upTextures:[i["transport-green-up.png"]],upRightTextures:[i["transport-green-up-right.png"]],rightTextures:[i["transport-green-right.png"]],downRightTextures:[i["transport-green-down-right.png"]],downTextures:[i["transport-green-down.png"]],downLeftTextures:[i["transport-green-down-left.png"]],leftTextures:[i["transport-green-left.png"]],upLeftTextures:[i["transport-green-up-left.png"]]}}),P.SCV.prepareTextures({blueTextures:{upTextures:[i["scv-blue-up.png"]],upRightTextures:[i["scv-blue-up-right.png"]],rightTextures:[i["scv-blue-right.png"]],downRightTextures:[i["scv-blue-down-right.png"]],downTextures:[i["scv-blue-down.png"]],downLeftTextures:[i["scv-blue-down-left.png"]],leftTextures:[i["scv-blue-left.png"]],upLeftTextures:[i["scv-blue-up-left.png"]]},greenTextures:{upTextures:[i["scv-green-up.png"]],upRightTextures:[i["scv-green-up-right.png"]],rightTextures:[i["scv-green-right.png"]],downRightTextures:[i["scv-green-down-right.png"]],downTextures:[i["scv-green-down.png"]],downLeftTextures:[i["scv-green-down-left.png"]],leftTextures:[i["scv-green-left.png"]],upLeftTextures:[i["scv-green-up-left.png"]]}}),w.Bullet.prepareTextures({textures:{upTextures:[i["bullet-up.png"]],upRightTextures:[i["bullet-up-right.png"]],rightTextures:[i["bullet-right.png"]],downRightTextures:[i["bullet-down-right.png"]],downTextures:[i["bullet-down.png"]],downLeftTextures:[i["bullet-down-left.png"]],leftTextures:[i["bullet-left.png"]],upLeftTextures:[i["bullet-up-left.png"]],explodeTextures:e["bullet-explode"]}}),f.CannonBall.prepareTextures({textures:{upTextures:[i["cannon-ball-up.png"]],upRightTextures:[i["cannon-ball-up-right.png"]],rightTextures:[i["cannon-ball-right.png"]],downRightTextures:[i["cannon-ball-down-right.png"]],downTextures:[i["cannon-ball-down.png"]],downLeftTextures:[i["cannon-ball-down-left.png"]],leftTextures:[i["cannon-ball-left.png"]],upLeftTextures:[i["cannon-ball-up-left.png"]],explodeTextures:e["cannon-ball-explode"]}}),x.Laser.prepareTextures({textures:{upTextures:[i["fireball-up.png"]],upRightTextures:[i["fireball-up-right.png"]],rightTextures:[i["fireball-right.png"]],downRightTextures:[i["fireball-down-right.png"]],downTextures:[i["fireball-down.png"]],downLeftTextures:[i["fireball-down-left.png"]],leftTextures:[i["fireball-left.png"]],upLeftTextures:[i["fireball-up-left.png"]],explodeTextures:e["fireball-explode"]}}),b.Rocket.prepareTextures({textures:{upTextures:[i["heatseeker-up.png"]],upRightTextures:[i["heatseeker-up-right.png"]],rightTextures:[i["heatseeker-right.png"]],downRightTextures:[i["heatseeker-down-right.png"]],downTextures:[i["heatseeker-down.png"]],downLeftTextures:[i["heatseeker-down-left.png"]],leftTextures:[i["heatseeker-left.png"]],upLeftTextures:[i["heatseeker-up-left.png"]],explodeTextures:e["heatseeker-explode"]}}),s.StatusBar.prepareTextures({textures:{girl1Texture:i["character-girl1.png"],girl2Texture:i["character-girl2.png"],man1Texture:i["character-man1.png"],systemTexture:i["character-system.png"]}}),T.StartModal.prepareTextures({textures:{iconHomeTexture:i["icon-home.png"],iconRepeatTexture:i["icon-repeat.png"],iconNextTexture:i["icon-next.png"]}}),v.Firework.prepareTextures({textures:{texture:C.SceneManager.app.renderer.generateTexture(v.Firework.prepareGraphics())}}),Y.Chopper.prepareTextures({blueTextures:{upTextures:e["chopper-blue-up"],upRightTextures:e["chopper-blue-up-right"],rightTextures:e["chopper-blue-right"],downRightTextures:e["chopper-blue-down-right"],downTextures:e["chopper-blue-down"],downLeftTextures:e["chopper-blue-down-left"],leftTextures:e["chopper-blue-left"],upLeftTextures:e["chopper-blue-up-left"]},greenTextures:{upTextures:e["chopper-green-up"],upRightTextures:e["chopper-green-up-right"],rightTextures:e["chopper-green-right"],downRightTextures:e["chopper-green-down-right"],downTextures:e["chopper-green-down"],downLeftTextures:e["chopper-green-down-left"],leftTextures:e["chopper-green-left"],upLeftTextures:e["chopper-green-up-left"]},shadowTextures:{upTextures:e["chopper-shadow-up"],upRightTextures:e["chopper-shadow-up-right"],rightTextures:e["chopper-shadow-right"],downRightTextures:e["chopper-shadow-down-right"],downTextures:e["chopper-shadow-down"],downLeftTextures:e["chopper-shadow-down-left"],leftTextures:e["chopper-shadow-left"],upLeftTextures:e["chopper-shadow-up-left"]}}),E.Wraith.prepareTextures({blueTextures:{upTextures:[i["wraith-blue-up.png"]],upRightTextures:[i["wraith-blue-up-right.png"]],rightTextures:[i["wraith-blue-right.png"]],downRightTextures:[i["wraith-blue-down-right.png"]],downTextures:[i["wraith-blue-down.png"]],downLeftTextures:[i["wraith-blue-down-left.png"]],leftTextures:[i["wraith-blue-left.png"]],upLeftTextures:[i["wraith-blue-up-left.png"]]},greenTextures:{upTextures:[i["wraith-green-up.png"]],upRightTextures:[i["wraith-green-up-right.png"]],rightTextures:[i["wraith-green-right.png"]],downRightTextures:[i["wraith-green-down-right.png"]],downTextures:[i["wraith-green-down.png"]],downLeftTextures:[i["wraith-green-down-left.png"]],leftTextures:[i["wraith-green-left.png"]],upLeftTextures:[i["wraith-green-up-left.png"]]},shadowTextures:{upTextures:[i["wraith-shadow-up.png"]],upRightTextures:[i["wraith-shadow-up-right.png"]],rightTextures:[i["wraith-shadow-right.png"]],downRightTextures:[i["wraith-shadow-down-right.png"]],downTextures:[i["wraith-shadow-down.png"]],downLeftTextures:[i["wraith-shadow-down-left.png"]],leftTextures:[i["wraith-shadow-left.png"]],upLeftTextures:[i["wraith-shadow-up-left.png"]]}}),X.CommandsBar.prepareTextures({textures:{iconAttackTexture:i["icon-command-attack.png"],iconMoveFollowTexture:i["icon-command-move-follow.png"],iconAttackGuardTexture:i["icon-command-attack-guard.png"],iconPatrolTexture:i["icon-command-patrol.png"],iconDeselectTexture:i["icon-deselect.png"],iconBuildTurretTexture:i["ground-turret-blue-healthy-down-right.png"],iconBuildStarportTexture:i["starport-blue-healthy-0.png"],iconConstructSCVTexture:i["scv-blue-down-right.png"],iconConstructHarvesterTexture:i["harvester-blue-down-right.png"],iconConstructScoutTankTexture:i["scout-tank-blue-down-right.png"],iconConstructHeavyTankTexture:i["heavy-tank-blue-down-right.png"],iconConstructChopperTexture:i["chopper-blue-down-right-0.png"],iconConstructWraithTexture:i["wraith-blue-down-right.png"]}})}processCommand({uids:t,order:e,toUid:i,orderType:r}){let s,o;if(("attack"===r||"guard"===r||"follow"===r)&&"number"==typeof i){if(s=this.tileMap.getItemByUid(i),null==s||s.isDead())return!1;o={type:r,to:s}}for(const i of t){const t=this.tileMap.getItemByUid(i);null==t||null==e&&null==o||(t.order=null!=e?e:o,["move","follow","guard","patrol"].includes(t.order.type)?t.itemName===m.EItemName.SCV?g.AUDIO.play("scv-yes"):t.itemName===m.EItemName.ScoutTank?g.AUDIO.play("scout-tank-yes"):t.itemName===m.EItemName.HeavyTank?g.AUDIO.play("heavy-tank-yes"):t.itemName===m.EItemName.Chopper?g.AUDIO.play("chopper-yes"):t.itemName===m.EItemName.Wraith?g.AUDIO.play("wraith-yes"):g.AUDIO.play("acknowledge-moving"):["attack","move-and-attack"].includes(t.order.type)?t.itemName===m.EItemName.ScoutTank?g.AUDIO.play("scout-tank-attack"):t.itemName===m.EItemName.HeavyTank?g.AUDIO.play("heavy-tank-attack"):t.itemName===m.EItemName.Chopper?g.AUDIO.play("chopper-attack"):t.itemName===m.EItemName.Wraith?g.AUDIO.play("wraith-attack"):g.AUDIO.play("acknowledge-attacking"):"build"===t.order.type&&g.AUDIO.play("scv-yes"),null==s||"attack"!==t.order.type&&"guard"!==t.order.type||(t.order.to=s))}return!0}showMessage({character:t,message:e,playSound:i=!0}){i&&g.AUDIO.play("message-received"),this.topBar.statusBar.appendMessage({character:t,message:e,time:this.time})}getItemCost(t){switch(t){case m.EItemName.OilDerrick:return M.OilDerrick.cost;case m.EItemName.Starport:return k.Starport.cost;case m.EItemName.GroundTurret:return A.GroundTurret.cost;case m.EItemName.SCV:return P.SCV.cost;case m.EItemName.Transport:return u.Transport.cost;case m.EItemName.Harvester:return l.Harvester.cost;case m.EItemName.HeavyTank:return c.HeavyTank.cost;case m.EItemName.ScoutTank:return p.ScoutTank.cost;case m.EItemName.Chopper:return Y.Chopper.cost;case m.EItemName.Wraith:return E.Wraith.cost}}getReloadTime(t){switch(t){case m.EItemName.Bullet:return w.Bullet.reloadTime;case m.EItemName.CannonBall:return f.CannonBall.reloadTime;case m.EItemName.Rocket:return b.Rocket.reloadTime;case m.EItemName.Laser:return x.Laser.reloadTime}}getBuildableGrid(t){switch(t){case m.EItemName.GroundTurret:return A.GroundTurret.buildableGrid;case m.EItemName.Starport:return k.Starport.buildableGrid}}createItem(t){let{initX:e=0,initY:i=0}=t;const{name:r,initGridX:s,initGridY:o}=t,{gridSize:n}=this.tileMap;switch(e=null!=s?n*s:e,i=null!=o?n*o:i,r){case m.EItemName.Base:return new d.Base({...t,game:this,initX:e,initY:i});case m.EItemName.OilDerrick:return new M.OilDerrick({...t,game:this,initX:e,initY:i});case m.EItemName.Starport:return new k.Starport({...t,game:this,initX:e,initY:i});case m.EItemName.GroundTurret:return new A.GroundTurret({...t,game:this,initX:e,initY:i});case m.EItemName.SCV:return new P.SCV({...t,game:this,initX:e,initY:i});case m.EItemName.Transport:return new u.Transport({...t,game:this,initX:e,initY:i});case m.EItemName.Harvester:return new l.Harvester({...t,game:this,initX:e,initY:i});case m.EItemName.HeavyTank:return new c.HeavyTank({...t,game:this,initX:e,initY:i});case m.EItemName.ScoutTank:return new p.ScoutTank({...t,game:this,initX:e,initY:i});case m.EItemName.Chopper:return new Y.Chopper({...t,game:this,initX:e,initY:i});case m.EItemName.Wraith:return new E.Wraith({...t,game:this,initX:e,initY:i})}}createProjectile(t){let{initX:e=0,initY:i=0}=t;const{name:r,initGridX:s,initGridY:o}=t,{gridSize:n}=this.tileMap;switch(e=null!=s?n*s:e,i=null!=o?n*o:i,r){case m.EItemName.Bullet:return new w.Bullet({...t,game:this,initX:e,initY:i});case m.EItemName.CannonBall:return new f.CannonBall({...t,game:this,initX:e,initY:i});case m.EItemName.Rocket:return new b.Rocket({...t,game:this,initX:e,initY:i});case m.EItemName.Laser:return new x.Laser({...t,game:this,initX:e,initY:i})}}}G.options={doubleTapMaxTime:300,doubleTapThreasholdX:10,doubleTapThreasholdY:10,wheelScaleFactor:1.5,pinchScaleFactor:1},e.Game=G},1519:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Hitboxes=void 0;const r=i(8687);class s extends r.Graphics{draw({currentMapBuildableGrid:t,tileWidth:e,tileHeight:i,borderWidth:r}){this.clear();for(let s=0;s<t.length;s++)for(let o=0;o<t[s].length;o++){const n=e*o,a=e*s;this.beginFill(1===t[s][o]?16711680:65280),this.drawRect(n,a,e,i),this.endFill(),this.beginHole(),this.drawRect(n+r,a+r,e-2*r,i-2*r),this.endHole()}}toggleBuildableGrid({toggle:t,currentMapBuildableGrid:e,tileWidth:i,tileHeight:r,borderWidth:s}){t?(this.draw({currentMapBuildableGrid:e,tileWidth:i,tileHeight:r,borderWidth:s}),this.visible=!0):this.visible=!1}}e.Hitboxes=s},9349:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Item=void 0;const r=i(8687),s=i(7697),o=i(3200),n=i(5473);class a extends r.Container{constructor(t){var e;super(),this.sight=0,this.type=s.EItemType.none,this.itemName=s.EItemName.None,this.commands=[],this.collisionGraphics=new r.Graphics,this.collisionOptions={width:0,height:0,offset:{x:0,y:0}},this.uid="number"==typeof t.uid?t.uid:(0,o.generateUid)(),this.game=t.game,this.order=null!==(e=t.order)&&void 0!==e?e:{type:"stand"}}setup(t){this.addChild(this.collisionGraphics)}getGridXY({floor:t=!1,center:e=!1}={}){const{gridSize:i}=this.game.tileMap,r=this.getCollisionPosition({center:e}),s={gridX:r.x/i,gridY:r.y/i};return t&&(s.gridX=Math.floor(s.gridX),s.gridY=Math.floor(s.gridY)),s}setPositionByXY({x:t,y:e,center:i=!1}){const{x:r,y:s,width:o,height:n}=this.collisionGraphics,a=0-(r+(i?o/2:0)),h=0-(s+(i?n/2:0));this.position.set(t+a,e+h)}setPositionByGridXY({gridX:t,gridY:e,center:i}){const{gridSize:r}=this.game.tileMap;this.setPositionByXY({x:t*r,y:e*r,center:i})}handleUpdate(t){}drawCollision(){const{offset:t,width:e,height:i}=this.collisionOptions,{collisionGraphics:r}=this;r.position.set(t.x,t.y),r.beginFill(16777215),r.drawRect(0,0,e,i),r.endFill(),r.alpha=n.logItemBounds.enabled?.5:0}getCollisionPosition({center:t=!1}={}){const{x:e,y:i,width:r,height:s}=this.collisionGraphics,o={x:this.x+e,y:this.y+i};return t&&(o.x+=r/2,o.y+=s/2),o}getCollisionBounds(){const t=this.getCollisionPosition();return{top:t.y,right:t.x+this.collisionGraphics.width,bottom:t.y+this.collisionGraphics.height,left:t.x}}getGridCollisionBounds(){const t=this.getCollisionBounds(),{gridSize:e}=this.game.tileMap,i={topGridY:t.top/e,rightGridX:t.right/e,bottomGridY:t.bottom/e,leftGridX:t.left/e},r={topGridY:Math.floor(i.topGridY),rightGridX:Math.floor(i.rightGridX),bottomGridY:Math.floor(i.bottomGridY),leftGridX:Math.floor(i.leftGridX)};return{topGridY:r.topGridY,leftGridX:r.leftGridX,rightGridX:i.rightGridX===r.rightGridX&&i.leftGridX===i.rightGridX-1?r.leftGridX:r.rightGridX,bottomGridY:i.bottomGridY===r.bottomGridY&&i.topGridY===i.bottomGridY-1?r.topGridY:r.bottomGridY}}processOrders(){return!1}removeAndDestroy(){this.removeFromParent()}}e.Item=a},1420:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.LifeBar=void 0;const r=i(8687);class s extends r.Container{constructor(t){super(),this.borderThickness=t.borderThickness,this.setup()}setup(){this.borderBox=new r.Graphics,this.addChild(this.borderBox);const t=new r.Container;this.addChild(t),this.bars=t,this.emptyBar=new r.Graphics,t.addChild(this.emptyBar);const e=new r.Graphics;t.addChild(e),this.fillBar=e}draw({borderColor:t,borderAlpha:e,fillColor:i,emptyColor:r,width:s,height:o,borderThickness:n}){const{borderBox:a,fillBar:h,emptyBar:d}=this;a.beginFill(t),a.drawRect(0,0,s,o),a.endFill(),a.alpha=e,this.bars.position.set(n,n),d.beginFill(r),d.drawRect(0,0,s-2*n,o-2*n),d.endFill(),h.beginFill(i),h.drawRect(0,0,s-2*n,o-2*n),h.endFill()}updateLife(t){this.fillBar.width=(this.emptyBar.width-this.borderThickness)*t}}e.LifeBar=s},4793:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.LifeableItem=void 0;const r=i(9349),s=i(1420);class o extends r.Item{constructor(t){super(t),this.life=0,this.hitPoints=0,this.drawLifeBarOptions={borderColor:0,borderThickness:0,borderAlpha:0,width:0,height:0,fillColor:0,emptyColor:0,offset:{x:0,y:0}},null!=t.life&&(this.life=t.life)}setup(t){this.lifeBar=new s.LifeBar(this.drawLifeBarOptions),this.addChild(this.lifeBar)}drawLifeBar(){this.lifeBar.draw(this.drawLifeBarOptions);const{offset:t}=this.drawLifeBarOptions;this.lifeBar.position.set(t.x,t.y)}isAlive(){return this.life>0}isHealthy(){return this.life>=.4*this.hitPoints}isDead(){return!this.isAlive()}subLife(t){this.life-=t,this.isDead()?this.removeAndDestroy():(this.updateLife(),this.updateAnimation())}updateLife(){this.lifeBar.updateLife(this.life/this.hitPoints)}updateAnimation(){}}e.LifeableItem=o},1557:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.LoaderScene=e.manifest=void 0;const r=i(8687),s=i(5473);e.manifest={bundles:[{name:"initial-bundle",assets:{spritesheet:"assets/spritesheets/spritesheet.json",menuBackground:"assets/images/splashscreen.png",level1Background:"assets/levels/level-1.png",level1Settings:"assets/levels/level-1.json"}}]};class o extends r.Container{constructor(t){super(),this.downloadProgress=t=>{this.loaderBarFill.width=(o.barOptions.width-2*o.barOptions.borderThick)*t},this.setup(),this.draw()}setup(){const t=new r.Graphics;this.addChild(t),this.loaderBarBorder=t;const e=new r.Graphics;this.addChild(e),this.loaderBarFill=e}draw(){const{barOptions:t}=o,{loaderBarFill:e,loaderBarBorder:i}=this;i.beginFill(t.borderColor),i.drawRoundedRect(0,0,t.width,t.height,t.borderRadius),i.endFill(),e.beginFill(t.fillColor),e.drawRoundedRect(t.borderThick,t.borderThick,t.width-2*t.borderThick,t.height-2*t.borderThick,t.borderRadius),e.endFill()}async initializeLoader(){await r.Assets.init({manifest:e.manifest}),await r.Assets.loadBundle(e.manifest.bundles[0].name,this.downloadProgress)}getAssets(){return{spritesheet:r.Assets.get("spritesheet"),menuBackground:r.Assets.get("menuBackground")}}handleResize({viewWidth:t,viewHeight:e}){const i=t,r=e,n=this.width,a=this.height;if(i>=n&&r>=a){const t=i>n?(i-n)/2:0,e=r>a?(r-a)/2:0;(0,s.logLayout)(`Spacing aw=${i} tw=${n} ah=${r} th=${a}`),this.x=t,this.width=o.barOptions.width,this.y=e,this.height=o.barOptions.height}else{let t=1;a>=n?(t=r/a,t*n>i&&(t=i/n),(0,s.logLayout)(`By height (sc=${t})`)):(t=i/n,(0,s.logLayout)(`By width (sc=${t})`),t*a>r&&(t=r/a));const e=Math.floor(n*t),o=Math.floor(a*t),h=i>e?(i-e)/2:0,d=r>o?(r-o)/2:0;(0,s.logLayout)(`aw=${i} (ow=${e}) ah=${r} (oh=${o})`),this.x=h,this.width=e,this.y=d,this.height=o}(0,s.logLayout)(`x=${this.x} y=${this.y} w=${this.width} h=${this.height}`)}handleMounted(){}handleUpdate(){}}o.barOptions={width:350,height:40,fillColor:1588688,borderRadius:5,borderThick:5,borderColor:0},e.LoaderScene=o},5502:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MapSettings=void 0;class i{static findTileLayer({name:t,mapSettings:e}){const i=e.layers.find((e=>"tilelayer"===e.type&&e.name===t));if(null==i)throw new Error(`Unable to detect "${t}" tile layer`);return i}static findObjectGroupLayer({name:t,mapSettings:e}){const i=e.layers.find((e=>"objectgroup"===e.type&&e.name===t));if(null==i)throw new Error(`Unable to detect "${t}" object group layer`);return i}static mapObjectToPositions({mapSettings:t,layerName:e}){const r=[],s=i.findObjectGroupLayer({name:e,mapSettings:t});for(let t=0;t<s.objects.length;t++){const e=s.objects[t];r.push({x:e.x,y:e.y,width:e.width,height:e.height})}return r}static mapTilesToPositions({mapSettings:t,layerName:e,tileIds:r}){const s=[],o=i.findTileLayer({name:e,mapSettings:t}),n=t.width;for(let e=0;e<o.data.length;e+=n)o.data.slice(e,e+n).forEach(((i,o)=>{(Array.isArray(r)&&r.includes(i)||0!==i)&&s.push({x:o*t.tilewidth,y:e/n*t.tileheight,width:t.tilewidth,height:t.tileheight})}));return s}}e.MapSettings=i},9772:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MenuScene=void 0;const r=i(8687),s=i(3110),o=i(5473),n=i(9483),a=i(665),h=i(2550);class d extends r.Container{constructor(t){super(),this.gravity=.7,this.gameEnded=!1,this.choices=new r.Container,this.drawMainOptions=()=>{this.clearFromAll();const{mainOffset:t}=d.options.choices;this.choices.position.set(t.x,t.y);const e={text:"",fontSize:48,textColor:16777215,textColorHover:16776960,shadowTextColor:8388736,shadowThickness:2,buttonSelectedAlpha:0,buttonIdleAlpha:0,buttonHoverAlpha:0},i=new n.Button({onClick:this.drawMissionOptions,...e,text:"Campaign"});this.choices.addChild(i);const r=new n.Button({onClick:this.goToMultiplayerScene,...e,text:"Versus CPU"});this.choices.addChild(r),r.position.set(0,i.height)},this.drawMissionOptions=()=>{this.clearFromAll();const{missionOffset:t}=d.options.choices;this.choices.position.set(t.x,t.y);const e=r.Assets.get("spritesheet"),{textures:i}=e,s={text:"",fontSize:32,textColor:16777215,textColorHover:16776960,shadowTextColor:8388736,shadowThickness:2,buttonIdleAlpha:0,buttonSelectedAlpha:0,buttonHoverAlpha:0},o=new n.Button({iconTexture:i["icon-home.png"],onClick:this.drawMainOptions,...s,text:"Home",buttonWidth:200,buttonHeight:50,iconScale:1,iconColor:16777215,iconColorHover:16776960,fontSize:48});this.choices.addChild(o),[0,1,2].forEach((t=>{const e=new n.Button({onClick:()=>{this.goToCampaignScene(t)},...s,text:`Mission ${t+1}`});e.position.set(0,this.choices.height),this.choices.addChild(e)}))},this.goToCampaignScene=t=>{s.SceneManager.changeScene({name:"campaign",newScene:new h.CampaignScene({app:s.SceneManager.app,viewWidth:s.SceneManager.width,viewHeight:s.SceneManager.height,missionIdx:t}),initialResize:!1}).catch(console.error)},this.goToMultiplayerScene=()=>{},this.setup(t),this.drawMainOptions(),setTimeout((()=>{a.TileMap.idleLoad().catch(console.error)}),1e3)}setup({menuTexture:t}){const e=new r.Sprite(t);this.addChild(e),this.background=e,this.addChild(this.choices)}clearFromAll(){for(;this.choices.children.length>0;)this.choices.children[0].removeFromParent()}handleResize({viewWidth:t,viewHeight:e}){const i=t,r=e,{width:s,height:n}=this.background.texture,a=s,h=n;let d=1;h>=a?r<h&&(d=r/h,d*a>i&&(d=i/a),(0,o.logLayout)(`By height (sc=${d})`)):i<a&&(d=i/a,d*h>r&&(d=r/h),(0,o.logLayout)(`By width (sc=${d})`));const l=Math.floor(a*d),c=Math.floor(h*d),p=i>l?(i-l)/2:0,u=r>c?(r-c)/2:0;(0,o.logLayout)(`aw=${i} (ow=${l}) x=${p} ah=${r} (oh=${c}) y=${u}`),this.x=p,this.width=l,this.y=u,this.height=c,(0,o.logLayout)(`x=${p} y=${u} w=${this.width} h=${this.height}`)}handleUpdate(t){}}d.options={choices:{mainOffset:{x:50,y:320},missionOffset:{x:50,y:50}}},e.MenuScene=d},3301:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MiniMap=void 0;const r=i(8687),s=i(5473),o=i(3200),n=i(7697);class a extends r.Container{constructor(t){super(),this.rebuildRequired=!0,this.pointerDownX=-1,this.pointerDownY=-1,this.border=new r.Graphics,this.backgroundContainer=new r.Container,this.background=new r.Sprite,this.cameraRect=new r.Graphics,this.activeItems=new r.Container,this.handlePointerDown=t=>{if(this.game.gameEnded)return;const e=this.background.toLocal(t);if(this.pointerDownX=e.x,this.pointerDownY=e.y,(0,s.logPointerEvent)(`MiniMap pdX=${this.pointerDownX} pdX=${this.pointerDownY} down`),this.pointerDownX>-1&&this.pointerDownY>-1)if(e.x>=this.cameraRect.x&&e.x<=this.cameraRect.x+this.cameraRect.width&&e.y>=this.cameraRect.y&&e.y<=this.cameraRect.y+this.cameraRect.height);else{const t=e.x-.5*this.cameraRect.width,i=e.y-.5*this.cameraRect.height;this.game.tileMap.goTo({x:t,y:i})}},this.handlePointerUp=t=>{this.game.gameEnded||(this.pointerDownX=this.pointerDownY=-1,(0,s.logPointerEvent)(`MiniMap pdX=${this.pointerDownX} pdX=${this.pointerDownY} up`))},this.handlePointerMove=t=>{if(!this.game.gameEnded&&this.pointerDownX>-1&&this.pointerDownY>-1){const e=this.background.toLocal(t);(0,s.logPointerEvent)(`MiniMap pdX=${this.pointerDownX} pdX=${this.pointerDownY} mX=${e.x} mY=${e.y}`),this.game.tileMap.goDiff({diffX:e.x-this.pointerDownX,diffY:e.y-this.pointerDownY}),this.pointerDownX=e.x,this.pointerDownY=e.y}},this.handlePointerLeave=t=>{this.game.gameEnded||(this.pointerDownX=this.pointerDownY=-1,(0,s.logPointerEvent)(`Game pdX=${this.pointerDownX} pdX=${this.pointerDownY} up`))},this.game=t.game,this.initWidth=t.initWidth,this.initHeight=t.initHeight,this.setup(),this.draw(),this.addEventLesteners()}setup(){this.addChild(this.border),this.background.addChild(this.cameraRect),this.background.addChild(this.activeItems),this.backgroundContainer.addChild(this.background);const{borderWidth:t}=a.options;this.backgroundContainer.position.set(t,t),this.addChild(this.backgroundContainer)}draw(){const{initWidth:t,initHeight:e}=this,{borderColor:i,backgroundColor:r,borderWidth:s}=a.options;this.border.beginFill(i),this.border.drawRect(0,0,t,e),this.border.endFill(),this.border.beginFill(r),this.border.drawRect(s,s,t-2*s,e-2*s),this.border.endFill()}addEventLesteners(){this.background.eventMode="static",this.background.on("pointerdown",this.handlePointerDown),this.background.on("pointerup",this.handlePointerUp),this.background.on("pointermove",this.handlePointerMove),this.background.on("pointerleave",this.handlePointerLeave)}assignBackgroundTexture({texture:t,camX:e,camY:i}){this.background.texture=t,this.fit({texture:t}),this.drawCameraRect(),this.updateCameraRect({camX:e,camY:i})}handleUpdate({camX:t,camY:e}){this.updateCameraRect({camX:t,camY:e}),this.updateItems()}handleResize({viewWidth:t,viewHeight:e,camX:i,camY:r}){this.drawCameraRect(),this.updateCameraRect({camX:i,camY:r})}fit({texture:t}){const{initWidth:e,initHeight:i}=this,{borderWidth:r}=a.options,{width:s,height:o}=t,n=e-2*r,h=i-2*r;let d=1;d=s>=o?n/s:h/o,this.background.scale.set(d);const{width:l,height:c}=this.background,p=n>l?(n-l)/2:0,u=h>c?(h-c)/2:0;this.background.x=p,this.background.y=u}drawCameraRect(){const{cameraRectColor:t,cameraRectThickness:e}=a.options;this.cameraRect.clear(),this.cameraRect.beginFill(t);const{width:i,height:r}=this.game.camera,{scale:{x:s,y:o}}=this.game.tileMap,n=i/s,h=r/o,{scale:{x:d,y:l}}=this.background,c=e/d,p=e/l;this.cameraRect.drawRect(0,0,n,h),this.cameraRect.endFill(),this.cameraRect.beginHole(),this.cameraRect.drawRect(c,p,n-2*c,h-2*p),this.cameraRect.endHole()}updateCameraRect({camX:t=0,camY:e=0}){this.cameraRect.position.set(t,e)}updateItems(){this.rebuildRequired&&this.drawItems()}getItemColor(t){const{itemBlueTeamClor:e,itemGreeTeamClor:i,itemBlueTeamAttackClor:r,itemGreenTeamAttackClor:s}=a.options;return"attack"===t.order.type?t.team===o.Team.blue?r:s:t.team===o.Team.blue?e:i}drawItems(){for(;this.activeItems.children.length>0;)this.activeItems.children[0].removeFromParent();const{width:t,height:e}=this.background.texture,i=0+t,s=0+e,{activeItems:o}=this.game.tileMap;for(let t=0;t<o.children.length;t++){const e=o.children[t],a=new r.Graphics;a.beginFill(this.getItemColor(e));const h=e.getCollisionBounds();h.left<0&&h.right<0||h.left>i&&h.right>i||h.top<0&&h.bottom<0||h.top>s&&h.bottom>s||(e.type===n.EItemType.buildings?a.drawRect(0,0,h.right-h.left,h.bottom-h.top):e.type!==n.EItemType.vehicles&&e.type!==n.EItemType.airVehicles||a.drawCircle(0,0,(h.right-h.left)/2),a.endFill(),a.position.set(h.left,h.top),this.activeItems.addChild(a))}}}a.options={borderColor:4539717,backgroundColor:4741996,borderWidth:2,cameraRectColor:12690711,cameraRectThickness:2,itemBlueTeamClor:255,itemBlueTeamAttackClor:16711680,itemGreeTeamClor:65280,itemGreenTeamAttackClor:16711680},e.MiniMap=a},8350:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Order=void 0;const r=i(8687),s=i(3200),o=i(7697),n=i(4536),a=i(1097);class h extends r.Graphics{constructor({item:t}){super(),this.item=t}getLineColor(t){switch(t){case"move":case"follow":return 65280;case"attack":case"move-and-attack":return 16711680;case"patrol":return 16776960;case"guard":return 255;case"build":case"deploy":return 16711935;default:return 16777215}}getDestinationColor(t){switch(t){case"move":case"move-and-attack":case"follow":return 65280;case"attack":return 16711680;case"patrol":return 65535;case"guard":return 255;case"build":case"deploy":return 16711935;default:return 16777215}}getFromRadius(t){return"patrol"===t?3:0}getDestinationRadius(t){switch(t){case"attack":case"guard":case"follow":return 15;case"build":case"deploy":return 0;default:return 3}}drawOrder({selectedItem:t,tileMap:e}){const i=t.getCollisionPosition({center:!0});let r,s;switch(t.order.type){case"move":case"move-and-attack":case"build":case"deploy":r=i,s={x:t.order.toPoint.gridX*e.gridSize,y:t.order.toPoint.gridY*e.gridSize};break;case"attack":case"follow":case"guard":{const e=t.order.to;(null==e?void 0:e.isAlive())&&(r=i,s=e.getCollisionPosition({center:!0}));break}case"patrol":r={x:t.order.fromPoint.gridX*e.gridSize,y:t.order.fromPoint.gridY*e.gridSize},s={x:t.order.toPoint.gridX*e.gridSize,y:t.order.toPoint.gridY*e.gridSize}}if(null!=this.buildSprite&&(this.buildSprite.visible=!1),null==r||null==s)return void this.clear();const{type:o}=t.order,{dash:n,gap:a,lineWidth:d}=h.options;this.clear(),this.lineStyle({width:d,color:this.getLineColor(o)}),this.drawCircle(r.x,r.y,this.getFromRadius(o));const l=Math.hypot(s.x-r.x,s.y-r.y),c=(s.x-r.x)/l,p=(s.y-r.y)/l;this.moveTo(r.x,r.y).lineTo(r.x+n*c,r.y+n*p);let u=n+a;for(;u<l;)this.moveTo(r.x+u*c,r.y+u*p),u+=n,u>l?(u=l,this.lineTo(r.x+u*c,r.y+u*p)):(this.lineTo(r.x+u*c,r.y+u*p),u+=a);this.lineStyle({width:d,color:this.getDestinationColor(o)}),this.drawCircle(s.x,s.y,this.getDestinationRadius(o)),this.endFill(),this.alpha=.5,this.drawOrderSprite({selectedItem:t,tileMap:e,to:s})}drawOrderSprite({selectedItem:t,tileMap:e,to:i}){let h,d={x:0,y:0};"build"===t.order.type&&(t.order.name===o.EItemName.GroundTurret?(h=t.team===s.Team.blue?n.GroundTurret.blueTextures.downRightTextures[0]:n.GroundTurret.greenTextures.downRightTextures[0],d=n.GroundTurret.collisionOptions.offset):t.order.name===o.EItemName.Starport&&(h=t.team===s.Team.blue?a.Starport.blueTextures.healthyTextures[0]:a.Starport.greenTextures.healthyTextures[0],d=a.Starport.collisionOptions.offset)),null!=h&&(null==this.buildSprite&&(this.buildSprite=new r.Sprite,this.addChild(this.buildSprite)),this.buildSprite.texture=h,this.buildSprite.position.set(Math.floor(i.x/e.gridSize)*e.gridSize-d.x,Math.floor(i.y/e.gridSize)*e.gridSize-d.y),this.buildSprite.visible=!0)}}h.options={dash:16,gap:8,lineWidth:1},e.Order=h},9060:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Firework=void 0;const r=i(8687);class s extends r.Sprite{constructor({texture:t}){super(t),this.markedForDeletion=!1,this.velocity={vx:0,vy:0}}handleUpdate(){this.x-=this.velocity.vx,this.y-=this.velocity.vy,this.alpha*=.99,this.alpha<.1&&(this.markedForDeletion=!0)}}class o extends s{static prepareTextures({textures:t}){o.textures=t}constructor(){super({texture:o.textures.texture}),this.width=this.height=10*Math.random()+10,this.velocity.vx=10*Math.random()-5,this.velocity.vy=2*Math.random()+1,this.tint=16777215*Math.random()<<0}handleUpdate(){this.velocity.vy-=o.options.gravity,super.handleUpdate()}static prepareGraphics(){const t=new r.Graphics;return t.beginFill(16777215),t.drawCircle(0,0,o.options.renderRadius),t.endFill(),t.cacheAsBitmap=!0,t}}o.options={gravity:.08,renderRadius:100},e.Firework=o},9759:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ReloadBar=void 0;const r=i(8687);class s extends r.Container{constructor(t){super(),this.setup()}setup(){const t=new r.Graphics;this.addChild(t),this.fillBar=t}draw({fillColor:t,width:e,height:i,alpha:r}){this.maxWidth=e;const{fillBar:s}=this;s.beginFill(t),s.drawRect(0,0,e,i),s.endFill(),s.alpha=r}updateReload(t){this.fillBar.width=this.maxWidth*t}}e.ReloadBar=s},3110:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SceneManager=void 0;const r=i(8687),s=i(5473);class o extends r.Container{init(){}handleUpdate(){}handleResize(){}}class n{constructor(){}static get width(){return window.innerWidth}static get height(){return window.innerHeight}static async initialize(){var t;const e=new r.Application({autoDensity:!0,resolution:null!==(t=window.devicePixelRatio)&&void 0!==t?t:1,width:n.width,height:n.height,resizeTo:window});document.body.appendChild(e.view),s.logApp.enabled&&((0,s.logApp)("window.app initialized!"),window.app=e),n.app=e,n.setupEventLesteners()}static setupEventLesteners(){window.addEventListener("resize",n.resizeDeBounce),n.app.ticker.add(n.updateHandler)}static async changeScene({name:t,newScene:e,initialResize:i=!0}){if(null!=e?n.scenes.has(t)||n.scenes.set(t,e):e=n.scenes.get(t),null==e)throw new Error("Unable to detect new scene");n.app.stage.removeChild(n.currentScene),n.currentScene=e,n.app.stage.addChild(n.currentScene),i&&n.resizeHandler(),"function"==typeof e.mountedHandler&&e.mountedHandler()}static resizeDeBounce(){n.cancelScheduledResizeHandler(),n.scheduleResizeHandler()}static cancelScheduledResizeHandler(){clearTimeout(n.resizeTimeoutId)}static scheduleResizeHandler(){n.resizeTimeoutId=setTimeout((()=>{n.cancelScheduledResizeHandler(),n.resizeHandler()}),n.resizeTimeout)}static resizeHandler(){n.currentScene.handleResize({viewWidth:n.width,viewHeight:n.height})}static updateHandler(){n.currentScene.handleUpdate(n.app.ticker.deltaMS)}}n.currentScene=new o,n.resizeTimeout=300,n.scenes=new Map,e.SceneManager=n},5285:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SelectableLifeableSquareItem=e.SelectableLifeableRoundItem=void 0;const r=i(8687),s=i(4793);class o extends s.LifeableItem{constructor(t){super(t),this.selectedGraphics=new r.Graphics,this.selected=!1,this.selectable=!0,this.drawSelectionOptions={width:0,height:0,radius:0,strokeWidth:0,strokeColor:0,strokeSecondColor:0,offset:{x:0,y:0}},this.team=t.team,"boolean"==typeof t.selectable&&(this.selectable=t.selectable)}setSelected(t){this.selectedGraphics.alpha=t?.5:0,this.selected=t}drawSelection(){}removeAndDestroy(){super.removeAndDestroy();const t=this.game.isItemSelected(this);this.game.deselectItem(this),t&&this.game.sideBar.handleSelectedItems(this.game.selectedItems)}}e.SelectableLifeableRoundItem=class extends o{drawSelection(){const{offset:t,strokeWidth:e,strokeColor:i,strokeSecondColor:r,radius:s}=this.drawSelectionOptions,{selectedGraphics:o}=this;o.position.set(t.x,t.y);const n=2*Math.PI/8,a=s+e,h=s+e;for(let t=0;t<8;t++){o.beginFill(t%2==0?i:r);const d=n*t,l=n*(t+1),c=s+e;o.moveTo(a+s*Math.cos(d),h+s*Math.sin(d)),o.lineTo(a+c*Math.cos(d),h+c*Math.sin(d)),o.arc(a,h,c,d,l),o.lineTo(a+s*Math.cos(l),h+s*Math.sin(l)),o.arc(a,h,s,l,d,!0),o.endFill()}o.alpha=0}},e.SelectableLifeableSquareItem=class extends o{drawSelection(){const{offset:t,strokeWidth:e,strokeColor:i,strokeSecondColor:r,width:s,height:o}=this.drawSelectionOptions,{selectedGraphics:n}=this;n.position.set(t.x,t.y);const a=s/2,h=o/2;n.beginFill(i),n.drawRect(0,0,a,e),n.endFill(),n.beginFill(r),n.drawRect(a,0,a,e),n.endFill(),n.beginFill(i),n.drawRect(s-e,0,e,h),n.endFill(),n.beginFill(r),n.drawRect(s-e,h,e,h),n.endFill(),n.beginFill(i),n.drawRect(a,o-e,a,e),n.endFill(),n.beginFill(r),n.drawRect(0,o-e,a,e),n.endFill(),n.beginFill(i),n.drawRect(0,h,e,h),n.endFill(),n.beginFill(r),n.drawRect(0,0,e,h),n.endFill(),n.alpha=0}removeAndDestroy(){super.removeAndDestroy(),this.game.tileMap.rebuildPassableRequired=!0}}},2053:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SideBar=void 0;const r=i(8687),s=i(7128),o=i(5473),n=i(9483);class a extends r.Container{constructor(t){var e;super(),this.toX=0,this.toOpen=!1,this.toClose=!1,this.opened=!1,this.closed=!0,this.game=t.game,this.viewWidth=t.viewWidth,this.align=null!==(e=t.align)&&void 0!==e?e:"left",this.setup(t),this.drawStaticContent(),this.drawMask(),this.setAlignment()}setup(t){this.staticContent=new r.Container,this.addChild(this.staticContent),this.hideableContent=new r.Container,this.addChild(this.hideableContent),this.commandsBar=new s.CommandsBar({game:t.game}),this.hideableContent.addChild(this.commandsBar),this.contentMask=new r.Graphics,this.addChild(this.contentMask),"number"==typeof t.initY&&(this.position.y=t.initY)}setAlignment(){"left"===this.align?this.position.x=0:this.position.x=this.viewWidth-this.width}setHideableContentPosition(){this.closed?("left"===this.align?this.hideableContent.position.x=-this.width:this.hideableContent.position.x=this.width,(0,o.logSideBar)(`closed hideable-${this.align} ${this.hideableContent.position.x}`)):this.opened&&("left"===this.align?this.hideableContent.position.x=this.width>this.hideableContent.width?this.width-this.hideableContent.width:0:this.hideableContent.position.x=0,(0,o.logSideBar)(`opened hideable-${this.align} ${this.hideableContent.position.x}`))}calcHideableContentPosition({forceOpen:t=!1,forceClose:e=!1}={}){t?("left"===this.align?this.toX=this.width>this.hideableContent.width?this.width-this.hideableContent.width:0:this.toX=0,(0,o.logSideBar)(`force open hideable-${this.align} toX=${this.toX}`)):e&&("left"===this.align?this.toX=-this.width:this.toX=this.width,(0,o.logSideBar)(`force close hideable-${this.align} toX=${this.toX}`))}getToggleText(){return`${"left"===this.align?">>>":"<<<"}\ncash:\n${this.game.cash[this.game.team]}`}drawStaticContent(){this.toggleButton=new n.Button({text:this.getToggleText(),fontSize:16,textColor:16777215,textColorHover:16776960,shadowTextColor:8388736,shadowThickness:1,buttonWidth:a.options.initWidth,buttonBorderHoverColor:16776960,buttonHoverColor:4539717,buttonIdleColor:4539717,buttonSelectedColor:4539717,buttonBorderWidth:2,buttonBorderColor:1578774,onClick:()=>{this.align="left"===this.align?"right":"left",this.setAlignment(),this.setHideableContentPosition(),this.calcHideableContentPosition({forceOpen:this.toOpen,forceClose:this.toClose})}}),this.staticContent.addChild(this.toggleButton)}drawMask({height:t}={}){const{initWidth:e,initHeight:i}=a.options;this.contentMask.clear(),this.contentMask.beginFill(16777215),this.contentMask.drawRect(0,0,Math.max(e,this.width),null!=t?t:i),this.contentMask.endFill(),this.contentMask.position.set(0,this.staticContent.height),this.hideableContent.position.set(0,this.staticContent.height),this.hideableContent.mask=this.contentMask}handleResize({viewWidth:t,initY:e}){this.viewWidth=t,this.position.y=e}handleUpdate(t){this.toggleButton.text.text=this.getToggleText();const e="left"===this.align;this.toOpen?((0,o.logSideBar)(`update-to-open (${this.hideableContent.position.x}) toX=${this.toX}`),(e?this.hideableContent.position.x>this.toX-.1:this.hideableContent.position.x<this.toX+.1)?(this.hideableContent.position.x=this.toX,this.toOpen=!1,this.opened=!0,this.closed=!1):e?this.hideableContent.position.x+=.1*(this.toX-this.hideableContent.position.x):this.hideableContent.position.x-=.1*(this.hideableContent.position.x-this.toX)):this.toClose&&((0,o.logSideBar)(`update-to-close (${this.hideableContent.position.x}) toX=${this.toX}`),(e?this.hideableContent.position.x<this.toX+.1:this.hideableContent.position.x>this.toX-.1)?(this.hideableContent.position.x=this.toX,this.toClose=!1,this.opened=!1,this.closed=!0):e?this.hideableContent.position.x-=.1*(this.hideableContent.position.x-this.toX):this.hideableContent.position.x+=.1*(this.toX-this.hideableContent.position.x))}handleSelectedItems(t){if((0,o.logSideBar)(`handleSelectedItems (${t.length}) opened=${this.opened} toOpen=${this.toOpen} toClose=${this.toClose}`),t.length>0){const e=this.commandsBar.prepareCommands(t);e&&this.drawMask({height:this.commandsBar.height}),(!this.opened&&!this.toOpen||e)&&this.open()}else(!this.closed||this.opened&&!this.toClose||!this.opened&&this.toOpen)&&this.close()}open(){(0,o.logSideBar)("open()"),this.toOpen=!0,this.toClose=!1,this.setHideableContentPosition(),this.calcHideableContentPosition({forceOpen:!0})}close(){(0,o.logSideBar)("close()"),this.toOpen=!1,this.toClose=!0,this.setHideableContentPosition(),this.calcHideableContentPosition({forceClose:!0})}}a.options={initWidth:70,initHeight:300},e.SideBar=a},6879:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.StartModal=void 0;const r=i(8687),s=i(9483),o=i(9060);class n extends r.Container{static prepareTextures({textures:t}){n.textures=t}constructor(t){super(),this.sucess=!1,this.elapsedSpawnFrames=0,this.spawnFrame=Math.floor(20*Math.random()+60),this.particles=new r.ParticleContainer(300,{position:!0,scale:!0,tint:!0}),this.boxOptions={backgroundColor:4539717,outerBorderColor:4741996,outerBorderWidth:3,width:350,height:250,borderRadius:5},this.reasonTextOptions={top:-50,textColor:12690711,strokeColor:8388736,strokeThickness:1,textSize:20,fontWeight:"bold",lineHeight:30},this.buttonOptions={top:170,leftOne:105,leftTwo:15,paddingLeft:20,paddingTop:15,widthOne:150,widthLeft:150,widthRight:150,height:50,fillRegular:4539717,fillError:10105874,fillSuccess:2278750,borderRadius:10,iconScale:.5},this.buttonTextOptions={top:95,textColor:16777215,textSize:20,textColorHover:16776960},this.setup(t),this.draw(t)}setup(t){this.modalBox=new r.Graphics,this.addChild(this.modalBox);const{boxOptions:e,reasonTextOptions:i}=this;this.reasonText=new r.Text("-",{fontSize:i.textSize,fill:i.textColor,fontWeight:i.fontWeight,fontFamily:"'Courier New', Courier, monospace",align:"center",wordWrap:!0,wordWrapWidth:e.width-2*e.outerBorderWidth,stroke:i.strokeColor,strokeThickness:i.strokeThickness,lineHeight:i.lineHeight}),this.reasonText.anchor.set(.5,.5),this.reasonText.position.set(e.width/2,e.height/2+i.top),this.addChild(this.reasonText)}draw(t){const{boxOptions:{width:e,height:i,backgroundColor:r,outerBorderWidth:s,outerBorderColor:o,borderRadius:n}}=this;let a=0,h=0,d=e,l=i;this.modalBox.beginFill(r),this.modalBox.drawRoundedRect(a,h,d,l,n),this.modalBox.endFill(),a+=s,h+=s,d-=2*s,l-=2*s,this.modalBox.beginFill(o),this.modalBox.drawRoundedRect(a,h,d,l,n),this.modalBox.endFill()}showModal({message:t,success:e,view:i,onLeftClick:r,onRightClick:o}){const{iconHomeTexture:a,iconNextTexture:h,iconRepeatTexture:d}=n.textures,{leftOne:l,leftTwo:c,top:p,fillRegular:u,fillSuccess:m,fillError:g,widthOne:w,widthLeft:f,widthRight:x,height:b,borderRadius:y,paddingTop:T,paddingLeft:v,iconScale:C}=this.buttonOptions,{textSize:S,textColor:A,textColorHover:M}=this.buttonTextOptions;this.sucess=e,this.visible=!0,this.reasonText.text=t;const k={text:"Home",fontSize:S,textColor:A,textColorHover:M,iconColor:A,iconColorHover:M,onClick:r,iconTexture:a,iconScale:C,iconPaddingLeft:v,iconPaddingTop:T,textPaddingLeft:v,textPaddingTop:T,buttonHeight:b,buttonRadius:y},Y={text:"",fontSize:S,textColor:A,textColorHover:M,iconColor:A,iconColorHover:M,onClick:o,iconScale:C,iconPaddingLeft:v,iconPaddingTop:T,textPaddingLeft:v,textPaddingTop:T,buttonIdleColor:e?m:g,buttonWidth:x,buttonHeight:b,buttonRadius:y,initX:c+f+v,initY:p};switch(i){case"home":k.buttonIdleColor=e?m:g,k.buttonWidth=w,k.initX=l,k.initY=p;break;case"home-next":{k.buttonIdleColor=u,k.buttonWidth=f,k.initX=c,k.initY=p,Y.text="Next",Y.iconTexture=h;const t=new s.Button(Y);this.addChild(t);break}case"home-repeat":{k.buttonIdleColor=u,k.buttonWidth=f,k.initX=c,k.initY=p,Y.text="Repeat",Y.iconTexture=d;const t=new s.Button(Y);this.addChild(t);break}}const E=new s.Button(k);this.addChild(E),this.addChild(this.particles)}hideModal(){this.visible=!1}cleanFromAll(){for(this.hideModal();null!=this.particles.children[0];)this.particles.children[0].removeFromParent()}handleUpdate(t){if(this.visible){if(this.particles.children.forEach((t=>{t.handleUpdate()})),this.elapsedSpawnFrames>=this.spawnFrame&&this.sucess){const t={x:Math.random()*this.width,y:Math.random()*this.height};for(let e=0;e<30;e++){const e=new o.Firework;this.particles.addChild(e),e.position.set(t.x,t.y)}this.spawnFrame=Math.floor(20*Math.random()+60),this.elapsedSpawnFrames=0}this.elapsedSpawnFrames+=1;for(let t=0;t<this.particles.children.length;t++){const e=this.particles.children[t];e.markedForDeletion&&(e.removeFromParent(),t--)}}}}e.StartModal=n},8554:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.StatusBar=e.EMessageCharacter=void 0;const r=i(8687),s=i(5473);var o;!function(t){t.system="system",t.op="op",t.pilot="pilot",t.driver="driver"}(o=e.EMessageCharacter||(e.EMessageCharacter={}));class n extends r.Container{constructor(t){super(),this.setupAndDraw(t)}setupAndDraw({texture:t,message:e,time:i,maxWidth:s=0}){const{characterWidth:o,timeTextSize:h,timeTextColor:d}=n.options,l=new r.Sprite(t);l.width=o,l.height=l.scale.x*l.height,this.addChild(l),this.img=l;const c=new r.Text(a.getTimeText(i),{fontSize:h,fill:d});c.position.set(l.x,l.height),this.addChild(c),this.reAppendMessage({maxWidth:s,message:e})}reAppendMessage({maxWidth:t,message:e}){null!=this.msgText&&(e=this.msgText.text,this.msgText.destroy());const{padding:i,messageTextSize:s,messageTextColor:o}=n.options,a=new r.Text(e,{fontSize:s,fill:o,wordWrap:!0,wordWrapWidth:t-this.img.width-2*i});a.position.set(this.img.width+i,0),this.addChild(a),this.msgText=a}}n.options={padding:20,characterWidth:40,timeTextColor:8558242,timeTextSize:12,messageTextColor:12690711,messageTextSize:14};class a extends r.Container{static prepareTextures({textures:t}){a.textures=t}constructor(t){super(),this.scrollToLastMessage=!1,this.pointerDownY=-1,this.handlePointerDown=t=>{const e=this.messageList.toLocal(t);this.pointerDownY=e.y,(0,s.logPointerEvent)(`StatusBar.pointerDownY=${this.pointerDownY} down`)},this.handlePointerUp=()=>{this.pointerDownY=-1,(0,s.logPointerEvent)(`StatusBar.pointerDownY=${this.pointerDownY} up`)},this.handlePointerLeave=()=>{this.pointerDownY=-1,(0,s.logPointerEvent)(`StatusBar.pointerDownY=${this.pointerDownY} leave`)},this.handlePointerMove=t=>{if((0,s.logPointerEvent)(`StatusBar.pointerDownY=${this.pointerDownY} move`),this.pointerDownY>-1){const e=this.messageList.toLocal(t);(0,s.logPointerEvent)(`localPositionX=${e.x} localPositionY=${e.y}`);const i=this.pointerDownY-e.y;this.messageList.pivot.y+=i;const{maxPivot:r}=this,{pivot:o}=this.messageList;o.y<=0?o.y=0:o.y>r&&(o.y=r)}},this.handleWheel=t=>{let e=this.messageList.pivot.y+t.deltaY/10;const{maxPivot:i}=this;e<=0?e=0:e>i&&(e=i),this.messageList.pivot.y=e},this.setup(),this.draw(t),this.addEventLesteners()}static getTimeText(t){const e=Math.trunc(t/36e5),i=Math.trunc((t-e)/6e4),r=Math.trunc((t-e-i)/1e3),s=t=>String(t).padStart(2,"0");return`Time:\n${s(e)}:${s(i)}:${s(r)}`}setup(){const t=new r.Graphics;this.addChild(t),this.graphicsBox=t;const e=new r.Graphics;t.addChild(e),this.graphicsBoxShadow=e;const i=new r.Graphics;t.addChild(i),this.messageListMask=i;const s=new r.Container;t.addChild(s),this.messageList=s}draw({initWidth:t,initHeight:e}){const{options:{backgroundColor:i,outerBorderColor:r,outerBorderWidth:s,innerBorderColor:o,innerBorderWidth:n,innerBorderRadius:h,shadowColor:d,shadowWidth:l,shadowAlpha:c}}=a;let p=0,u=0,m=t,g=e;this.graphicsBox.clear(),this.graphicsBox.beginFill(r),this.graphicsBox.drawRect(p,u,m,g),this.graphicsBox.endFill(),p+=s,u+=s,m-=2*s,g-=2*s,this.graphicsBox.beginFill(o),this.graphicsBox.drawRoundedRect(p,u,m,g,h),this.graphicsBox.endFill(),p+=n,u+=n,m-=2*n,g-=2*n,this.graphicsBox.beginFill(i),this.graphicsBox.drawRoundedRect(p,u,m,g,h),this.graphicsBox.endFill(),this.graphicsBoxShadow.clear(),this.graphicsBoxShadow.position.set(p,u),this.graphicsBoxShadow.lineStyle({width:l,color:d}),this.graphicsBoxShadow.drawRoundedRect(0,0,m,g,h),this.graphicsBoxShadow.endFill(),this.graphicsBoxShadow.alpha=c,p+=h,u+=h,m-=2*h,g-=2*h,this.messageListMask.position.set(p,u),this.drawMask({width:m,height:g}),this.messageList.mask=this.messageListMask,this.messageList.position.set(p,u)}drawMask({width:t,height:e}){const{options:{backgroundColor:i,innerBorderRadius:r}}=a;this.messageListMask.clear(),this.messageListMask.beginFill(i),this.messageListMask.drawRoundedRect(0,0,t,e,r),this.messageListMask.endFill(),this.messageList.mask=this.messageListMask}appendMessage({character:t,message:e,time:i}){let r;switch(t){case o.system:r=a.textures.systemTexture;break;case o.op:r=a.textures.girl1Texture;break;case o.pilot:r=a.textures.girl2Texture;break;case o.driver:r=a.textures.man1Texture}if(null!=this.messageList.mask){const{padding:t}=a.options,s=new n({texture:r,message:e,time:i,maxWidth:this.maxMessageWidth});s.position.set(t,0===this.messageList.height?t:this.messageList.height+2*t),this.messageList.addChild(s);const{maxPivot:o}=this;this.messageList.height>o&&(this.scrollToLastMessage=!0)}}get maxPivot(){const{padding:t}=a.options,e=this.messageList.mask.height-2*t;return this.messageList.height-e}handleUpdate(t){if(this.scrollToLastMessage){const{maxPivot:t}=this;this.messageList.pivot.y<t-.01?this.messageList.pivot.y+=.01*t:this.scrollToLastMessage=!1}}addEventLesteners(){this.eventMode="static",this.on("pointerdown",this.handlePointerDown),this.on("pointermove",this.handlePointerMove),this.on("pointerup",this.handlePointerUp),this.on("pointerleave",this.handlePointerLeave),this.on("wheel",this.handleWheel)}cleanFromAll(){for(;null!=this.messageList.children[0];)this.messageList.children[0].removeFromParent();this.scrollToLastMessage=!1,this.messageList.pivot.y=0}get maxMessageWidth(){return this.messageList.mask.width-2*a.options.padding}setLimit({width:t,height:e}){if(this.width===t)return;const{padding:i}=a.options,r=[];for(let t=0;t<this.messageList.children.length;t++){const e=this.messageList.children[t];e.removeFromParent(),r.push(e),t--}this.draw({initWidth:t,initHeight:e}),r.forEach((t=>{t.position.set(i,0===this.messageList.height?i:this.messageList.height+2*i),t.reAppendMessage({maxWidth:this.maxMessageWidth}),this.messageList.addChild(t)})),this.messageList.pivot.y=0,this.scrollToLastMessage=!0}}a.options={outerBorderColor:4741996,outerBorderWidth:3,innerBorderColor:1578774,innerBorderWidth:2,innerBorderRadius:3,backgroundColor:4539717,shadowColor:1578774,shadowWidth:3,shadowAlpha:.5,padding:10},e.StatusBar=a},2766:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TeleportableSelectableLifeableRoundItem=void 0;const r=i(5285);class s extends r.SelectableLifeableRoundItem{handleUpdate(t){super.handleUpdate(t),null!=this.teleportGraphics&&(this.teleportGraphics.alpha>0?this.teleportGraphics.alpha-=.01:(this.teleportGraphics.alpha=0,this.teleportGraphics.removeFromParent(),this.teleportGraphics=void 0))}drawTeleport(){const{offset:t,strokeWidth:e,radius:i}=this.drawSelectionOptions,{teleportGraphics:r}=this;if(null!=r){r.position.set(t.x,t.y);const s=i+e,o=i+e;r.beginFill(16777215),r.drawCircle(s,o,i+e),r.endFill()}}}e.TeleportableSelectableLifeableRoundItem=s},665:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TileMap=void 0;const r=i(8687),s=i(5502),o=i(1519),n=i(1557),a=i(7697),h=i(5473),d=i(9078);class l extends r.Container{}class c extends r.Container{constructor(t){super(),this.currentMapTerrainGrid=[],this.rebuildPassableRequired=!1,this._currentMapPassableGrid=[],this._currentMapBuildableGrid=[],this._currentCopyMapPassableGrid=[],this.hitboxes=new o.Hitboxes,this.activeItems=new l,this.orders=new r.Container,this.projectiles=new r.Container,this.background=new r.Sprite,this.minXPivot=0,this.maxXPivot=0,this.minYPivot=0,this.maxYPivot=0,this.minScale=0,this.maxScale=0,this.game=t.game,this.setup(),"number"==typeof t.initX&&(this.position.x=t.initX),"number"==typeof t.initY&&(this.position.y=t.initY)}setup(){this.addChild(this.background),this.addChild(this.activeItems),this.addChild(this.hitboxes),this.addChild(this.orders),this.addChild(this.projectiles)}static async idleLoad(){await r.Assets.loadBundle(n.manifest.bundles.map((t=>t.name)).filter(((t,e)=>e>0)))}initLevel({mapImageSrc:t,mapSettingsSrc:e,viewWidth:i,viewHeight:o}){const n=r.Assets.get(t),a=r.Assets.get(e);this.background.texture=n,this.background.scale.set(1,1),this.background.pivot.set(0,0);const d=s.MapSettings.mapTilesToPositions({mapSettings:a,layerName:"Water,Clay,Lava,Rock-Fence"});this.gridSize=a.tilewidth,this.mapGridWidth=a.width,this.mapGridHeight=a.height,this.currentMapTerrainGrid=[];for(let t=0;t<this.mapGridHeight;t++){this.currentMapTerrainGrid[t]=[];for(let e=0;e<this.mapGridWidth;e++){const i=e*a.tilewidth,r=t*a.tileheight,s=d.some((t=>t.x===i&&t.y===r));this.currentMapTerrainGrid[t][e]=s?1:0}}if(this.hitboxes.alpha=.3,h.logGrid.enabled)for(let t=0;t<this.mapGridWidth;t++)for(let e=0;e<this.mapGridHeight;e++){const i=new r.Graphics;i.beginFill(16777215),i.position.set(t*this.gridSize,e*this.gridSize),i.drawRect(0,0,this.gridSize,this.gridSize),i.endFill(),i.beginHole(),i.drawRect(1,1,this.gridSize-2,this.gridSize-2),i.endHole();const s=new r.Text(`x=${t}\ny=${e}`,{fontSize:20,fill:16776960,align:"center"});s.anchor.set(.5,.5),s.position.set(this.gridSize/2,this.gridSize/2),s.scale.set(.4),i.addChild(s),i.alpha=.3,this.background.addChild(i)}this._currentMapPassableGrid=[],this._currentMapBuildableGrid=[],this.rebuildPassableRequired=!0,this.calcScaleLimits(),this.calcPivotLimits()}handleResize({viewWidth:t,viewHeight:e}){this.calcScaleLimits(),this.checkScaleLimits(),this.calcPivotLimits(),this.checkPivotLimits()}calcPivotLimits(){const{width:t,height:e}=this.game.camera,{scale:i}=this,{width:r,height:s}=this.background,o=r*i.x,n=s*i.y;this.maxXPivot=o>t?(o-t)/i.x:0,this.minXPivot=0,this.maxYPivot=n>e?(n-e)/i.y:0,this.minYPivot=0}calcScaleLimits(){const{width:t,height:e}=this.game.camera,{maxScaleRatio:i}=c.options,{width:r,height:s}=this.background;this.minScale=1,this.maxScale=i*Math.min(r/t,s/e)}checkScaleLimits(){const{scale:t}=this;t.x<this.minScale?t.x=this.minScale:t.x>this.maxScale&&(t.x=this.maxScale),t.y<this.minScale?t.y=this.minScale:t.y>this.maxScale&&(t.y=this.maxScale)}cleanFromAll(){for(this.pivot.set(0,0),this.hitboxes.clear();null!=this.activeItems.children[0];)this.activeItems.children[0].removeFromParent();for(;null!=this.projectiles.children[0];)this.projectiles.children[0].removeFromParent();for(;null!=this.orders.children[0];)this.orders.children[0].removeFromParent()}handleUpdate(t){const e=this.allItems;for(const i of e)i.handleUpdate(t);this.game.tileMap.activeItems.sortChildren();const i=this.game.sideBar.commandsBar.getSelectedCommandName();i===d.ECommandName.buildTurret||i===d.ECommandName.buildStarport||h.logHitboxes.enabled?(this.rebuildBuildableGrid(),this.hitboxes.draw({currentMapBuildableGrid:this.currentMapBuildableGrid,tileWidth:this.gridSize,tileHeight:this.gridSize,borderWidth:2}),this.hitboxes.visible=!0):this.hitboxes.visible=!1}addItem(t){t.type===a.EItemType.buildings||t.type===a.EItemType.vehicles||t.type===a.EItemType.airVehicles?this.activeItems.addChild(t):t.type===a.EItemType.projectiles&&this.projectiles.addChild(t)}get moveableItems(){return[...this.activeItems.children.filter((t=>t.type===a.EItemType.vehicles||t.type===a.EItemType.airVehicles))]}get groundItems(){return[...this.activeItems.children.filter((t=>t.type===a.EItemType.vehicles))]}get airItems(){return[...this.activeItems.children.filter((t=>t.type===a.EItemType.airVehicles))]}get staticItems(){return[...this.activeItems.children.filter((t=>t.type===a.EItemType.buildings))]}get allItems(){return[...this.activeItems.children,...this.projectiles.children]}getTeamMoveableItems(t){return this.moveableItems.filter((e=>e.team===t))}getTeamStaticItems(t){return this.staticItems.filter((e=>e.team===t))}itemUnderPointer(t){const e=e=>{const i=e.getCollisionBounds();return!!(e.isAlive()&&t.x>=i.left&&t.x<=i.right&&t.y>=i.top&&t.y<=i.bottom)},i=this.moveableItems.find(e);return null!=i?i:this.staticItems.find(e)}get currentMapPassableGrid(){return this.rebuildPassableRequired&&(this.rebuildPassableGrid(),this.rebuildPassableRequired=!1),this._currentMapPassableGrid}get currentMapBuildableGrid(){return this._currentMapBuildableGrid}get currentCopyMapPassableGrid(){const{currentMapPassableGrid:t}=this;this._currentCopyMapPassableGrid.length=t.length;for(let e=0;e<t.length;e++){Array.isArray(this._currentCopyMapPassableGrid[e])?this._currentCopyMapPassableGrid[e].length=t[e].length:this._currentCopyMapPassableGrid[e]=new Array(t[e].length);for(let i=0;i<t[e].length;i++)this._currentCopyMapPassableGrid[e][i]=t[e][i]}return this._currentCopyMapPassableGrid}rebuildPassableGrid(){this._currentMapPassableGrid=this.currentMapTerrainGrid.map((t=>t.slice()));const{staticItems:t}=this;for(let e=t.length-1;e>=0;e--){const i=t[e],{passableGrid:r}=i,s=i.getGridXY({floor:!0});for(let t=r.length-1;t>=0;t--)for(let e=r[t].length-1;e>=0;e--)0!==r[t][e]&&(this._currentMapPassableGrid[s.gridY+t][s.gridX+e]=1)}}rebuildBuildableGrid(t){this._currentMapBuildableGrid=this.currentMapTerrainGrid.map((t=>t.slice()));const{activeItems:e}=this,{tileMap:{mapGridWidth:i,mapGridHeight:r}}=this.game;for(let s=e.children.length-1;s>=0;s--){const o=e.children[s];if(o.type===a.EItemType.buildings||o.type===a.EItemType.terrain){const t=o.getGridXY(),{buildableGrid:e}=o;for(let i=e.length-1;i>=0;i--)for(let r=e[i].length-1;r>=0;r--)1===e[i][r]&&(this._currentMapBuildableGrid[t.gridY+i][t.gridX+r]=1)}else if(o.type===a.EItemType.vehicles&&o!==t){const t=o.getGridCollisionBounds(),e=t.leftGridX,s=t.rightGridX,n=t.topGridY,a=t.bottomGridY;for(let t=e;t<=s;t++)for(let e=n;e<=a;e++)t<0||t>=i||e<0||e>=r||(this._currentMapBuildableGrid[e][t]=1)}}}getItemByUid(t,e){return(null!=e?e:this.activeItems.children).find((e=>e.uid===t))}isItemsDead(t){Array.isArray(t)||(t=[t]);const{activeItems:e}=this;return t.some((t=>{const i=this.getItemByUid(t,e.children);return null==i||i.isDead()}))}goTo({x:t,y:e}){const{pivot:i}=this;i.x=t,i.y=e,this.checkPivotLimits()}goDiff({diffX:t,diffY:e}){const{pivot:i}=this;i.x+=t,i.y+=e,this.checkPivotLimits()}checkPivotLimits(){const{pivot:t}=this;t.x<this.minXPivot?t.x=this.minXPivot:t.x>this.maxXPivot&&(t.x=this.maxXPivot),t.y<this.minYPivot?t.y=this.minYPivot:t.y>this.maxYPivot&&(t.y=this.maxYPivot)}zoom({scaleFactor:t,sX:e=0,sY:i=0}){const r=Math.abs(t),{pivot:{x:s,y:o},scale:{x:n}}=this,a=e-s,h=i-o;let d;d=t>=0?n*r:n/r,d<this.minScale?d=this.minScale:d>this.maxScale&&(d=this.maxScale);const l=n/d;let c,p;c=a*l,p=h*l;const u=s+(t>=0?1:-1)*Math.abs(a-c),m=o+(t>=0?1:-1)*Math.abs(h-p);this.scale.set(d,d),this.pivot.set(u,m),this.checkScaleLimits(),this.calcPivotLimits(),this.checkPivotLimits()}}c.options={maxScaleRatio:5},e.TileMap=c},6103:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TopBar=void 0;const r=i(8687),s=i(8554),o=i(3301);class n extends r.Container{constructor(t){super(),this.setup(t)}setup({game:t}){const{statusBarWidth:e,miniMapWidth:i,initHeight:r}=n.options;this.statusBar=new s.StatusBar({initWidth:e,initHeight:r}),this.addChild(this.statusBar),this.miniMap=new o.MiniMap({game:t,initWidth:i,initHeight:r}),this.addChild(this.miniMap),this.miniMap.position.set(this.statusBar.width,0)}handleResize({viewWidth:t,viewHeight:e,camX:i,camY:r}){const{statusBarWidth:s,miniMapWidth:o,initHeight:a}=n.options,h=t-o,d=h>s?(h-s)/2:0;this.statusBar.position.set(d,0);const l=h>s?s:h;this.statusBar.setLimit({width:l,height:a}),this.miniMap.x=t-this.miniMap.width,this.miniMap.handleResize({viewWidth:t,viewHeight:e,camX:i,camY:r})}handleUpdate(t){this.statusBar.handleUpdate(t.deltaMS),this.miniMap.handleUpdate(t)}}n.options={statusBarWidth:600,miniMapWidth:150,initHeight:100},e.TopBar=n},5317:(t,e)=>{var i;Object.defineProperty(e,"__esModule",{value:!0}),e.createTrigger=e.ConditionalTrigger=e.IntervalTrigger=e.TimedTrigger=e.ETriggerType=void 0,function(t){t.timed="timed",t.interval="interval",t.conditional="conditional"}(i=e.ETriggerType||(e.ETriggerType={}));class r{constructor({time:t,action:e}){this.type=i.timed,this.time=t,this.action=e}}e.TimedTrigger=r;class s{constructor({interval:t,action:e}){this.type=i.interval,this.elapsedTime=0,this.interval=t,this.action=e}isElapsed(t){return this.elapsedTime>=this.interval?(this.elapsedTime=0,!0):(this.elapsedTime+=t,!1)}}e.IntervalTrigger=s;class o{constructor({action:t,condition:e}){this.type=i.conditional,this.action=t,this.condition=e}}e.ConditionalTrigger=o,e.createTrigger=function(t){switch(t.type){case i.timed:return new r(t);case i.interval:return new s(t);case i.conditional:return new o(t)}}},6865:(t,e)=>{var i;Object.defineProperty(e,"__esModule",{value:!0}),e.Vector=e.EVectorDirection=void 0,function(t){t[t.up=0]="up",t[t.upRight=1]="upRight",t[t.right=2]="right",t[t.downRight=3]="downRight",t[t.down=4]="down",t[t.downLeft=5]="downLeft",t[t.left=6]="left",t[t.upLeft=7]="upLeft"}(i=e.EVectorDirection||(e.EVectorDirection={})),e.Vector=class{constructor(t){this.directions=Object.keys(i).map(Number).filter(Number.isInteger).length,this.setDirection(t)}setDirection({direction:t}){this.direction=t}}},671:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AirVehicle=void 0;const r=i(8687),s=i(6865),o=i(3200),n=i(7697),a=i(1420),h=i(9078),d=i(2766);var l;!function(t){t.soft="soft",t.hard="hard",t.attraction="attraction"}(l||(l={}));class c extends d.TeleportableSelectableLifeableRoundItem{constructor(t){super(t),this.commands=[h.ECommandName.moveFollow,h.ECommandName.patrol],this.type=n.EItemType.airVehicles,this.drawShadowOptions={offset:{x:0,y:0}},this.bodySpritesContainer=new r.Container,this.shadowSpritesContainer=new r.Container,this.vector=new s.Vector({direction:s.EVectorDirection.down}),this.speed=0,this.moveTurning=!1,this.turnSpeed=0,this.turnFactor=0,this.hardCollision=!1,this.collisionCount=0,this.colliding=!1,this.radius=0,this.followRadius=4,this.elapsedSwitchFrames=0,this.switchFrames=30,null!=t.direction&&this.vector.setDirection({direction:t.direction}),this.setup(t)}setup(t){this.addChild(this.selectedGraphics),this.addChild(this.bodySpritesContainer),this.addChild(this.shadowSpritesContainer),this.addChild(this.collisionGraphics);const{textures:{body:e,shadow:i},teleport:s}=t;!0===s&&(this.teleportGraphics=new r.Graphics,this.addChild(this.teleportGraphics));const o=new r.AnimatedSprite(e.upTextures);this.bodySpritesContainer.addChild(o);const n=new r.AnimatedSprite(e.upRightTextures);this.bodySpritesContainer.addChild(n);const h=new r.AnimatedSprite(e.rightTextures);this.bodySpritesContainer.addChild(h);const d=new r.AnimatedSprite(e.downRightTextures);this.bodySpritesContainer.addChild(d);const l=new r.AnimatedSprite(e.downTextures);this.bodySpritesContainer.addChild(l);const c=new r.AnimatedSprite(e.downLeftTextures);this.bodySpritesContainer.addChild(c);const p=new r.AnimatedSprite(e.leftTextures);this.bodySpritesContainer.addChild(p);const u=new r.AnimatedSprite(e.upLeftTextures);this.bodySpritesContainer.addChild(u),this.bodyAnimation={upAnimation:o,upRightAnimation:n,rightAnimation:h,downRightAnimation:d,downAnimation:l,downLeftAnimation:c,leftAnimation:p,upLeftAnimation:u};const m=new r.AnimatedSprite(i.upTextures);this.shadowSpritesContainer.addChild(m);const g=new r.AnimatedSprite(i.upRightTextures);this.shadowSpritesContainer.addChild(g);const w=new r.AnimatedSprite(i.rightTextures);this.shadowSpritesContainer.addChild(w);const f=new r.AnimatedSprite(i.downRightTextures);this.shadowSpritesContainer.addChild(f);const x=new r.AnimatedSprite(i.downTextures);this.shadowSpritesContainer.addChild(x);const b=new r.AnimatedSprite(i.downLeftTextures);this.shadowSpritesContainer.addChild(b);const y=new r.AnimatedSprite(i.leftTextures);this.shadowSpritesContainer.addChild(y);const T=new r.AnimatedSprite(i.upLeftTextures);this.shadowSpritesContainer.addChild(T),this.shadowAnimation={upAnimation:m,upRightAnimation:g,rightAnimation:w,downRightAnimation:f,downAnimation:x,downLeftAnimation:b,leftAnimation:y,upLeftAnimation:T},this.lifeBar=new a.LifeBar(this.drawLifeBarOptions),this.addChild(this.lifeBar)}hideAllBodyAnimations(){this.bodySpritesContainer.children.forEach((t=>{t.visible=!1}))}hideAllShadowAnimations(){this.shadowSpritesContainer.children.forEach((t=>{t.visible=!1}))}updateAnimation(t=!1){this.switchAnimation(this.vector.direction,t)}switchAnimation(t,e){let i,r;const o=.5;t>=s.EVectorDirection.upLeft+o&&t<=s.EVectorDirection.upLeft+1||t>=s.EVectorDirection.up&&t<=s.EVectorDirection.upRight-o?(i=this.bodyAnimation.upAnimation,r=this.shadowAnimation.upAnimation):t>=s.EVectorDirection.upRight+o&&t<=s.EVectorDirection.downRight-o?(i=this.bodyAnimation.rightAnimation,r=this.shadowAnimation.rightAnimation):t>=s.EVectorDirection.downRight+o&&t<=s.EVectorDirection.downLeft-o?(i=this.bodyAnimation.downAnimation,r=this.shadowAnimation.downAnimation):t>=s.EVectorDirection.downLeft+o&&t<=s.EVectorDirection.upLeft-o?(i=this.bodyAnimation.leftAnimation,r=this.shadowAnimation.leftAnimation):t>s.EVectorDirection.up&&t<s.EVectorDirection.right?(i=this.bodyAnimation.upRightAnimation,r=this.shadowAnimation.upRightAnimation):t>s.EVectorDirection.right&&t<s.EVectorDirection.down?(i=this.bodyAnimation.downRightAnimation,r=this.shadowAnimation.downRightAnimation):t>=s.EVectorDirection.down&&t<s.EVectorDirection.left?(i=this.bodyAnimation.downLeftAnimation,r=this.shadowAnimation.downLeftAnimation):(i=this.bodyAnimation.upLeftAnimation,r=this.shadowAnimation.upLeftAnimation),i!==this.currentBodyAnimation&&e&&(this.currentBodyAnimation=i,this.currentShadowAnimation=r,this.hideAllBodyAnimations(),this.hideAllShadowAnimations(),this.currentBodyAnimation.gotoAndPlay(0),this.currentShadowAnimation.gotoAndPlay(0),this.currentBodyAnimation.visible=!0,this.currentShadowAnimation.visible=!0)}processOrders(){const{tileMap:t}=this.game,e=this.getGridXY({center:!0});switch(this.order.type){case"move":{this.collisionCount=0;const i=Math.pow(this.order.toPoint.gridX-e.gridX,2)+Math.pow(this.order.toPoint.gridY-e.gridY,2);if(i<Math.pow(this.radius/t.gridSize,2))return this.order={type:"float"},!0;{if(this.colliding&&i<Math.pow(5*this.radius/t.gridSize,2)&&(0===this.collisionCount?this.collisionCount=1:this.collisionCount++,this.collisionCount>30))return this.order={type:"float"},!0;const e=Math.pow(i,.5);if(!this._moveTo(this.order.toPoint,e))return this.order={type:"float"},!0}return!0}case"follow":{if(this.order.to.isDead())return null!=this.order.nextOrder?this.order=this.order.nextOrder:this.order={type:"float"},!0;const t=this.order.to.getGridXY({center:!0}),i=Math.pow(t.gridX-e.gridX,2)+Math.pow(t.gridY-e.gridY,2);if(i<Math.pow(this.followRadius,2));else{const t=this.order.to.getGridXY({center:!0});this._moveTo({type:this.order.to.type,...t},i)}return!0}case"patrol":{const i=Math.pow(this.order.toPoint.gridX-e.gridX,2)+Math.pow(this.order.toPoint.gridY-e.gridY,2);if(i<Math.pow(this.sight/t.gridSize,2)){const t=this.order.toPoint;this.order.toPoint=this.order.fromPoint,this.order.fromPoint=t}else this._moveTo(this.order.toPoint,i);return!0}}return!1}handleUpdate(t){super.handleUpdate(t),this.processOrders(),this.elapsedSwitchFrames>=this.switchFrames?(this.updateAnimation(!0),this.elapsedSwitchFrames=0):this.updateAnimation(this.moveTurning||0===this.elapsedSwitchFrames),this.elapsedSwitchFrames+=1,this.zIndex=this.y+this.height}checkCollisionObjects(t){const{tileMap:e,speedAdjustmentFactor:i,speedAdjustmentWhileTurningFactor:r}=this.game,s=this.getGridXY({center:!0}),o=this.speed*i*(this.moveTurning?r:1),n=Math.min(o,t),a=-Math.round(this.vector.direction)/this.vector.directions*2*Math.PI,h=s.gridX-n*Math.sin(a),d=s.gridY-n*Math.cos(a),c=[],{airItems:p}=e;for(let t=p.length-1;t>=0;t--){const i=p[t],r=i.getGridXY({center:!0});if(i!==this&&Math.abs(r.gridX-s.gridX)<3&&Math.abs(r.gridY-s.gridY)<3){const t=Math.pow(r.gridX-h,2)+Math.pow(r.gridY-d,2);t<Math.pow((this.radius+i.radius)/e.gridSize,2)?c.push({collisionType:l.hard,with:{type:i.type,x:r.gridX,y:r.gridY}}):t<Math.pow((1.1*this.radius+i.radius)/e.gridSize,2)&&c.push({collisionType:l.soft,with:{type:i.type,x:r.gridX,y:r.gridY}})}}return c}_moveTo(t,e){const{turnSpeedAdjustmentFactor:i,speedAdjustmentFactor:r,speedAdjustmentWhileTurningFactor:s}=this.game,n=this.getGridXY({center:!0}),a={gridX:Math.round(t.gridX),gridY:Math.round(t.gridY)};let h=(0,o.findAngleGrid)({from:t,to:n,directions:this.vector.directions});const d=this.checkCollisionObjects(e);if(this.colliding=!1,this.hardCollision=!1,d.length>0){this.colliding=!0;const t={x:0,y:0};d.push({collisionType:l.attraction,with:{x:a.gridX,y:a.gridY}});for(let e=d.length-1;e>=0;e--){const i=d[e],r=-(0,o.findAngle)({from:i.with,to:{x:n.gridX,y:n.gridY},directions:this.vector.directions})/this.vector.directions*2*Math.PI;let s;switch(i.collisionType){case l.hard:s=2,this.hardCollision=!0;break;case l.soft:s=1;break;case l.attraction:s=-.5}t.x+=s*Math.sin(r),t.y+=s*Math.cos(r)}h=(0,o.findAngle)({from:t,to:{x:0,y:0},directions:this.vector.directions})}else this.colliding=!1;const c=(0,o.angleDiff)({angle1:this.vector.direction,angle2:h,directions:this.vector.directions}),p=this.turnSpeed*i;Math.abs(c)>p*this.turnFactor?(this.vector.setDirection({direction:(0,o.wrapDirection)({direction:this.vector.direction+p*Math.abs(c)/c,directions:this.vector.directions})}),this.moveTurning=!0):(this.vector.setDirection({direction:h}),this.moveTurning=!1);const u=this.speed*r*(this.moveTurning?s:1);let m=Math.min(u,e);this.hardCollision&&(m=0);const g=-Math.round(this.vector.direction)/this.vector.directions*2*Math.PI,w=-m*Math.sin(g),f=-m*Math.cos(g),x=n.gridX+w,b=n.gridY+f;return this.setPositionByGridXY({gridX:x,gridY:b,center:!0}),!0}setupShadow(){const{offset:t}=this.drawShadowOptions;this.shadowSpritesContainer.position.set(t.x,t.y)}}e.AirVehicle=c},855:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AttackableAirVehicle=void 0;const r=i(9078),s=i(9759),o=i(3200),n=i(7697),a=i(671);class h extends a.AirVehicle{constructor(t){super(t),this.commands=[r.ECommandName.moveFollow,r.ECommandName.attackGuard,r.ECommandName.patrol],this.reloadTimeLeft=0,this.drawReloadBarOptions={alpha:0,width:0,height:0,fillColor:0,offset:{x:0,y:0}},this.canAttack=!1,this.canAttackLand=!1,this.canAttackAir=!1,this.setup(t)}setup(t){super.setup(t),this.reloadBar=new s.ReloadBar(this.drawReloadBarOptions),this.addChild(this.reloadBar)}isValidTarget(t){return t.team!==this.team&&(this.canAttackLand&&(t.type===n.EItemType.buildings||t.type===n.EItemType.vehicles)||this.canAttackAir&&t.type===n.EItemType.airVehicles)}findTargetInSight(t=0){const e=this.getGridXY({center:!0}),i={},r=this.game.tileMap.activeItems.children;for(let s=r.length-1;s>=0;s--){const o=r[s];if(this.isValidTarget(o)){const r=o.getGridXY({center:!0}),s=Math.pow(r.gridX-e.gridX,2)+Math.pow(r.gridY-e.gridY,2);s<Math.pow(this.sight+t,2)&&(Array.isArray(i[s])||(i[s]=[]),i[s].push(o))}}return Object.keys(i).map(Number).sort(((t,e)=>t-e)).map((t=>i[t])).flat()[0]}processOrders(){if("patrol"!==this.order.type&&super.processOrders())return!0;const{tileMap:t,turnSpeedAdjustmentFactor:e}=this.game,i=this.getGridXY({center:!0});switch(this.order.type){case"float":{const t=this.findTargetInSight();return null!=t&&(this.order={type:"attack",to:t}),!0}case"sentry":{const t=this.findTargetInSight(2);return null!=t&&(this.order={type:"attack",to:t,nextOrder:this.order}),!0}case"hunt":{const t=this.findTargetInSight(100);return null!=t&&(this.order={type:"attack",to:t,nextOrder:this.order}),!0}case"attack":{if(null==this.order.to)return!0;if(this.order.to.isDead()||!this.isValidTarget(this.order.to))return null!=this.order.nextOrder?this.order=this.order.nextOrder:this.order={type:"float"},!0;const r=this.order.to.getGridXY({center:!0}),s=Math.pow(r.gridX-i.gridX,2)+Math.pow(r.gridY-i.gridY,2);if(s<Math.pow(this.sight,2)){const s=(0,o.findAngleGrid)({from:r,to:i,directions:this.vector.directions}),n=(0,o.angleDiff)({angle1:this.vector.direction,angle2:s,directions:this.vector.directions}),a=this.turnSpeed*e;if(Math.abs(n)>a)this.vector.setDirection({direction:(0,o.wrapDirection)({direction:this.vector.direction+a*Math.abs(n)/n,directions:this.vector.directions})}),this.moveTurning=!0;else if(this.vector.setDirection({direction:s}),this.moveTurning=!1,this.reloadTimeLeft<=0){const e=this.game.getReloadTime(this.projectile);if("number"==typeof e){this.reloadTimeLeft=e;const r=-this.vector.direction/this.vector.directions*2*Math.PI,o=i.gridX-this.radius*Math.sin(r)/t.gridSize,n=i.gridY-this.radius*Math.cos(r)/t.gridSize,a=this.game.createProjectile({name:this.projectile,initX:o*t.gridSize,initY:n*t.gridSize,direction:s,target:this.order.to});null!=a&&t.addItem(a)}}}else{const t=Math.pow(s,.5);this._moveTo({type:this.order.to.type,...r},t)||(this.order={type:"float"})}return!0}case"patrol":{const e=this.findTargetInSight(1);if(null!=e)return this.order={type:"attack",to:e,nextOrder:this.order},!0;const r=Math.pow(this.order.toPoint.gridX-i.gridX,2)+Math.pow(this.order.toPoint.gridY-i.gridY,2);if(r<Math.pow(this.sight/t.gridSize,2)){const t=this.order.toPoint;this.order.toPoint=this.order.fromPoint,this.order.fromPoint=t}else this._moveTo(this.order.toPoint,r);return!0}case"guard":{if(this.order.to.isDead())return null!=this.order.nextOrder?this.order=this.order.nextOrder:this.order={type:"float"},!0;const t=this.order.to.getGridXY({center:!0}),e=Math.pow(t.gridX-i.gridX,2)+Math.pow(t.gridY-i.gridY,2);if(e<Math.pow(this.followRadius,2)){const t=this.findTargetInSight(1);if(null!=t)return this.order={type:"attack",to:t,nextOrder:this.order},!0;"attack"===this.order.to.order.type&&(this.order={type:"attack",to:this.order.to.order.to,nextOrder:this.order})}else{const t=this.findTargetInSight(1);if(null!=t)this.order={type:"attack",to:t,nextOrder:this.order};else{const t=this.order.to.getGridXY({center:!0});this._moveTo({type:this.order.to.type,...t},e)}}return!0}case"move-and-attack":{const e=this.findTargetInSight();if(null!=e)return this.order={type:"attack",to:e,nextOrder:this.order},!0;const r=Math.pow(this.order.toPoint.gridX-i.gridX,2)+Math.pow(this.order.toPoint.gridY-i.gridY,2);if(r<Math.pow(this.radius/t.gridSize,2))return this.order={type:"float"},!0;const s=Math.pow(r,.5);return this._moveTo(this.order.toPoint,s)||(this.order={type:"float"}),!0}}return!1}handleUpdate(t){this.reloadTimeLeft>0&&(this.reloadTimeLeft-=this.game.reloadAdjustmentFactor),this.updateReload(),super.handleUpdate(t)}drawReloadBar(){this.reloadBar.draw(this.drawReloadBarOptions);const{offset:t}=this.drawReloadBarOptions;this.reloadBar.position.set(t.x,t.y)}updateReload(){const t=this.game.getReloadTime(this.projectile);"number"==typeof t&&this.reloadBar.updateReload((t-this.reloadTimeLeft)/t)}}e.AttackableAirVehicle=h},332:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Chopper=void 0;const r=i(3200),s=i(7697),o=i(855);class n extends o.AttackableAirVehicle{static textures(t){return{body:t===r.Team.blue?n.blueTextures:n.greenTextures,shadow:n.shadowTextures}}static prepareTextures({blueTextures:t,greenTextures:e,shadowTextures:i}){n.blueTextures=t,n.greenTextures=e,n.shadowTextures=i}constructor(t){var e;super({...t,textures:n.textures(t.team)}),this.itemName=s.EItemName.Chopper,this.collisionOptions={width:28,height:28,offset:{x:7,y:5}},this.drawSelectionOptions={width:0,height:0,radius:15,strokeWidth:2,strokeColor:0,strokeSecondColor:16777215,offset:{x:4,y:2}},this.drawLifeBarOptions={borderColor:16777215,borderThickness:1,borderAlpha:.5,width:28,height:5,fillColor:1409085,emptyColor:16711680,offset:{x:7,y:-5}},this.drawReloadBarOptions={alpha:1,width:28,height:2,fillColor:12690711,offset:{x:7,y:0}},this.drawShadowOptions={offset:{x:0,y:40}},this.radius=18,this.speed=25,this.sight=6,this.hitPoints=50,this.turnSpeed=8,this.turnFactor=10,this.projectile=s.EItemName.Rocket,this.canAttack=!0,this.canAttackLand=!0,this.canAttackAir=!1,this.animationSpeed=.2,Array.isArray(t.commands)&&(this.commands=t.commands),this.life=null!==(e=t.life)&&void 0!==e?e:this.hitPoints,this.drawSelectionOptions.strokeColor=t.team===r.Team.blue?255:4243264,this.setupShadow(),this.drawSelection(),this.drawCollision(),this.setPositionByXY({x:t.initX,y:t.initY,center:t.initCenter}),this.drawLifeBar(),this.updateLife(),this.drawReloadBar(),this.updateReload(),this.updateAnimation(),!0===t.teleport&&this.drawTeleport(),Object.values(this.bodyAnimation).concat(Object.values(this.shadowAnimation)).forEach((t=>{t.animationSpeed=this.animationSpeed}))}}n.cost=900,e.Chopper=n},231:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Wraith=void 0;const r=i(3200),s=i(7697),o=i(855);class n extends o.AttackableAirVehicle{static textures(t){return{body:t===r.Team.blue?n.blueTextures:n.greenTextures,shadow:n.shadowTextures}}static prepareTextures({blueTextures:t,greenTextures:e,shadowTextures:i}){n.blueTextures=t,n.greenTextures=e,n.shadowTextures=i}constructor(t){var e;super({...t,textures:n.textures(t.team)}),this.itemName=s.EItemName.Wraith,this.collisionOptions={width:24,height:24,offset:{x:3,y:3}},this.drawSelectionOptions={width:0,height:0,radius:14,strokeWidth:2,strokeColor:0,strokeSecondColor:16777215,offset:{x:-1,y:-1}},this.drawLifeBarOptions={borderColor:16777215,borderThickness:1,borderAlpha:.5,width:24,height:5,fillColor:1409085,emptyColor:16711680,offset:{x:3,y:-8}},this.drawReloadBarOptions={alpha:1,width:24,height:2,fillColor:12690711,offset:{x:3,y:-3}},this.drawShadowOptions={offset:{x:0,y:40}},this.radius=15,this.speed=40,this.sight=8,this.hitPoints=50,this.turnSpeed=4,this.turnFactor=10,this.projectile=s.EItemName.Laser,this.canAttack=!0,this.canAttackLand=!1,this.canAttackAir=!0,Array.isArray(t.commands)&&(this.commands=t.commands),this.life=null!==(e=t.life)&&void 0!==e?e:this.hitPoints,this.drawSelectionOptions.strokeColor=t.team===r.Team.blue?255:4243264,this.setupShadow(),this.drawSelection(),this.drawCollision(),this.setPositionByXY({x:t.initX,y:t.initY,center:t.initCenter}),this.drawLifeBar(),this.updateLife(),this.drawReloadBar(),this.updateReload(),this.updateAnimation(),!0===t.teleport&&this.drawTeleport()}}n.cost=600,e.Wraith=n},6752:(t,e,i)=>{i(7279);const r=i(3110),s=i(1557),o=i(9772);(async function(){var t;const e=document.querySelector(".loader");null!=e&&(null===(t=e.parentElement)||void 0===t||t.removeChild(e)),await r.SceneManager.initialize();const i=new s.LoaderScene({viewWidth:r.SceneManager.width,viewHeight:r.SceneManager.height});await r.SceneManager.changeScene({name:"loader",newScene:i}),await i.initializeLoader();const{menuBackground:n}=i.getAssets();await r.SceneManager.changeScene({name:"menu",newScene:new o.MenuScene({app:r.SceneManager.app,viewWidth:r.SceneManager.width,viewHeight:r.SceneManager.height,menuTexture:n})})})().catch((t=>{var e;console.error(t);const i=document.querySelector(".error-message");null!=i&&(i.classList.remove("hidden"),i.innerText=Boolean(t)&&Boolean(t.message)?t.message:t);const r=document.querySelector(".error-stack");null!=r&&(r.classList.remove("hidden"),r.innerText=Boolean(t)&&Boolean(t.stack)?t.stack:"");const s=document.querySelector("canvas");null!=s&&(null===(e=s.parentElement)||void 0===e||e.removeChild(s))}))},7049:function(t,e,i){var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.AUDIO=void 0;const s=i(1766),o=r(i(8178)),n=r(i(3209)),a=r(i(6844)),h=r(i(6851)),d=r(i(8602)),l=r(i(2980)),c=r(i(2704)),p=r(i(9376)),u=r(i(7822)),m=r(i(9748)),g=r(i(1040)),w=r(i(5286)),f=r(i(2044)),x=r(i(2254)),b=r(i(7574)),y=r(i(3987)),T=r(i(5802)),v=r(i(2763)),C=r(i(7976)),S=r(i(8523)),A=r(i(3534)),M=r(i(9345)),k=r(i(9275)),Y=r(i(651)),E=r(i(6955)),I=r(i(978)),X=r(i(6707)),B=r(i(5061)),P=r(i(5367)),G=r(i(4844)),L=r(i(5563)),D=r(i(4389)),R=r(i(3481)),O=r(i(6349)),H=r(i(3722)),N=r(i(2923)),W=r(i(1689)),F=r(i(9180)),z=r(i(4147)),_=r(i(1241)),V=r(i(2657)),j=r(i(888)),$=r(i(2792)),U=r(i(6947)),q=r(i(6231)),Z=r(i(5234)),J=r(i(5644)),K=r(i(5728)),Q=r(i(5410)),tt=r(i(9799)),et=r(i(5670)),it=r(i(6141)),rt=r(i(5236)),st=r(i(4727)),ot=r(i(5384)),nt=r(i(9422)),at=r(i(4057)),ht=r(i(1117)),dt=r(i(8665)),lt=r(i(3264)),ct=r(i(3512));e.AUDIO={bullet1:new s.Howl({src:o.default}),bullet2:new s.Howl({src:n.default}),bulletHit0:new s.Howl({src:a.default}),bulletHit1:new s.Howl({src:h.default}),bulletHit2:new s.Howl({src:d.default}),bulletHit3:new s.Howl({src:l.default}),bulletHit4:new s.Howl({src:c.default}),bulletHit5:new s.Howl({src:p.default}),cannon1:new s.Howl({src:u.default}),cannon2:new s.Howl({src:m.default}),cannonHit:new s.Howl({src:g.default}),click:new s.Howl({src:w.default}),engaging:new s.Howl({src:f.default}),gun:new s.Howl({src:x.default}),heatseeker1:new s.Howl({src:b.default}),heatseeker2:new s.Howl({src:y.default}),rocketHit0:new s.Howl({src:T.default}),laser1:new s.Howl({src:v.default}),laser2:new s.Howl({src:C.default}),laserHit0:new s.Howl({src:S.default}),message:new s.Howl({src:A.default}),roger1:new s.Howl({src:M.default}),roger2:new s.Howl({src:k.default}),yup:new s.Howl({src:Y.default}),vultureAttack0:new s.Howl({src:E.default}),vultureYes0:new s.Howl({src:I.default}),vultureYes1:new s.Howl({src:X.default}),vultureYes2:new s.Howl({src:B.default}),vultureYes3:new s.Howl({src:P.default}),tankAttack0:new s.Howl({src:G.default}),tankAttack1:new s.Howl({src:L.default}),tankAttack2:new s.Howl({src:D.default}),tankYes0:new s.Howl({src:R.default}),tankYes1:new s.Howl({src:O.default}),tankYes2:new s.Howl({src:H.default}),tankYes3:new s.Howl({src:N.default}),chopperYes0:new s.Howl({src:_.default}),chopperYes1:new s.Howl({src:V.default}),chopperYes2:new s.Howl({src:j.default}),chopperYes3:new s.Howl({src:$.default}),chopperYes4:new s.Howl({src:U.default}),chopperYes5:new s.Howl({src:q.default}),chopperAttack0:new s.Howl({src:W.default}),chopperAttack1:new s.Howl({src:F.default}),chopperAttack2:new s.Howl({src:z.default}),wraithYes0:new s.Howl({src:tt.default}),wraithYes1:new s.Howl({src:et.default}),wraithYes2:new s.Howl({src:it.default}),wraithYes3:new s.Howl({src:rt.default}),wraithAttack0:new s.Howl({src:Z.default}),wraithAttack1:new s.Howl({src:J.default}),wraithAttack2:new s.Howl({src:K.default}),wraithAttack3:new s.Howl({src:Q.default}),scvYes0:new s.Howl({src:st.default}),scvYes1:new s.Howl({src:ot.default}),scvYes2:new s.Howl({src:nt.default}),scvYes3:new s.Howl({src:at.default}),scvYes4:new s.Howl({src:ht.default}),scvYes5:new s.Howl({src:dt.default}),scvYes6:new s.Howl({src:lt.default}),scvError0:new s.Howl({src:ct.default}),play(t){let e=!1,i=[];"acknowledge-attacking"===t?(e=!0,i=[this.engaging]):"acknowledge-moving"===t?(e=!0,i=[this.yup,this.roger1,this.roger2]):"bullet"===t?i=[this.bullet1,this.bullet2]:"bullet-hit"===t?i=[this.bulletHit0,this.bulletHit1,this.bulletHit2,this.bulletHit3,this.bulletHit4,this.bulletHit5]:"rocket"===t?i=[this.heatseeker1,this.heatseeker2]:"rocket-hit"===t?i=[this.rocketHit0]:"laser"===t?i=[this.laser1,this.laser2]:"laser-hit"===t?i=[this.laserHit0]:"cannon-ball"===t?i=[this.cannon1,this.cannon2]:"cannon-hit"===t?i=[this.cannonHit]:"message-received"===t?i=[this.message]:"scout-tank-attack"===t?(e=!0,i=[this.vultureAttack0]):"scout-tank-yes"===t?(e=!0,i=[this.vultureYes0,this.vultureYes1,this.vultureYes2,this.vultureYes3]):"heavy-tank-attack"===t?(e=!0,i=[this.tankAttack0,this.tankAttack1,this.tankAttack2]):"heavy-tank-yes"===t?(e=!0,i=[this.tankYes0,this.tankYes1,this.tankYes2,this.tankYes3]):"chopper-attack"===t?(e=!0,i=[this.chopperAttack0,this.chopperAttack1,this.chopperAttack2]):"chopper-yes"===t?(e=!0,i=[this.chopperYes0,this.chopperYes1,this.chopperYes2,this.chopperYes3,this.chopperYes4,this.chopperYes5]):"wraith-attack"===t?(e=!0,i=[this.wraithAttack0,this.wraithAttack1,this.wraithAttack2,this.wraithAttack3]):"wraith-yes"===t?(e=!0,i=[this.wraithYes0,this.wraithYes1,this.wraithYes2,this.wraithYes3]):"scv-yes"===t?(e=!0,i=[this.scvYes0,this.scvYes1,this.scvYes2,this.scvYes3,this.scvYes4,this.scvYes5,this.scvYes6]):"scv-error"===t&&(e=!0,[this.scvYes0,this.scvYes1,this.scvYes2,this.scvYes3,this.scvYes4,this.scvYes5,this.scvYes6].forEach((t=>t.stop())),i=[this.scvError0]),i.length>0&&(e&&i.forEach((t=>t.stop())),i[Math.floor(Math.random()*i.length)].play())}}},8274:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AttackableBuilding=void 0;const r=i(8687),s=i(9759),o=i(6865),n=i(3200),a=i(7697),h=i(756),d=i(9078);class l extends h.Building{constructor(t){super(t),this.commands=[d.ECommandName.attack],this.reloadTimeLeft=0,this.drawReloadBarOptions={alpha:0,width:0,height:0,fillColor:0,offset:{x:0,y:0}},this.canAttack=!1,this.canAttackLand=!1,this.canAttackAir=!1,this.vector=new o.Vector({direction:o.EVectorDirection.down}),this.moveTurning=!1,this.turnSpeed=0,null!=t.direction&&this.vector.setDirection({direction:t.direction})}setup(t){super.setup(t),this.reloadBar=new s.ReloadBar(this.drawReloadBarOptions),this.addChild(this.reloadBar);const{upTextures:e,upRightTextures:i,rightTextures:o,downRightTextures:n,downTextures:a,downLeftTextures:h,leftTextures:d,upLeftTextures:l}=t.textures,c=new r.AnimatedSprite(e);this.spritesContainer.addChild(c),this.upAnimation=c;const p=new r.AnimatedSprite(i);this.spritesContainer.addChild(p),this.upRightAnimation=p;const u=new r.AnimatedSprite(o);this.spritesContainer.addChild(u),this.rightAnimation=u;const m=new r.AnimatedSprite(n);this.spritesContainer.addChild(m),this.downRightAnimation=m;const g=new r.AnimatedSprite(a);this.spritesContainer.addChild(g),this.downAnimation=g;const w=new r.AnimatedSprite(h);this.spritesContainer.addChild(w),this.downLeftAnimation=w;const f=new r.AnimatedSprite(d);this.spritesContainer.addChild(f),this.leftAnimation=f;const x=new r.AnimatedSprite(l);this.spritesContainer.addChild(x),this.upLeftAnimation=x}switchAnimation(t){let e;switch(t){case h.BuildingAnimation.healthy:{const t=.5,{direction:i}=this.vector;e=i>=o.EVectorDirection.upLeft+t&&i<=o.EVectorDirection.upLeft+1||i>=o.EVectorDirection.up&&i<=o.EVectorDirection.upRight-t?this.upAnimation:i>=o.EVectorDirection.upRight+t&&i<=o.EVectorDirection.downRight-t?this.rightAnimation:i>=o.EVectorDirection.downRight+t&&i<=o.EVectorDirection.downLeft-t?this.downAnimation:i>=o.EVectorDirection.downLeft+t&&i<=o.EVectorDirection.upLeft-t?this.leftAnimation:i>o.EVectorDirection.up&&i<o.EVectorDirection.right?this.upRightAnimation:i>o.EVectorDirection.right&&i<o.EVectorDirection.down?this.downRightAnimation:i>=o.EVectorDirection.down&&i<o.EVectorDirection.left?this.downLeftAnimation:this.upLeftAnimation;break}case h.BuildingAnimation.damaged:e=this.damagedAnimation}e!==this.currentAnimation&&(this.currentAnimation=e,this.hideAllAnimations(),this.currentAnimation.gotoAndPlay(0),this.currentAnimation.visible=!0)}isValidTarget(t){return t.team!==this.team&&(this.canAttackLand&&(t.type===a.EItemType.buildings||t.type===a.EItemType.vehicles)||this.canAttackAir&&t.type===a.EItemType.airVehicles)}findTargetInSight(t=0){const e=this.getGridXY({center:!0}),i={},r=this.game.tileMap.activeItems.children;for(let s=r.length-1;s>=0;s--){const o=r[s];if(this.isValidTarget(o)){const r=o.getGridXY({center:!0}),s=Math.pow(r.gridX-e.gridX,2)+Math.pow(r.gridY-e.gridY,2);s<Math.pow(this.sight+t,2)&&(Array.isArray(i[s])||(i[s]=[]),i[s].push(o))}}return Object.keys(i).map(Number).sort(((t,e)=>t-e)).map((t=>i[t])).flat()[0]}drawReloadBar(){this.reloadBar.draw(this.drawReloadBarOptions);const{offset:t}=this.drawReloadBarOptions;this.reloadBar.position.set(t.x,t.y)}updateReload(){const t=this.game.getReloadTime(this.projectile);"number"==typeof t&&this.reloadBar.updateReload((t-this.reloadTimeLeft)/t)}processOrders(){if(!this.isHealthy())return!1;switch(this.order.type){case"sentry":{const t=this.findTargetInSight();null!=t&&(this.order={type:"attack",to:t,nextOrder:this.order});break}case"attack":{if(null==this.order.to)return!0;const t=this.getGridXY({center:!0}),e=this.order.to.getGridXY({center:!0}),i=Math.pow(e.gridX-t.gridX,2)+Math.pow(e.gridY-t.gridY,2);if(this.order.to.isDead()||!this.isValidTarget(this.order.to)||i>Math.pow(this.sight,2)){const t=this.findTargetInSight();null!=t?this.order.to=t:this.order={type:"sentry"}}if("attack"!==this.order.type||null==this.order.to)return!0;const{turnSpeedAdjustmentFactor:r,tileMap:s}=this.game,o=(0,n.findAngleGrid)({from:e,to:t,directions:this.vector.directions}),a=(0,n.angleDiff)({angle1:this.vector.direction,angle2:o,directions:this.vector.directions}),h=this.turnSpeed*r;if(Math.abs(a)>h)this.vector.setDirection({direction:(0,n.wrapDirection)({direction:this.vector.direction+h*Math.abs(a)/a,directions:this.vector.directions})}),this.moveTurning=!0;else if(this.vector.setDirection({direction:o}),this.moveTurning=!1,this.reloadTimeLeft<=0){const e=this.game.getReloadTime(this.projectile);if("number"==typeof e){this.reloadTimeLeft=e;const i=-Math.round(this.vector.direction)/this.vector.directions*2*Math.PI,r=t.gridX-this.radius*Math.sin(i)/s.gridSize,n=t.gridY-this.radius*Math.cos(i)/s.gridSize,a=this.game.createProjectile({name:this.projectile,initX:r*s.gridSize,initY:n*s.gridSize,direction:o,target:this.order.to});null!=a&&s.addItem(a)}}break}}return!1}handleUpdate(t){this.reloadTimeLeft>0&&(this.reloadTimeLeft-=this.game.reloadAdjustmentFactor),this.processOrders(),this.updateAnimation(),this.updateReload(),this.zIndex=this.y+this.height}}e.AttackableBuilding=l},4539:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Base=e.BaseAnimation=void 0;const r=i(8687),s=i(3200),o=i(756),n=i(7697),a=i(9078),h=i(8554);var d;!function(t){t.constructing="constructing",t.healthy="healthy",t.damaged="damaged"}(d=e.BaseAnimation||(e.BaseAnimation={}));class l extends o.Building{static textures(t){return t===s.Team.blue?l.blueTextures:l.greenTextures}static prepareTextures({blueTextures:t,greenTextures:e}){l.blueTextures=t,l.greenTextures=e}constructor(t){var e;super({...t,textures:l.textures(t.team)}),this.itemName=n.EItemName.Base,this.commands=[a.ECommandName.constructSCV,a.ECommandName.constructHarvester],this.collisionOptions={width:40,height:40,offset:{x:0,y:20}},this.drawSelectionOptions={width:44,height:44,radius:0,strokeWidth:2,strokeColor:0,strokeSecondColor:16777215,offset:{x:-2,y:18}},this.drawLifeBarOptions={borderColor:16777215,borderThickness:1,borderAlpha:.5,width:40,height:5,fillColor:1409085,emptyColor:16711680,offset:{x:0,y:-2}},this.sight=4,this.hitPoints=500,this.life=this.hitPoints,this.constructingAnimationSpeed=.1,this.buildableGrid=[[1,1],[1,1]],this.passableGrid=[[1,1],[1,1]],Array.isArray(t.commands)&&(this.commands=t.commands),this.life=null!==(e=t.life)&&void 0!==e?e:this.hitPoints,this.drawSelectionOptions.strokeColor=t.team===s.Team.blue?255:65280,this.drawSelection(),this.drawCollision(),this.setPositionByXY({x:t.initX,y:t.initY}),this.drawLifeBar(),this.updateLife(),this.constructingAnimation.animationSpeed=this.constructingAnimationSpeed,this.updateAnimation()}setup(t){const e=l.textures(t.team);super.setup({...t,textures:e});const{constructingTextures:i}=e,s=new r.AnimatedSprite(i);this.spritesContainer.addChild(s),this.constructingAnimation=s}switchAnimation(t){let e;switch(t){case d.constructing:e=this.constructingAnimation;break;case d.healthy:e=this.healthyAnimation;break;case d.damaged:e=this.damagedAnimation}e!==this.currentAnimation&&null!=e&&(this.currentAnimation=e,this.hideAllAnimations(),this.currentAnimation.gotoAndPlay(0),this.currentAnimation.visible=!0)}isConstructing(){return this.currentAnimation===this.constructingAnimation}updateAnimation(){if(this.isHealthy())if(this.isConstructing()){if(this.constructingAnimation.currentFrame===this.constructingAnimation.totalFrames-1&&(this.switchAnimation(d.healthy),null!=this.constructUnit)){const t=this.game.createItem(this.constructUnit);null!=t&&this.game.tileMap.addItem(t)}}else this.switchAnimation(d.healthy);else this.isAlive()&&this.switchAnimation(d.damaged)}processOrders(){if("construct-unit"===this.order.type){if(!this.isHealthy())return!1;const{tileMap:t,team:e,cash:i}=this.game;t.rebuildBuildableGrid();const{currentMapBuildableGrid:r,mapGridWidth:s,mapGridHeight:o}=t,{buildableGrid:n}=this,a=[],l=this.getGridXY();for(const t of[l.gridY-1,l.gridY+n.length])for(const e of[l.gridX-1,l.gridX+n[0].length])e<0||e>=s||t<0||t>=o||0===r[t][e]&&a.push({gridX:e,gridY:t});if(a.length<=0)return this.game.showMessage({character:h.EMessageCharacter.system,message:"Warning! Cannot teleport unit while landing bay is occupied."}),this.order={type:"stand"},!0;const c=this.game.getItemCost(this.order.name);if("number"==typeof c)if(i[this.team]<c)this.team===e&&this.game.showMessage({character:h.EMessageCharacter.system,message:`Warning! Insufficient Funds. Need ${c} credits.`});else{const t=a[Math.floor(Math.random()*a.length)];i[this.team]-=c,this.constructUnit={initGridX:t.gridX+.5,initGridY:t.gridY+.5,initCenter:!0,team:this.team,name:this.order.name,order:this.order.unitOrder,teleport:!0},this.switchAnimation(d.constructing)}else console.warn(`Unable to calc item (name=${this.order.name}) cost`);this.order={type:"stand"}}return!1}}e.Base=l},756:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BuildingAnimation=e.Building=void 0;const r=i(8687),s=i(7697),o=i(1420),n=i(5285);class a extends n.SelectableLifeableSquareItem{constructor(t){super(t),this.commands=[],this.spritesContainer=new r.Container,this.buildableGrid=[],this.passableGrid=[],this.type=s.EItemType.buildings,this.radius=0,this.cost=0,this.healthyAnimationSpeed=.1,this.damagedAnimationSpeed=.1,this.setup(t)}setup(t){this.addChild(this.selectedGraphics),this.addChild(this.spritesContainer),this.addChild(this.collisionGraphics);const{textures:{healthyTextures:e,damagedTextures:i}}=t,{healthyAnimationSpeed:s,damagedAnimationSpeed:n}=this,a=new r.AnimatedSprite(e);a.animationSpeed=s,this.spritesContainer.addChild(a),this.healthyAnimation=a;const h=new r.AnimatedSprite(i);h.animationSpeed=n,this.spritesContainer.addChild(h),this.damagedAnimation=h,this.lifeBar=new o.LifeBar(this.drawLifeBarOptions),this.addChild(this.lifeBar)}hideAllAnimations(){this.spritesContainer.children.forEach((t=>{t.visible=!1}))}updateAnimation(){this.isHealthy()?this.switchAnimation(h.healthy):this.isAlive()&&this.switchAnimation(h.damaged)}switchAnimation(t){let e;switch(t){case h.healthy:e=this.healthyAnimation;break;case h.damaged:e=this.damagedAnimation}e!==this.currentAnimation&&null!=e&&(this.currentAnimation=e,this.hideAllAnimations(),this.currentAnimation.gotoAndPlay(0),this.currentAnimation.visible=!0)}handleUpdate(t){this.processOrders(),this.updateAnimation(),this.calcZIndex()}calcZIndex(){this.zIndex=this.y+this.height}}var h;e.Building=a,function(t){t.healthy="healthy",t.damaged="damaged"}(h=e.BuildingAnimation||(e.BuildingAnimation={}))},4536:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GroundTurret=e.GroundTurretAnimation=void 0;const r=i(8687),s=i(3200),o=i(8274),n=i(7697),a=i(756);var h;!function(t){t.healthy="healthy",t.damaged="damaged",t.teleport="teleport"}(h=e.GroundTurretAnimation||(e.GroundTurretAnimation={}));class d extends o.AttackableBuilding{static textures(t){return t===s.Team.blue?d.blueTextures:d.greenTextures}static prepareTextures({blueTextures:t,greenTextures:e}){d.blueTextures=t,d.greenTextures=e}constructor(t){var e;super({...t,textures:d.textures(t.team)}),this.itemName=n.EItemName.GroundTurret,this.drawSelectionOptions={width:26,height:23,radius:0,strokeWidth:2,strokeColor:0,strokeSecondColor:16777215,offset:{x:6,y:9}},this.drawLifeBarOptions={borderColor:16777215,borderThickness:1,borderAlpha:.5,width:22,height:5,fillColor:1409085,emptyColor:16711680,offset:{x:8,y:-2}},this.drawReloadBarOptions={alpha:1,width:22,height:2,fillColor:12690711,offset:{x:8,y:3}},this.sight=10,this.hitPoints=200,this.life=this.hitPoints,this.teleportAnimationSpeed=.1,this.canAttack=!0,this.canAttackLand=!0,this.canAttackAir=!1,this.turnSpeed=4,this.projectile=n.EItemName.CannonBall,this.order={type:"sentry"},this.collisionOptions=d.collisionOptions,Array.isArray(t.commands)&&(this.commands=t.commands),this.buildableGrid=d.buildableGrid,this.passableGrid=d.passableGrid,this.life=null!==(e=t.life)&&void 0!==e?e:this.hitPoints,this.drawSelectionOptions.strokeColor=t.team===s.Team.blue?255:65280,this.drawSelection(),this.drawCollision(),this.setPositionByXY({x:t.initX,y:t.initY}),this.drawLifeBar(),this.updateLife(),this.drawReloadBar(),this.updateReload(),this.teleportAnimation.animationSpeed=this.teleportAnimationSpeed,!0===t.teleport?this.switchAnimation(h.teleport):this.updateAnimation()}setup(t){const e=d.textures(t.team);super.setup({...t,textures:e});const i=new r.AnimatedSprite(e.teleportTextures);this.spritesContainer.addChild(i),this.teleportAnimation=i}isTeleporting(){return this.currentAnimation===this.teleportAnimation}updateAnimation(){this.isHealthy()?this.isTeleporting()?this.teleportAnimation.currentFrame===this.teleportAnimation.totalFrames-1&&this.switchAnimation(h.healthy):this.switchAnimation(h.healthy):this.isAlive()&&this.switchAnimation(h.damaged)}switchAnimation(t){let e;t===h.teleport&&(e=this.teleportAnimation),null!=e?e!==this.currentAnimation&&null!=e&&(this.currentAnimation=e,this.hideAllAnimations(),this.currentAnimation.gotoAndPlay(0),this.currentAnimation.visible=!0):t===h.healthy?super.switchAnimation(a.BuildingAnimation.healthy):super.switchAnimation(a.BuildingAnimation.damaged)}}d.collisionOptions={width:22,height:19,offset:{x:8,y:11}},d.cost=1500,d.buildableGrid=[[1]],d.passableGrid=[[1]],e.GroundTurret=d},6667:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.OilDerrick=e.OilDerrickAnimation=void 0;const r=i(8687),s=i(3200),o=i(756),n=i(7697);var a;!function(t){t.deploy="deploy",t.healthy="healthy",t.damaged="damaged"}(a=e.OilDerrickAnimation||(e.OilDerrickAnimation={}));class h extends o.Building{static textures(t){return t===s.Team.blue?h.blueTextures:h.greenTextures}static prepareTextures({blueTextures:t,greenTextures:e}){h.blueTextures=t,h.greenTextures=e}constructor(t){var e;super({...t,textures:h.textures(t.team)}),this.itemName=n.EItemName.OilDerrick,this.collisionOptions={width:35,height:19,offset:{x:2,y:41}},this.drawSelectionOptions={width:39,height:23,radius:0,strokeWidth:2,strokeColor:0,strokeSecondColor:16777215,offset:{x:0,y:39}},this.drawLifeBarOptions={borderColor:16777215,borderThickness:1,borderAlpha:.5,width:36,height:5,fillColor:1409085,emptyColor:16711680,offset:{x:2,y:-4}},this.sight=3,this.hitPoints=300,this.life=this.hitPoints,this.deployAnimationSpeed=.1,this.elapsedTime=0,this.harvestInterval=1e3,this.harvestAmount=10,Array.isArray(t.commands)&&(this.commands=t.commands),this.buildableGrid=h.buildableGrid,this.passableGrid=h.passableGrid,this.life=null!==(e=t.life)&&void 0!==e?e:this.hitPoints,this.drawSelectionOptions.strokeColor=t.team===s.Team.blue?255:65280,this.drawSelection(),this.drawCollision(),this.setPositionByXY({x:t.initX,y:t.initY}),this.drawLifeBar(),this.updateLife(),this.deployAnimation.animationSpeed=this.deployAnimationSpeed,!0===t.deploy?this.switchAnimation(a.deploy):this.updateAnimation()}setup(t){const e=h.textures(t.team);super.setup({...t,textures:e});const{deployTextures:i}=e,s=new r.AnimatedSprite(i);s.loop=!1,this.spritesContainer.addChild(s),this.deployAnimation=s}isDeploying(){return this.currentAnimation===this.deployAnimation}updateAnimation(){this.isHealthy()?this.isDeploying()?this.deployAnimation.currentFrame===this.deployAnimation.totalFrames-1&&this.switchAnimation(a.healthy):this.switchAnimation(a.healthy):this.isAlive()&&this.switchAnimation(a.damaged)}switchAnimation(t){let e;switch(t){case a.deploy:e=this.deployAnimation;break;case a.healthy:e=this.healthyAnimation;break;case a.damaged:e=this.damagedAnimation}e!==this.currentAnimation&&null!=e&&(this.currentAnimation=e,this.hideAllAnimations(),this.currentAnimation.gotoAndPlay(0),this.currentAnimation.visible=!0)}handleUpdate(t){this.isHealthy()&&(this.elapsedTime>=this.harvestInterval&&(this.game.cash[this.team]+=this.harvestAmount,this.elapsedTime=0),this.elapsedTime+=t),this.processOrders(),this.updateAnimation(),this.calcZIndex()}}h.cost=5e3,h.buildableGrid=[[1,1]],h.passableGrid=[[1,1]],e.OilDerrick=h},1097:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Starport=e.StarportAnimation=void 0;const r=i(8687),s=i(3200),o=i(756),n=i(7697),a=i(8554),h=i(9078);var d;!function(t){t.open="open",t.close="close",t.teleport="teleport",t.healthy="healthy",t.damaged="damaged"}(d=e.StarportAnimation||(e.StarportAnimation={}));class l extends o.Building{static textures(t){return t===s.Team.blue?l.blueTextures:l.greenTextures}static prepareTextures({blueTextures:t,greenTextures:e}){l.blueTextures=t,l.greenTextures=e}constructor(t){var e;super({...t,textures:l.textures(t.team)}),this.commands=[h.ECommandName.constructScoutTank,h.ECommandName.constructHeavyTank,h.ECommandName.constructChopper,h.ECommandName.constructWraith],this.itemName=n.EItemName.Starport,this.drawSelectionOptions={width:42,height:58,radius:0,strokeWidth:2,strokeColor:0,strokeSecondColor:16777215,offset:{x:-1,y:3}},this.drawLifeBarOptions={borderColor:16777215,borderThickness:1,borderAlpha:.5,width:38,height:5,fillColor:1409085,emptyColor:16711680,offset:{x:1,y:-4}},this.sight=3,this.hitPoints=300,this.life=this.hitPoints,this.teleportAnimationSpeed=.1,this.closingAnimationSpeed=.1,this.collisionOptions=l.collisionOptions,Array.isArray(t.commands)&&(this.commands=t.commands),this.buildableGrid=l.buildableGrid,this.passableGrid=l.passableGrid,this.life=null!==(e=t.life)&&void 0!==e?e:this.hitPoints,this.drawSelectionOptions.strokeColor=t.team===s.Team.blue?255:65280,this.drawSelection(),this.drawCollision(),this.setPositionByXY({x:t.initX,y:t.initY}),this.drawLifeBar(),this.updateLife(),this.teleportAnimation.animationSpeed=this.teleportAnimationSpeed,this.closingAnimation.animationSpeed=this.closingAnimationSpeed,this.openingAnimation.animationSpeed=this.closingAnimationSpeed,!0===t.teleport?this.switchAnimation(d.teleport):this.updateAnimation()}calcZIndex(){this.zIndex=this.y+this.height*this.passableGrid.filter((t=>t.some((t=>1===t)))).length/this.passableGrid.length}setup(t){const e=l.textures(t.team);super.setup({...t,textures:e});const{teleportTextures:i,closingTextures:s,openingTextures:o}=e,n=new r.AnimatedSprite(i);n.loop=!1,this.spritesContainer.addChild(n),this.teleportAnimation=n;const a=new r.AnimatedSprite(s);a.loop=!1,this.spritesContainer.addChild(a),this.closingAnimation=a;const h=new r.AnimatedSprite(o);h.loop=!1,this.spritesContainer.addChild(h),this.openingAnimation=h}isTeleporting(){return this.currentAnimation===this.teleportAnimation}isOpening(){return this.currentAnimation===this.openingAnimation}isClosing(){return this.currentAnimation===this.closingAnimation}updateAnimation(){if(this.isHealthy())if(this.isTeleporting())this.teleportAnimation.currentFrame===this.teleportAnimation.totalFrames-1&&this.switchAnimation(d.healthy);else if(this.isOpening()){if(this.openingAnimation.currentFrame===this.openingAnimation.totalFrames-1&&(this.switchAnimation(d.close),null!=this.constructUnit)){const t=this.game.createItem(this.constructUnit);null!=t&&(this.game.cash[this.team]-=this.constructUnit.cost,this.game.tileMap.addItem(t))}}else this.isClosing()&&(this.closingAnimation.currentFrame,this.closingAnimation.totalFrames),this.switchAnimation(d.healthy);else this.isAlive()&&this.switchAnimation(d.damaged)}switchAnimation(t){let e;switch(t){case d.teleport:e=this.teleportAnimation;break;case d.open:e=this.openingAnimation;break;case d.close:e=this.closingAnimation;break;case d.healthy:e=this.healthyAnimation;break;case d.damaged:e=this.damagedAnimation}e!==this.currentAnimation&&null!=e&&(this.currentAnimation=e,this.hideAllAnimations(),this.currentAnimation.gotoAndPlay(0),this.currentAnimation.visible=!0)}processOrders(){if("construct-unit"===this.order.type){if(!this.isHealthy())return!1;const t=this.getCollisionBounds(),{tileMap:e,team:i,cash:r}=this.game;let s=!1;for(let i=e.moveableItems.length-1;i>=0;i--){const r=e.moveableItems[i].getCollisionBounds();if(r.left>=t.left&&r.right<=t.right&&r.top>=t.top&&r.bottom<=t.bottom){s=!0;break}}const o=this.game.getItemCost(this.order.name);if("number"==typeof o)if(s)this.team===i&&this.game.showMessage({character:a.EMessageCharacter.system,message:"Warning! Cannot teleport unit while landing bay is occupied."});else if(r[this.team]<o)this.team===i&&this.game.showMessage({character:a.EMessageCharacter.system,message:`Warning! Insufficient Funds. Need ${o} credits.`});else{const t=this.getCollisionPosition({center:!0});this.constructUnit={initX:t.x,initY:t.y,initCenter:!0,team:this.team,name:this.order.name,order:this.order.unitOrder,teleport:!0,cost:o},this.switchAnimation(d.open)}else console.warn(`Unable to calc item (name=${this.order.name}) cost`);this.order={type:"stand"}}return!1}}l.collisionOptions={width:40,height:55,offset:{x:0,y:4}},l.cost=2e3,l.buildableGrid=[[1,1],[1,1],[1,1]],l.passableGrid=[[1,1],[0,0],[0,0]],e.Starport=l},3200:(t,e)=>{function i({direction:t,directions:e}){return t<0&&(t+=e),t>=e&&(t-=e),t}var r;Object.defineProperty(e,"__esModule",{value:!0}),e.compareArrays=e.generateUid=e.checkCollision=e.angleDiff=e.findAngleGrid=e.findAngle=e.wrapDirection=e.Team=void 0,(r=e.Team||(e.Team={})).blue="blue",r.green="green",e.wrapDirection=i,e.findAngle=function({from:t,to:e,directions:r}){const s=t.y-e.y,o=t.x-e.x;return i({direction:r/2-Math.atan2(o,s)*r/(2*Math.PI),directions:r})},e.findAngleGrid=function({from:t,to:e,directions:r}){const s=t.gridY-e.gridY,o=t.gridX-e.gridX;return i({direction:r/2-Math.atan2(o,s)*r/(2*Math.PI),directions:r})},e.angleDiff=function({angle1:t,angle2:e,directions:i}){t>=i/2&&(t-=i),e>=i/2&&(e-=i);let r=e-t;return r<-i/2&&(r+=i),r>i/2&&(r-=i),r},e.checkCollision=function(t,e,i="a"){const r=Math.max(e.left,t.left),s=Math.min(e.right,t.right);if(s<=r)return 0;const o=Math.max(e.top,t.top),n=Math.min(e.bottom,t.bottom);return n>o?(s-r)*(n-o)/("a"===i?(t.right-t.left)*(t.bottom-t.top):(e.right-e.left)*(e.bottom-e.top)):0};let s=1e3;e.generateUid=function(){return++s},e.compareArrays=function(t,e){if(t.length!==e.length)return!1;t=[...t].sort(),e=[...e].sort();for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}},7697:(t,e)=>{var i,r;Object.defineProperty(e,"__esModule",{value:!0}),e.EItemName=e.EItemType=void 0,(r=e.EItemType||(e.EItemType={})).none="none",r.buildings="buildings",r.vehicles="vehicles",r.airVehicles="airVehicles",r.terrain="terrain",r.projectiles="projectiles",(i=e.EItemName||(e.EItemName={})).None="none",i.Base="base",i.OilDerrick="oil-derrick",i.Starport="starport",i.GroundTurret="ground-turret",i.SCV="scv",i.Harvester="harvester",i.Transport="transport",i.ScoutTank="scout-tank",i.HeavyTank="heavy-tank",i.Chopper="chopper",i.Wraith="wraith",i.Bullet="bullet",i.CannonBall="cannon-ball",i.Rocket="heatseeker",i.Laser="laser"},5473:function(t,e,i){var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.logSideBar=e.logItemBounds=e.logGrid=e.logHitboxes=e.logDoubleTapEvent=e.logPointerEvent=e.logLayout=e.logApp=void 0;const s=r(i(1227));e.logApp=(0,s.default)("rts-app"),e.logLayout=(0,s.default)("rts-layout"),e.logPointerEvent=(0,s.default)("rts-pointer-event"),e.logDoubleTapEvent=(0,s.default)("rts-double-tap-event"),e.logHitboxes=(0,s.default)("rts-hitboxes"),e.logGrid=(0,s.default)("rts-grid"),e.logItemBounds=(0,s.default)("rts-item-bounds"),e.logSideBar=(0,s.default)("rts-side-bar")},9420:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Bullet=void 0;const r=i(7049),s=i(7697),o=i(5634);class n extends o.Projectile{constructor(t){super({...t,textures:n.textures}),this.itemName=s.EItemName.Bullet,this.speed=50,this.range=5,this.damage=1,this.collisionOptions={width:4,height:4,offset:{x:3,y:4}},this.drawCollision(),this.setPositionByXY({x:t.initX,y:t.initY,center:!0}),r.AUDIO.play("bullet")}static prepareTextures({textures:t}){n.textures=t}playHitSound(){r.AUDIO.play("bullet-hit")}}n.reloadTime=2,n.shootAudio="",e.Bullet=n},3452:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CannonBall=void 0;const r=i(7049),s=i(7697),o=i(5634);class n extends o.Projectile{constructor(t){super({...t,textures:n.textures}),this.itemName=s.EItemName.CannonBall,this.speed=60,this.range=15,this.damage=20,this.collisionOptions={width:4,height:4,offset:{x:3,y:3}},this.drawCollision(),this.setPositionByXY({x:t.initX,y:t.initY,center:!0}),r.AUDIO.play("cannon-ball")}static prepareTextures({textures:t}){n.textures=t}playHitSound(){r.AUDIO.play("cannon-hit")}}n.reloadTime=40,e.CannonBall=n},5191:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Laser=void 0;const r=i(7049),s=i(7697),o=i(5634);class n extends o.Projectile{constructor(t){super({...t,textures:n.textures}),this.itemName=s.EItemName.Laser,this.speed=60,this.range=8,this.damage=10,this.collisionOptions={width:4,height:4,offset:{x:3,y:3}},this.drawCollision(),this.setPositionByXY({x:t.initX,y:t.initY,center:!0}),r.AUDIO.play("laser")}static prepareTextures({textures:t}){n.textures=t}playHitSound(){r.AUDIO.play("laser-hit")}}n.reloadTime=30,e.Laser=n},5634:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Projectile=void 0;const r=i(8687),s=i(7697),o=i(6865),n=i(3200),a=i(9349);class h extends a.Item{constructor(t){super(t),this.commands=[],this.type=s.EItemType.projectiles,this.range=0,this.damage=0,this.distanceTravelled=0,this.vector=new o.Vector({direction:o.EVectorDirection.down}),this.speed=0,this.radius=0,this.followRadius=0,this.turnSpeed=0,this.turnFactor=0,this.moveTurning=!1,this.hardCollision=!1,this.collisionCount=0,this.colliding=!1,this.spritesContainer=new r.Container,this.uid="number"==typeof t.uid?t.uid:(0,n.generateUid)(),this.game=t.game,this.order={type:"fire",to:t.target},this.setup(t),this.vector.setDirection({direction:t.direction}),this.switchAnimation()}setup({textures:{upTextures:t,upRightTextures:e,rightTextures:i,downRightTextures:s,downTextures:o,downLeftTextures:n,leftTextures:a,upLeftTextures:h,explodeTextures:d}}){this.addChild(this.spritesContainer),this.addChild(this.collisionGraphics);const l=new r.AnimatedSprite(t);this.spritesContainer.addChild(l),this.upAnimation=l;const c=new r.AnimatedSprite(e);this.spritesContainer.addChild(c),this.upRightAnimation=c;const p=new r.AnimatedSprite(i);this.spritesContainer.addChild(p),this.rightAnimation=p;const u=new r.AnimatedSprite(s);this.spritesContainer.addChild(u),this.downRightAnimation=u;const m=new r.AnimatedSprite(o);this.spritesContainer.addChild(m),this.downAnimation=m;const g=new r.AnimatedSprite(n);this.spritesContainer.addChild(g),this.downLeftAnimation=g;const w=new r.AnimatedSprite(a);this.spritesContainer.addChild(w),this.leftAnimation=w;const f=new r.AnimatedSprite(h);this.spritesContainer.addChild(f),this.upLeftAnimation=f;const x=new r.AnimatedSprite(d);x.loop=!1,this.spritesContainer.addChild(x),this.explodeAnimation=x}hideAllAnimations(){this.spritesContainer.children.forEach((t=>{t.visible=!1}))}switchAnimation(){let t;const e=.5,{direction:i}=this.vector;t=i>=o.EVectorDirection.upLeft+e&&i<=o.EVectorDirection.up||i>=o.EVectorDirection.up&&i<=o.EVectorDirection.upRight-e?this.upAnimation:i>=o.EVectorDirection.upRight+e&&i<=o.EVectorDirection.downRight-e?this.rightAnimation:i>=o.EVectorDirection.downRight+e&&i<=o.EVectorDirection.downLeft-e?this.downAnimation:i>=o.EVectorDirection.downLeft+e&&i<=o.EVectorDirection.upLeft-e?this.leftAnimation:i>o.EVectorDirection.up&&i<o.EVectorDirection.right?this.upRightAnimation:i>o.EVectorDirection.right&&i<o.EVectorDirection.down?this.downRightAnimation:i>=o.EVectorDirection.down&&i<o.EVectorDirection.left?this.downLeftAnimation:this.upLeftAnimation,t!==this.currentAnimation&&(this.currentAnimation=t,this.hideAllAnimations(),this.currentAnimation.gotoAndPlay(0),this.currentAnimation.visible=!0)}switchToExplodeAnimation(){this.hideAllAnimations(),this.currentAnimation=this.explodeAnimation,this.currentAnimation.gotoAndPlay(0),this.currentAnimation.visible=!0,this.currentAnimation.onComplete=()=>{this.removeFromParent()}}reachedTarget(){if("fire"===this.order.type){const t=this.getCollisionBounds(),e=this.order.to.getCollisionBounds();return(0,n.checkCollision)(t,e)>.5}return!1}playHitSound(){}isExploding(){return this.currentAnimation===this.explodeAnimation}processOrders(){if("fire"===this.order.type){const t=this.reachedTarget();return this.distanceTravelled>this.range||t?t?(this.playHitSound(),this.order.to.subLife(this.damage),this.switchToExplodeAnimation(),this.order={type:"stand"}):this.removeFromParent():this._moveTo(this.order.to),!0}return!1}handleUpdate(t){this.processOrders()}_moveTo(t){const e=this.getGridXY({center:!0});if(this.turnSpeed>0){const i=t.getGridXY({center:!0}),r=(0,n.findAngleGrid)({from:i,to:e,directions:this.vector.directions}),s=(0,n.angleDiff)({angle1:this.vector.direction,angle2:r,directions:this.vector.directions}),o=this.turnSpeed*this.game.turnSpeedAdjustmentFactor;Math.abs(s)>o&&(this.vector.setDirection({direction:(0,n.wrapDirection)({direction:this.vector.direction+o*Math.abs(s)/s,directions:this.vector.directions})}),this.switchAnimation())}const i=this.speed*this.game.speedAdjustmentFactor;this.distanceTravelled+=i;const r=-this.vector.direction/this.vector.directions*2*Math.PI,s=-i*Math.sin(r),o=-i*Math.cos(r),a=e.gridX+s,h=e.gridY+o;this.setPositionByGridXY({gridX:a,gridY:h,center:!0})}}h.reloadTime=0,e.Projectile=h},5978:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Rocket=void 0;const r=i(7049),s=i(7697),o=i(5634);class n extends o.Projectile{constructor(t){super({...t,textures:n.textures}),this.itemName=s.EItemName.Rocket,this.speed=25,this.range=9,this.damage=20,this.turnSpeed=2,this.collisionOptions={width:5,height:5,offset:{x:3,y:3}},this.drawCollision(),this.setPositionByXY({x:t.initX,y:t.initY,center:!0}),r.AUDIO.play("rocket")}static prepareTextures({textures:t}){n.textures=t}playHitSound(){r.AUDIO.play("rocket-hit")}}n.reloadTime=40,e.Rocket=n},4942:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AttackableVehicle=void 0;const r=i(9078),s=i(9759),o=i(3200),n=i(7697),a=i(1976);class h extends a.Vehicle{constructor(t){super(t),this.commands=[r.ECommandName.moveFollow,r.ECommandName.attackGuard,r.ECommandName.patrol],this.reloadTimeLeft=0,this.drawReloadBarOptions={alpha:0,width:0,height:0,fillColor:0,offset:{x:0,y:0}},this.canAttack=!1,this.canAttackLand=!1,this.canAttackAir=!1,this.setup(t)}setup(t){super.setup(t),this.reloadBar=new s.ReloadBar(this.drawReloadBarOptions),this.addChild(this.reloadBar)}isValidTarget(t){return t.team!==this.team&&(this.canAttackLand&&(t.type===n.EItemType.buildings||t.type===n.EItemType.vehicles)||this.canAttackAir&&t.type===n.EItemType.airVehicles)}findTargetInSight(t=0){const e=this.getGridXY({center:!0}),i={},r=this.game.tileMap.activeItems.children;for(let s=r.length-1;s>=0;s--){const o=r[s];if(this.isValidTarget(o)){const r=o.getGridXY({center:!0}),s=Math.pow(r.gridX-e.gridX,2)+Math.pow(r.gridY-e.gridY,2);s<Math.pow(this.sight+t,2)&&(Array.isArray(i[s])||(i[s]=[]),i[s].push(o))}}return Object.keys(i).map(Number).sort(((t,e)=>t-e)).map((t=>i[t])).flat()[0]}processOrders(){if("patrol"!==this.order.type&&super.processOrders())return!0;const{tileMap:t,turnSpeedAdjustmentFactor:e}=this.game,i=this.getGridXY({center:!0});switch(this.order.type){case"stand":{const t=this.findTargetInSight();return null!=t&&(this.order={type:"attack",to:t}),!0}case"sentry":{const t=this.findTargetInSight(2);return null!=t&&(this.order={type:"attack",to:t,nextOrder:this.order}),!0}case"hunt":{const t=this.findTargetInSight(100);return null!=t&&(this.order={type:"attack",to:t,nextOrder:this.order}),!0}case"attack":{if(null==this.order.to)return!0;if(this.order.to.isDead()||!this.isValidTarget(this.order.to))return null!=this.order.nextOrder?this.order=this.order.nextOrder:this.order={type:"stand"},!0;const r=this.order.to.getGridXY({center:!0}),s=Math.pow(r.gridX-i.gridX,2)+Math.pow(r.gridY-i.gridY,2);if(s<Math.pow(this.sight,2)){const s=(0,o.findAngleGrid)({from:r,to:i,directions:this.vector.directions}),n=(0,o.angleDiff)({angle1:this.vector.direction,angle2:s,directions:this.vector.directions}),a=this.turnSpeed*e;if(Math.abs(n)>a)this.vector.setDirection({direction:(0,o.wrapDirection)({direction:this.vector.direction+a*Math.abs(n)/n,directions:this.vector.directions})}),this.moveTurning=!0;else if(this.vector.setDirection({direction:s}),this.moveTurning=!1,this.reloadTimeLeft<=0){const e=this.game.getReloadTime(this.projectile);if("number"==typeof e){this.reloadTimeLeft=e;const r=-this.vector.direction/this.vector.directions*2*Math.PI,o=i.gridX-this.radius*Math.sin(r)/t.gridSize,n=i.gridY-this.radius*Math.cos(r)/t.gridSize,a=this.game.createProjectile({name:this.projectile,initX:o*t.gridSize,initY:n*t.gridSize,direction:s,target:this.order.to});null!=a&&t.addItem(a)}}}else{const t=Math.pow(s,.5);this._moveTo({type:this.order.to.type,...r},t)||(this.order={type:"stand"})}return!0}case"patrol":{const e=this.findTargetInSight(1);if(null!=e)return this.order={type:"attack",to:e,nextOrder:this.order},!0;const r=Math.pow(this.order.toPoint.gridX-i.gridX,2)+Math.pow(this.order.toPoint.gridY-i.gridY,2);if(r<Math.pow(this.sight/t.gridSize,2)){const t=this.order.toPoint;this.order.toPoint=this.order.fromPoint,this.order.fromPoint=t}else this._moveTo(this.order.toPoint,r);return!0}case"guard":{if(this.order.to.isDead())return null!=this.order.nextOrder?this.order=this.order.nextOrder:this.order={type:"stand"},!0;const t=this.order.to.getGridXY({center:!0}),e=Math.pow(t.gridX-i.gridX,2)+Math.pow(t.gridY-i.gridY,2);if(e<Math.pow(this.followRadius,2)){const t=this.findTargetInSight(1);if(null!=t)return this.order={type:"attack",to:t,nextOrder:this.order},!0;"attack"===this.order.to.order.type&&(this.order={type:"attack",to:this.order.to.order.to,nextOrder:this.order})}else{const t=this.findTargetInSight(1);if(null!=t)this.order={type:"attack",to:t,nextOrder:this.order};else{const t=this.order.to.getGridXY({center:!0});this._moveTo({type:this.order.to.type,...t},e)}}return!0}case"move-and-attack":{const e=this.findTargetInSight();if(null!=e)return this.order={type:"attack",to:e,nextOrder:this.order},!0;const r=Math.pow(this.order.toPoint.gridX-i.gridX,2)+Math.pow(this.order.toPoint.gridY-i.gridY,2);if(r<Math.pow(this.radius/t.gridSize,2))return this.order={type:"stand"},!0;const s=Math.pow(r,.5);return this._moveTo(this.order.toPoint,s)||(this.order={type:"stand"}),!0}}return!1}handleUpdate(t){this.reloadTimeLeft>0&&(this.reloadTimeLeft-=this.game.reloadAdjustmentFactor),this.updateReload(),super.handleUpdate(t)}drawReloadBar(){this.reloadBar.draw(this.drawReloadBarOptions);const{offset:t}=this.drawReloadBarOptions;this.reloadBar.position.set(t.x,t.y)}updateReload(){const t=this.game.getReloadTime(this.projectile);"number"==typeof t&&this.reloadBar.updateReload((t-this.reloadTimeLeft)/t)}}e.AttackableVehicle=h},9498:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Harvester=void 0;const r=i(6667),s=i(3200),o=i(7697),n=i(6865),a=i(1976);class h extends a.Vehicle{static textures(t){return t===s.Team.blue?h.blueTextures:h.greenTextures}static prepareTextures({blueTextures:t,greenTextures:e}){h.blueTextures=t,h.greenTextures=e}constructor(t){var e;super({...t,textures:h.textures(t.team)}),this.itemName=o.EItemName.Harvester,this.collisionOptions={width:20,height:20,offset:{x:1,y:0}},this.drawSelectionOptions={width:0,height:0,radius:10,strokeWidth:2,strokeColor:0,strokeSecondColor:16777215,offset:{x:-1,y:-2}},this.drawLifeBarOptions={borderColor:16777215,borderThickness:1,borderAlpha:.5,width:20,height:5,fillColor:1409085,emptyColor:16711680,offset:{x:1,y:-7}},this.radius=10,this.speed=10,this.sight=3,this.hitPoints=50,this.turnSpeed=2,this.turnFactor=20,Array.isArray(t.commands)&&(this.commands=t.commands),this.life=null!==(e=t.life)&&void 0!==e?e:this.hitPoints,this.drawSelectionOptions.strokeColor=t.team===s.Team.blue?255:4243264,this.drawSelection(),this.drawCollision(),this.setPositionByXY({x:t.initX,y:t.initY,center:t.initCenter}),this.drawLifeBar(),this.updateLife(),this.updateAnimation(),!0===t.teleport&&this.drawTeleport()}processOrders(){if(super.processOrders())return!0;if("deploy"===this.order.type){const{tileMap:t,turnSpeedAdjustmentFactor:e}=this.game;t.rebuildBuildableGrid(this);const{currentMapBuildableGrid:i}=t,{buildableGrid:a}=r.OilDerrick,{toPoint:h}=this.order;for(let t=a.length-1;t>=0;t--)for(let e=a[t].length-1;e>=0;e--)if(1===i[Math.floor(h.gridY)+t][Math.floor(h.gridX)+e])return this.order={type:"stand"},!0;const d=this.getGridXY({center:!0}),l=Math.pow(h.gridX-d.gridX,2)+Math.pow(h.gridY-d.gridY,2);if(l<Math.pow(2*this.radius/t.gridSize,2)){const i=(0,s.angleDiff)({angle1:this.vector.direction,angle2:n.EVectorDirection.left,directions:this.vector.directions}),o=this.turnSpeed*e;Math.abs(i)>o?(this.vector.setDirection({direction:(0,s.wrapDirection)({direction:this.vector.direction+o*Math.abs(i)/i,directions:this.vector.directions})}),this.moveTurning=!0):(this.vector.setDirection({direction:n.EVectorDirection.left}),this.moveTurning=!1),this.moveTurning||(this.removeAndDestroy(),t.addItem(new r.OilDerrick({game:this.game,initX:Math.floor(d.gridX)*t.gridSize,initY:Math.floor(d.gridY)*t.gridSize,team:this.team,deploy:!0})))}else{const t=Math.pow(l,.5);this._moveTo({type:o.EItemType.terrain,...this.order.toPoint},t)||(this.order={type:"stand"})}return!0}return!1}}h.cost=1600,e.Harvester=h},2273:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.HeavyTank=void 0;const r=i(3200),s=i(7697),o=i(4942);class n extends o.AttackableVehicle{static textures(t){return t===r.Team.blue?n.blueTextures:n.greenTextures}static prepareTextures({blueTextures:t,greenTextures:e}){n.blueTextures=t,n.greenTextures=e}constructor(t){var e;super({...t,textures:n.textures(t.team)}),this.itemName=s.EItemName.HeavyTank,this.collisionOptions={width:26,height:26,offset:{x:3,y:3}},this.drawSelectionOptions={width:0,height:0,radius:13,strokeWidth:2,strokeColor:0,strokeSecondColor:16777215,offset:{x:1,y:1}},this.drawLifeBarOptions={borderColor:16777215,borderThickness:1,borderAlpha:.5,width:26,height:5,fillColor:1409085,emptyColor:16711680,offset:{x:3,y:-7}},this.drawReloadBarOptions={alpha:1,width:26,height:2,fillColor:12690711,offset:{x:3,y:-2}},this.radius=13,this.speed=15,this.sight=10,this.hitPoints=50,this.turnSpeed=4,this.turnFactor=10,this.projectile=s.EItemName.CannonBall,this.canAttack=!0,this.canAttackLand=!0,this.canAttackAir=!1,Array.isArray(t.commands)&&(this.commands=t.commands),this.life=null!==(e=t.life)&&void 0!==e?e:this.hitPoints,this.drawSelectionOptions.strokeColor=t.team===r.Team.blue?255:4243264,this.drawSelection(),this.drawCollision(),this.setPositionByXY({x:t.initX,y:t.initY,center:t.initCenter}),this.drawLifeBar(),this.updateLife(),this.drawReloadBar(),this.updateReload(),this.updateAnimation(),!0===t.teleport&&this.drawTeleport()}}n.cost=1200,e.HeavyTank=n},2591:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SCV=void 0;const r=i(9078),s=i(8554),o=i(7049),n=i(3200),a=i(7697),h=i(1976);class d extends h.Vehicle{static textures(t){return t===n.Team.blue?d.blueTextures:d.greenTextures}static prepareTextures({blueTextures:t,greenTextures:e}){d.blueTextures=t,d.greenTextures=e}constructor(t){var e;super({...t,textures:d.textures(t.team)}),this.itemName=a.EItemName.SCV,this.commands=[r.ECommandName.moveFollow,r.ECommandName.patrol,r.ECommandName.buildTurret,r.ECommandName.buildStarport],this.collisionOptions={width:20,height:20,offset:{x:5,y:5}},this.drawSelectionOptions={width:0,height:0,radius:12,strokeWidth:2,strokeColor:16776960,strokeSecondColor:16777215,offset:{x:1,y:1}},this.drawLifeBarOptions={borderColor:16777215,borderThickness:1,borderAlpha:.5,width:20,height:5,fillColor:1409085,emptyColor:16711680,offset:{x:5,y:-4}},this.radius=15,this.speed=15,this.sight=3,this.hitPoints=100,this.turnSpeed=4,this.turnFactor=10,Array.isArray(t.commands)&&(this.commands=t.commands),this.life=null!==(e=t.life)&&void 0!==e?e:this.hitPoints,this.drawSelectionOptions.strokeColor=t.team===n.Team.blue?255:4243264,this.drawSelection(),this.drawCollision(),this.setPositionByXY({x:t.initX,y:t.initY,center:t.initCenter}),this.drawLifeBar(),this.updateLife(),this.updateAnimation(),!0===t.teleport&&this.drawTeleport()}processOrders(){if(super.processOrders())return!0;if("build"===this.order.type){const t=this.game.getItemCost(this.order.name);if("number"!=typeof t)return console.warn(`Unable to calc item (name=${this.order.name}) cost`),this.order={type:"stand"},!0;const{tileMap:e,cash:i,team:r}=this.game;if(i[this.team]<t&&this.team===r)return this.game.showMessage({character:s.EMessageCharacter.system,message:`Warning! Insufficient Funds. Need ${t} credits.`}),this.order={type:"stand"},!0;e.rebuildBuildableGrid();const{currentMapBuildableGrid:n,mapGridWidth:h,mapGridHeight:d}=e,l=this.game.getBuildableGrid(this.order.name);if(null==l)return console.warn(`Unable to detect buildable grid for name=${this.order.name}`),this.order={type:"stand"},!0;const{toPoint:c}=this.order;for(let t=l.length-1;t>=0;t--)for(let e=l[t].length-1;e>=0;e--)if(1===n[Math.floor(c.gridY)+t][Math.floor(c.gridX)+e])return o.AUDIO.play("scv-error"),this.order={type:"stand"},!0;const p=this.getGridXY({center:!0,floor:!0}),u={gridX:Math.floor(c.gridX)-1,gridY:Math.floor(c.gridY)-1},m=[[1,...l[0],1],...l.map((t=>[1,...t,1])),[1,...l[l.length-1],1]];let g=!1;for(let t=0;t<m.length;t++)for(let e=0;e<m[t].length;e++){const i=u.gridX+e,r=u.gridY+t;if(!(i<0||i>=h||r<0||r>=d)&&i===p.gridX&&r===p.gridY){g=!0;break}}if(g){const r=this.game.createItem({name:this.order.name,team:this.team,initGridX:Math.floor(c.gridX),initGridY:Math.floor(c.gridY),teleport:!0});null!=r&&(i[this.team]-=t,e.addItem(r),e.rebuildPassableRequired=!0),this.order={type:"stand"}}else{const t=this.getGridXY(),e=Math.pow(c.gridX-t.gridX,2)+Math.pow(c.gridY-t.gridY,2),i=Math.pow(e,.5);this._moveTo({type:a.EItemType.terrain,...this.order.toPoint},i)||(o.AUDIO.play("scv-error"),this.order={type:"stand"})}return!0}return!1}}d.cost=400,e.SCV=d},3244:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ScoutTank=void 0;const r=i(3200),s=i(7697),o=i(4942);class n extends o.AttackableVehicle{static textures(t){return t===r.Team.blue?n.blueTextures:n.greenTextures}static prepareTextures({blueTextures:t,greenTextures:e}){n.blueTextures=t,n.greenTextures=e}constructor(t){var e;super({...t,textures:n.textures(t.team)}),this.itemName=s.EItemName.ScoutTank,this.collisionOptions={width:22,height:22,offset:{x:0,y:0}},this.drawSelectionOptions={width:0,height:0,radius:11,strokeWidth:2,strokeColor:0,strokeSecondColor:16777215,offset:{x:-2,y:-2}},this.drawLifeBarOptions={borderColor:16777215,borderThickness:1,borderAlpha:.5,width:22,height:5,fillColor:1409085,emptyColor:16711680,offset:{x:0,y:-9}},this.drawReloadBarOptions={alpha:1,width:22,height:2,fillColor:12690711,offset:{x:0,y:-4}},this.radius=11,this.speed=20,this.sight=4,this.hitPoints=50,this.turnSpeed=4,this.turnFactor=10,this.projectile=s.EItemName.Bullet,this.canAttack=!0,this.canAttackLand=!0,this.canAttackAir=!1,Array.isArray(t.commands)&&(this.commands=t.commands),this.life=null!==(e=t.life)&&void 0!==e?e:this.hitPoints,this.drawSelectionOptions.strokeColor=t.team===r.Team.blue?255:4243264,this.drawSelection(),this.drawCollision(),this.setPositionByXY({x:t.initX,y:t.initY,center:t.initCenter}),this.drawLifeBar(),this.updateLife(),this.drawReloadBar(),this.updateReload(),this.updateAnimation(),!0===t.teleport&&this.drawTeleport()}}n.cost=500,e.ScoutTank=n},4631:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Transport=void 0;const r=i(3200),s=i(7697),o=i(1976);class n extends o.Vehicle{static textures(t){return t===r.Team.blue?n.blueTextures:n.greenTextures}static prepareTextures({blueTextures:t,greenTextures:e}){n.blueTextures=t,n.greenTextures=e}constructor(t){var e;super({...t,textures:n.textures(t.team)}),this.itemName=s.EItemName.Transport,this.collisionOptions={width:30,height:30,offset:{x:0,y:0}},this.drawSelectionOptions={width:0,height:0,radius:15,strokeWidth:2,strokeColor:16776960,strokeSecondColor:16777215,offset:{x:-2,y:-2}},this.drawLifeBarOptions={borderColor:16777215,borderThickness:1,borderAlpha:.5,width:30,height:5,fillColor:1409085,emptyColor:16711680,offset:{x:0,y:-7}},this.radius=15,this.speed=15,this.sight=3,this.hitPoints=100,this.turnSpeed=2,this.turnFactor=20,Array.isArray(t.commands)&&(this.commands=t.commands),this.life=null!==(e=t.life)&&void 0!==e?e:this.hitPoints,this.drawSelectionOptions.strokeColor=t.team===r.Team.blue?255:4243264,this.drawSelection(),this.drawCollision(),this.setPositionByXY({x:t.initX,y:t.initY,center:t.initCenter}),this.drawLifeBar(),this.updateLife(),this.updateAnimation(),!0===t.teleport&&this.drawTeleport()}}n.cost=400,e.Transport=n},1976:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Vehicle=void 0;const r=i(8687),s=i(6865),o=i(3200),n=i(7697),a=i(9215),h=i(1420),d=i(9078),l=i(2766);var c;!function(t){t.soft="soft",t.hard="hard",t.attraction="attraction"}(c||(c={}));class p extends l.TeleportableSelectableLifeableRoundItem{constructor(t){super(t),this.commands=[d.ECommandName.moveFollow,d.ECommandName.patrol],this.type=n.EItemType.vehicles,this.spritesContainer=new r.Container,this.vector=new s.Vector({direction:s.EVectorDirection.down}),this.speed=0,this.moveTurning=!1,this.turnSpeed=0,this.turnFactor=0,this.hardCollision=!1,this.collisionCount=0,this.colliding=!1,this.radius=0,this.followRadius=3,this.elapsedSwitchFrames=0,this.switchFrames=30,null!=t.direction&&this.vector.setDirection({direction:t.direction}),this.setup(t)}setup(t){this.addChild(this.selectedGraphics),this.addChild(this.spritesContainer),this.addChild(this.collisionGraphics);const{textures:{upTextures:e,upRightTextures:i,rightTextures:s,downRightTextures:o,downTextures:n,downLeftTextures:a,leftTextures:d,upLeftTextures:l},teleport:c}=t;!0===c&&(this.teleportGraphics=new r.Graphics,this.addChild(this.teleportGraphics));const p=new r.AnimatedSprite(e);this.spritesContainer.addChild(p),this.upAnimation=p;const u=new r.AnimatedSprite(i);this.spritesContainer.addChild(u),this.upRightAnimation=u;const m=new r.AnimatedSprite(s);this.spritesContainer.addChild(m),this.rightAnimation=m;const g=new r.AnimatedSprite(o);this.spritesContainer.addChild(g),this.downRightAnimation=g;const w=new r.AnimatedSprite(n);this.spritesContainer.addChild(w),this.downAnimation=w;const f=new r.AnimatedSprite(a);this.spritesContainer.addChild(f),this.downLeftAnimation=f;const x=new r.AnimatedSprite(d);this.spritesContainer.addChild(x),this.leftAnimation=x;const b=new r.AnimatedSprite(l);this.spritesContainer.addChild(b),this.upLeftAnimation=b,this.lifeBar=new h.LifeBar(this.drawLifeBarOptions),this.addChild(this.lifeBar)}hideAllAnimations(){this.spritesContainer.children.forEach((t=>{t.visible=!1}))}updateAnimation(t=!1){this.switchAnimation(this.vector.direction,t)}switchAnimation(t,e){let i;const r=.5;i=t>=s.EVectorDirection.upLeft+r&&t<=s.EVectorDirection.upLeft+1||t>=s.EVectorDirection.up&&t<=s.EVectorDirection.upRight-r?this.upAnimation:t>=s.EVectorDirection.upRight+r&&t<=s.EVectorDirection.downRight-r?this.rightAnimation:t>=s.EVectorDirection.downRight+r&&t<=s.EVectorDirection.downLeft-r?this.downAnimation:t>=s.EVectorDirection.downLeft+r&&t<=s.EVectorDirection.upLeft-r?this.leftAnimation:t>s.EVectorDirection.up&&t<s.EVectorDirection.right?this.upRightAnimation:t>s.EVectorDirection.right&&t<s.EVectorDirection.down?this.downRightAnimation:t>=s.EVectorDirection.down&&t<s.EVectorDirection.left?this.downLeftAnimation:this.upLeftAnimation,i!==this.currentAnimation&&e&&(this.currentAnimation=i,this.hideAllAnimations(),this.currentAnimation.gotoAndPlay(0),this.currentAnimation.visible=!0)}processOrders(){const{tileMap:t}=this.game,e=this.getGridXY({center:!0});switch(this.order.type){case"move":{this.collisionCount=0;const i=Math.pow(this.order.toPoint.gridX-e.gridX,2)+Math.pow(this.order.toPoint.gridY-e.gridY,2);if(i<Math.pow(this.radius/t.gridSize,2))return this.order={type:"stand"},!0;if(this.colliding&&i<Math.pow(3*this.radius/t.gridSize,2))return this.order={type:"stand"},!0;{if(this.colliding&&i<Math.pow(5*this.radius/t.gridSize,2)&&(0===this.collisionCount?this.collisionCount=1:this.collisionCount++,this.collisionCount>30))return this.order={type:"stand"},!0;const e=Math.pow(i,.5);if(!this._moveTo(this.order.toPoint,e))return this.order={type:"stand"},!0}return!0}case"follow":{if(this.order.to.isDead())return null!=this.order.nextOrder?this.order=this.order.nextOrder:this.order={type:"stand"},!0;const t=this.order.to.getGridXY({center:!0}),i=Math.pow(t.gridX-e.gridX,2)+Math.pow(t.gridY-e.gridY,2);if(i<Math.pow(this.followRadius,2));else{const t=this.order.to.getGridXY({center:!0});this._moveTo({type:this.order.to.type,...t},i)}return!0}case"patrol":{const i=Math.pow(this.order.toPoint.gridX-e.gridX,2)+Math.pow(this.order.toPoint.gridY-e.gridY,2);if(i<Math.pow(this.sight/t.gridSize,2)){const t=this.order.toPoint;this.order.toPoint=this.order.fromPoint,this.order.fromPoint=t}else this._moveTo(this.order.toPoint,i);return!0}}return!1}handleUpdate(t){super.handleUpdate(t),this.processOrders(),this.elapsedSwitchFrames>=this.switchFrames?(this.updateAnimation(!0),this.elapsedSwitchFrames=0):this.updateAnimation(this.moveTurning||0===this.elapsedSwitchFrames),this.elapsedSwitchFrames+=1,this.zIndex=this.y+this.height}checkCollisionObjects(t,e){const{tileMap:i,speedAdjustmentFactor:r,speedAdjustmentWhileTurningFactor:s}=this.game,o=this.getGridXY({center:!0}),n=this.speed*r*(this.moveTurning?s:1),a=Math.min(n,e),h=-Math.round(this.vector.direction)/this.vector.directions*2*Math.PI,d=o.gridX-a*Math.sin(h),l=o.gridY-a*Math.cos(h),p=[],u=Math.max(0,Math.round(d)-3),m=Math.min(i.mapGridWidth-1,Math.round(d)+3),g=Math.max(0,Math.round(l)-3),w=Math.min(i.mapGridHeight-1,Math.round(l)+3);for(let e=u;e<=m;e++)for(let r=g;r<=w;r++)if(1===t[r][e]){const t=e+.5,s=r+.5,o=Math.pow(t-d,2)+Math.pow(s-l,2);o<Math.pow(this.radius/i.gridSize,2)?p.push({collisionType:c.hard,with:{type:"wall",x:t,y:s}}):o<Math.pow(1.1*this.radius/i.gridSize,2)&&p.push({collisionType:c.soft,with:{type:"wall",x:t,y:s}})}const{groundItems:f}=i;for(let t=f.length-1;t>=0;t--){const e=f[t],r=e.getGridXY({center:!0});if(e!==this&&Math.abs(r.gridX-o.gridX)<3&&Math.abs(r.gridY-o.gridY)<3){const t=Math.pow(r.gridX-d,2)+Math.pow(r.gridY-l,2);t<Math.pow((this.radius+e.radius)/i.gridSize,2)?p.push({collisionType:c.hard,with:{type:e.type,x:r.gridX,y:r.gridY}}):t<Math.pow((1.1*this.radius+e.radius)/i.gridSize,2)&&p.push({collisionType:c.soft,with:{type:e.type,x:r.gridX,y:r.gridY}})}}return p}_moveTo(t,e){const{tileMap:i,turnSpeedAdjustmentFactor:r,speedAdjustmentFactor:s,speedAdjustmentWhileTurningFactor:h}=this.game,d=this.getGridXY({center:!0}),l=Math.round(t.gridX),p=Math.round(t.gridY),u={gridX:Math.round(d.gridX),gridY:Math.round(d.gridY)},m={gridX:l,gridY:p},g=i.currentCopyMapPassableGrid;let w;t.type!==n.EItemType.buildings&&t.type!==n.EItemType.terrain||(g[p][l]=0);let f=[];if(u.gridY<0||u.gridY>=i.mapGridHeight||u.gridX<0||u.gridX>=i.mapGridWidth||u.gridX===m.gridX&&u.gridY===m.gridY)f=[{x:d.gridX,y:d.gridY},{x:t.gridX,y:t.gridY}],w=(0,o.findAngleGrid)({from:t,to:d,directions:this.vector.directions});else{if(f=a.AStar.calc({grid:g,start:u,end:m,f:"Euclidean"}),!(f.length>1))return!1;{const t={x:f[1].x,y:f[1].y};w=(0,o.findAngle)({from:t,to:{x:d.gridX,y:d.gridY},directions:this.vector.directions})}}const x=this.checkCollisionObjects(g,e);if(this.colliding=!1,this.hardCollision=!1,x.length>0){this.colliding=!0;const t={x:0,y:0};x.push({collisionType:c.attraction,with:{x:f[1].x+.5,y:f[1].y+.5}});for(let e=x.length-1;e>=0;e--){const i=x[e],r=-(0,o.findAngle)({from:i.with,to:{x:d.gridX,y:d.gridY},directions:this.vector.directions})/this.vector.directions*2*Math.PI;let s;switch(i.collisionType){case c.hard:s=2,this.hardCollision=!0;break;case c.soft:s=1;break;case c.attraction:s=-.5}t.x+=s*Math.sin(r),t.y+=s*Math.cos(r)}w=(0,o.findAngle)({from:t,to:{x:0,y:0},directions:this.vector.directions})}else this.colliding=!1;const b=(0,o.angleDiff)({angle1:this.vector.direction,angle2:w,directions:this.vector.directions}),y=this.turnSpeed*r;Math.abs(b)>y*this.turnFactor?(this.vector.setDirection({direction:(0,o.wrapDirection)({direction:this.vector.direction+y*Math.abs(b)/b,directions:this.vector.directions})}),this.moveTurning=!0):(this.vector.setDirection({direction:w}),this.moveTurning=!1);const T=this.speed*s*(this.moveTurning?h:1);let v=Math.min(T,e);this.hardCollision&&(v=0);const C=-Math.round(this.vector.direction)/this.vector.directions*2*Math.PI,S=-v*Math.sin(C),A=-v*Math.cos(C),M=d.gridX+S,k=d.gridY+A;return this.setPositionByGridXY({gridX:M,gridY:k,center:!0}),!0}}e.Vehicle=p},6844:(t,e,i)=>{t.exports=i.p+"./assets/audio/bullet-hit-0.mp3"},6851:(t,e,i)=>{t.exports=i.p+"./assets/audio/bullet-hit-1.mp3"},8602:(t,e,i)=>{t.exports=i.p+"./assets/audio/bullet-hit-2.mp3"},2980:(t,e,i)=>{t.exports=i.p+"./assets/audio/bullet-hit-3.mp3"},2704:(t,e,i)=>{t.exports=i.p+"./assets/audio/bullet-hit-4.mp3"},9376:(t,e,i)=>{t.exports=i.p+"./assets/audio/bullet-hit-5.mp3"},8178:(t,e,i)=>{t.exports=i.p+"./assets/audio/bullet1.mp3"},3209:(t,e,i)=>{t.exports=i.p+"./assets/audio/bullet2.mp3"},1040:(t,e,i)=>{t.exports=i.p+"./assets/audio/cannon-hit.mp3"},7822:(t,e,i)=>{t.exports=i.p+"./assets/audio/cannon1.mp3"},9748:(t,e,i)=>{t.exports=i.p+"./assets/audio/cannon2.mp3"},1689:(t,e,i)=>{t.exports=i.p+"./assets/audio/chopper-attack-0.mp3"},9180:(t,e,i)=>{t.exports=i.p+"./assets/audio/chopper-attack-1.mp3"},4147:(t,e,i)=>{t.exports=i.p+"./assets/audio/chopper-attack-2.mp3"},1241:(t,e,i)=>{t.exports=i.p+"./assets/audio/chopper-yes-0.mp3"},2657:(t,e,i)=>{t.exports=i.p+"./assets/audio/chopper-yes-1.mp3"},888:(t,e,i)=>{t.exports=i.p+"./assets/audio/chopper-yes-2.mp3"},2792:(t,e,i)=>{t.exports=i.p+"./assets/audio/chopper-yes-3.mp3"},6947:(t,e,i)=>{t.exports=i.p+"./assets/audio/chopper-yes-4.mp3"},6231:(t,e,i)=>{t.exports=i.p+"./assets/audio/chopper-yes-5.mp3"},5286:(t,e,i)=>{t.exports=i.p+"./assets/audio/click.mp3"},2044:(t,e,i)=>{t.exports=i.p+"./assets/audio/engaging.mp3"},2254:(t,e,i)=>{t.exports=i.p+"./assets/audio/gun.mp3"},7574:(t,e,i)=>{t.exports=i.p+"./assets/audio/heatseeker1.mp3"},3987:(t,e,i)=>{t.exports=i.p+"./assets/audio/heatseeker2.mp3"},8523:(t,e,i)=>{t.exports=i.p+"./assets/audio/laser-hit-0.mp3"},2763:(t,e,i)=>{t.exports=i.p+"./assets/audio/laser1.mp3"},7976:(t,e,i)=>{t.exports=i.p+"./assets/audio/laser2.mp3"},3534:(t,e,i)=>{t.exports=i.p+"./assets/audio/message.mp3"},5802:(t,e,i)=>{t.exports=i.p+"./assets/audio/rocket-hit-0.mp3"},9345:(t,e,i)=>{t.exports=i.p+"./assets/audio/roger1.mp3"},9275:(t,e,i)=>{t.exports=i.p+"./assets/audio/roger2.mp3"},3512:(t,e,i)=>{t.exports=i.p+"./assets/audio/scv-error-0.mp3"},4727:(t,e,i)=>{t.exports=i.p+"./assets/audio/scv-yes-0.mp3"},5384:(t,e,i)=>{t.exports=i.p+"./assets/audio/scv-yes-1.mp3"},9422:(t,e,i)=>{t.exports=i.p+"./assets/audio/scv-yes-2.mp3"},4057:(t,e,i)=>{t.exports=i.p+"./assets/audio/scv-yes-3.mp3"},1117:(t,e,i)=>{t.exports=i.p+"./assets/audio/scv-yes-4.mp3"},8665:(t,e,i)=>{t.exports=i.p+"./assets/audio/scv-yes-5.mp3"},3264:(t,e,i)=>{t.exports=i.p+"./assets/audio/scv-yes-6.mp3"},4844:(t,e,i)=>{t.exports=i.p+"./assets/audio/tank-attack-0.mp3"},5563:(t,e,i)=>{t.exports=i.p+"./assets/audio/tank-attack-1.mp3"},4389:(t,e,i)=>{t.exports=i.p+"./assets/audio/tank-attack-2.mp3"},3481:(t,e,i)=>{t.exports=i.p+"./assets/audio/tank-yes-0.mp3"},6349:(t,e,i)=>{t.exports=i.p+"./assets/audio/tank-yes-1.mp3"},3722:(t,e,i)=>{t.exports=i.p+"./assets/audio/tank-yes-2.mp3"},2923:(t,e,i)=>{t.exports=i.p+"./assets/audio/tank-yes-3.mp3"},6955:(t,e,i)=>{t.exports=i.p+"./assets/audio/vulture-attack-0.mp3"},978:(t,e,i)=>{t.exports=i.p+"./assets/audio/vulture-yes-0.mp3"},6707:(t,e,i)=>{t.exports=i.p+"./assets/audio/vulture-yes-1.mp3"},5061:(t,e,i)=>{t.exports=i.p+"./assets/audio/vulture-yes-2.mp3"},5367:(t,e,i)=>{t.exports=i.p+"./assets/audio/vulture-yes-3.mp3"},5234:(t,e,i)=>{t.exports=i.p+"./assets/audio/wraith-attack-0.mp3"},5644:(t,e,i)=>{t.exports=i.p+"./assets/audio/wraith-attack-1.mp3"},5728:(t,e,i)=>{t.exports=i.p+"./assets/audio/wraith-attack-2.mp3"},5410:(t,e,i)=>{t.exports=i.p+"./assets/audio/wraith-attack-3.mp3"},9799:(t,e,i)=>{t.exports=i.p+"./assets/audio/wraith-yes-0.mp3"},5670:(t,e,i)=>{t.exports=i.p+"./assets/audio/wraith-yes-1.mp3"},6141:(t,e,i)=>{t.exports=i.p+"./assets/audio/wraith-yes-2.mp3"},5236:(t,e,i)=>{t.exports=i.p+"./assets/audio/wraith-yes-3.mp3"},651:(t,e,i)=>{t.exports=i.p+"./assets/audio/yup.mp3"}},i={};function r(t){var s=i[t];if(void 0!==s)return s.exports;var o=i[t]={id:t,loaded:!1,exports:{}};return e[t].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}r.m=e,t=[],r.O=(e,i,s,o)=>{if(!i){var n=1/0;for(l=0;l<t.length;l++){for(var[i,s,o]=t[l],a=!0,h=0;h<i.length;h++)(!1&o||n>=o)&&Object.keys(r.O).every((t=>r.O[t](i[h])))?i.splice(h--,1):(a=!1,o<n&&(n=o));if(a){t.splice(l--,1);var d=s();void 0!==d&&(e=d)}}return e}o=o||0;for(var l=t.length;l>0&&t[l-1][2]>o;l--)t[l]=t[l-1];t[l]=[i,s,o]},r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t;r.g.importScripts&&(t=r.g.location+"");var e=r.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");i.length&&(t=i[i.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=t})(),(()=>{var t={179:0};r.O.j=e=>0===t[e];var e=(e,i)=>{var s,o,[n,a,h]=i,d=0;if(n.some((e=>0!==t[e]))){for(s in a)r.o(a,s)&&(r.m[s]=a[s]);if(h)var l=h(r)}for(e&&e(i);d<n.length;d++)o=n[d],r.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return r.O(l)},i=self.webpackChunksimple_html5_rts_game=self.webpackChunksimple_html5_rts_game||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var s=r.O(void 0,[736],(()=>r(6752)));s=r.O(s)})();